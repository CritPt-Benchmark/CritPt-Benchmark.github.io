<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Checkpoint-3</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #3D7B7B; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #F00 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666 } /* Operator */
.codehilite .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #9C6500 } /* Comment.Preproc */
.codehilite .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.codehilite .gr { color: #E40000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #008400 } /* Generic.Inserted */
.codehilite .go { color: #717171 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #04D } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #687822 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #00F; font-weight: bold } /* Name.Class */
.codehilite .no { color: #800 } /* Name.Constant */
.codehilite .nd { color: #A2F } /* Name.Decorator */
.codehilite .ni { color: #717171; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #00F } /* Name.Function */
.codehilite .nl { color: #767600 } /* Name.Label */
.codehilite .nn { color: #00F; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #A2F; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #BBB } /* Text.Whitespace */
.codehilite .mb { color: #666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666 } /* Literal.Number.Float */
.codehilite .mh { color: #666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #A45A77 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #00F } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666 } /* Literal.Number.Integer.Long */

</style>
<style>
    :root {
  --bg: #ffffff;
  --fg: #222222;
  --muted: #555555;
  --border: #e0e0e0;
  --accent: #005fcc;
  --code-bg: #f6f8fa;
  --role-user: #0ea5e9;
  --role-assistant: #22c55e;
  --role-system: #9ca3af;
  --return-code: #a35291;
}
html.dark {
  --bg: #0b0b0b;
  --fg: #e8e8e8;
  --muted: #a0a0a0;
  --border: #333333;
  --accent: #3b82f6;
  --code-bg: #111827;
  --role-user: #0ea5e9;
  --role-assistant: #22c55e;
  --role-system: #9ca3af;
  --return-code: #a35291;
}
* {
  box-sizing: border-box;
}
body {
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--fg);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", sans-serif;
  line-height: 1.6;
}
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 1.25rem;
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  background: var(--bg);
  z-index: 10;
}
h1 {
  margin: 0;
  font-size: 1.1rem;
}
.tabs {
  display: flex;
  gap: 0.5rem;
}
.tab {
  padding: 0.4rem 0.8rem;
  border: 1px solid var(--border);
  border-bottom: none;
  background: transparent;
  cursor: pointer;
  border-radius: 6px 6px 0 0;
  color: var(--fg);
}
.tab.active {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
}
.tab-content {
  display: none;
  padding: 1rem 1.25rem;
  border-top: 1px solid var(--border);
}
.tab-content.active {
  display: block;
}
#theme-toggle {
  border: 1px solid var(--border);
  padding: 0.2rem 0.6rem;
  font-size: 0.9rem;
  border-radius: 4px;
  cursor: pointer;
  background: transparent;
  color: var(--fg);
}
.main {
  max-width: 1200px;
  margin: 0 auto;
}
.message {
  border: 1px solid var(--border);
  border-left-width: 6px;
  border-radius: 6px;
  padding: 0.8rem 1rem;
  margin-bottom: 1rem;
  background: rgba(0,0,0,0.02);
}
.message .meta {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  margin-bottom: 0.6rem;
  color: var(--muted);
  font-size: 0.85rem;
}
.message .badge {
  font-weight: 600;
}
.role-user {
  border-left-color: var(--role-user);
}
.role-assistant {
  border-left-color: var(--role-assistant);
}
.role-system {
  border-left-color: var(--role-system);
}
.role-unknown {
  border-left-color: var(--accent);
}

.output-code-container {
  display: flex;
  gap: 1rem;               /* space between children */
  align-items: center;     /* vertical alignment */
  justify-content: start;  /* horizontal alignment */
}

.output-code-container .codeblock {
  flex: 0 1 auto;
}

.codeblock {
  border: 1px solid var(--border);
  border-left-width: 6px;
  border-radius: 6px;
  padding: 0.8rem 1rem;
  margin-bottom: 1rem;
  background: rgba(0,0,0,0.02);
}
.codeblock-content {
  margin-bottom: 0.6rem;
  border: 1px dashed var(--border);
  border-radius: 4px;
  padding: 0.4rem 0.6rem;
  background: rgba(0,0,0,0.02);
}

.codeblock.eval_code {
  border-left-color: var(--role-user);
}
.codeblock.target_code {
  border-left-color: var(--role-assistant);
}
.codeblock.output_code {
  border-left-color: var(--role-system);
}

html.dark .codeblock-content {
  background: rgba(255,255,255,0.03);
}
.codeblock > summary {
  cursor: pointer;
  font-weight: 600;
  list-style: none; /* remove default triangle in some browsers */
}
.codeblock > summary::-webkit-details-marker {
  display: none; /* Safari/Chrome marker */
}
.codeblock > summary::before {
  content: "â–¶ ";
  display: inline-block;
  transform: rotate(0deg);
  transition: transform 0.12s ease-out;
}
.codeblock[open] > summary::before {
  transform: rotate(90deg);
}
.codeblock .tag {
  color: var(--muted);
  font-weight: 400;
  font-size: 0.85em;
  margin-left: 0.25rem;
}

.markdown-body pre code {
  background: var(--code-bg);
  display: block;
  padding: 0.75rem;
  overflow-x: auto;
  border-radius: 4px;
  border: 1px solid var(--border);
}
.markdown-body code {
  background: var(--code-bg);
  padding: 0.15rem 0.3rem;
  border-radius: 4px;
}
/* Extra info tree */
details > summary {
  cursor: pointer;
  font-weight: 600;
}
details .block {
  padding-left: 1rem;
  margin: 0.25rem 0 0.5rem 0;
  border-left: 2px solid var(--border);
}
.kv .key {
  font-weight: 600;
}
.kv .type {
  color: var(--muted);
  margin-left: 0.5rem;
  font-size: 0.85rem;
}
footer {
  margin: 2rem 0;
  text-align: center;
  color: var(--muted);
  font-size: 0.85rem;
}
/* CodeHilite (pygments) overrides to respect theme vars */
.codehilite {
  background: var(--code-bg) !important;
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 0.75rem !important;
}
.reasoning {
  margin-bottom: 0.6rem;
  border: 1px dashed var(--border);
  border-radius: 4px;
  padding: 0.4rem 0.6rem;
  background: rgba(0,0,0,0.02);
}
html.dark .reasoning {
  background: rgba(255,255,255,0.03);
}
.reasoning > summary {
  cursor: pointer;
  font-weight: 600;
  list-style: none; /* remove default triangle in some browsers */
}
.reasoning > summary::-webkit-details-marker {
  display: none; /* Safari/Chrome marker */
}
.reasoning > summary::before {
  content: "â–¶ ";
  display: inline-block;
  transform: rotate(0deg);
  transition: transform 0.12s ease-out;
}
.reasoning[open] > summary::before {
  transform: rotate(90deg);
}
.reasoning .tag {
  color: var(--muted);
  font-weight: 400;
  font-size: 0.85em;
  margin-left: 0.25rem;
}
.reasoning-body {
  margin-top: 0.5rem;
}
</style>

<!-- ===== MATHJAX CONFIG ===== -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [ ["\\(","\\)"] ],
    displayMath: [ ["\\[","\\]"] ],
    processEscapes: true,
    processEnvironments: true
  },
  options: {
    ignoreHtmlClass: ".*",
    processHtmlClass: "arithmatex"

    // skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    // if you dynamically add content later, you can call MathJax.typesetPromise()
  }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<!-- ========================== -->
</head>
<body>
<header>
  <h1>Checkpoint-3</h1>
  <div>
    <button id="theme-toggle" aria-label="toggle dark mode">ðŸŒ“</button>
  </div>
</header>

<div class="main">
  
<article class="message role-system">
    <div class="meta">
        <span class="badge">System</span>
        <span class="idx">#0</span>
    </div>
    <div class="content markdown-body"><p>You are a physics research assistant specializing in solving complex, research-level problems using precise, step-by-step reasoning.</p>
<p><strong>Input</strong>
Problems will be provided in Markdown format.</p>
<p><strong>Output (Markdown format)</strong></p>
<ol>
<li><strong>Step-by-Step Derivation</strong> - Show every non-trivial step in the solution.  Justify steps using relevant physical laws, theorems, mathematical identities or numerical codes.</li>
<li><strong>Mathematical Typesetting</strong> - Use LaTeX for all mathematics:  <code>$...$</code> for inline expressions, <code>$$...$$</code> for display equations.</li>
<li><strong>Conventions and Units</strong> - Follow the unit system and conventions specified in the problem.</li>
<li>
<p><strong>Final Answer</strong> - At the end of the solution,  start a new line with <strong>&ldquo;Final Answer:&rdquo;</strong>, and present the final result.</p>
<p>For final answers involving values, follow the precision requirements specified in the problem.
If no precision is specified:
- If an exact value is possible, provide it (e.g., \$\sqrt(2)\$, \$\pi/4\$).
- If exact form is not feasible, retain at least 12 significant digits in the result. </p>
</li>
<li>
<p><strong>Formatting Compliance</strong> - If the user requests a specific output format (e.g., code, table),  provide the final answer accordingly.</p>
</li>
</ol></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#1</span>
    </div>
    <div class="content markdown-body"><h1 id="problem-setup">Problem setup:</h1>
<p>In quantum error correction, you encode quantum states into logical states made of many qubits in order to improve their resilience to errors. In quantum error detection, you do the same but can only detect the presence of errors and not correct them. In this problem, we will consider a single [[4,2,2]] quantum error detection code, which encodes two logical qubits into four physical qubits, and investigate how robust logical quantum operations in this code are to quantum errors.</p>
<p>Our convention is that the four physical qubits in the [[4,2,2]] code are labelled 0,1,2,3. The two logical qubits are labelled A and B. The stabilizers are <span class="arithmatex">\(XXXX\)</span> and <span class="arithmatex">\(ZZZZ\)</span>, where <span class="arithmatex">\(X\)</span> and <span class="arithmatex">\(Z\)</span> are Pauli matrices. The logical <span class="arithmatex">\(X\)</span> and <span class="arithmatex">\(Z\)</span> operators on the two qubits are <span class="arithmatex">\(X_A = XIXI\)</span>, <span class="arithmatex">\(X_B=XXII\)</span>, <span class="arithmatex">\(Z_A = ZZII\)</span>, <span class="arithmatex">\(Z_B = ZIZI\)</span>, up to multiplication by stabilizers.</p>
<p>We will consider different state preparation circuits consisting of controlled not <span class="arithmatex">\(CNOT_{ij}\)</span> gates, where <span class="arithmatex">\(CNOT_{ij}\)</span> has control qubit <span class="arithmatex">\(i\)</span> and target qubit <span class="arithmatex">\(j\)</span>. As a simple model of quantum errors in hardware, we will suppose that each <span class="arithmatex">\(CNOT_{ij}\)</span> gate in the circuit has a two qubit depolarizing error channel following it that produces one of the 15 non-identity two-qubit Paulis with equal probability <span class="arithmatex">\(p/15\)</span>. The probability <span class="arithmatex">\(p\)</span> indicates the probability of an error in a single two-qubit gate. We will assess the logical infidelity of certain state preparation protocols as a function of the physical infidelity <span class="arithmatex">\(p\)</span>.</p>
<h1 id="subproblems">Checkpoints</h1>
<h2 id="subproblem-1">Checkpoint 1</h2>
<p>Suppose that we wish to prepare a logical two-qubit GHZ state  <span class="arithmatex">\((|00\rangle_{AB}+|11\rangle_{AB})/\sqrt{2}\)</span> in the [[4,2,2]] code. To do so, we use the following state preparation circuit:</p>
<div class="arithmatex">\[
(CNOT_{03}) (H_0) (CNOT_{21}) (H_2).
\]</div>
<p>Note that this equation is written in matrix multiplication order, while the quantum operations in the circuit occur in the reverse order (from right-to-left in the above equation). <span class="arithmatex">\(H\)</span> is a single-qubit Hadamard gate.</p>
<p>What is the physical state fidelity of the final physical 4-qubit state at the end of the circuit as a function of the two-qubit gate error rate <span class="arithmatex">\(p\)</span>?</p></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#2</span>
    </div>
    <div class="content markdown-body"><ol>
<li>Step-by-Step Derivation</li>
</ol>
<ul>
<li>Assumptions and noise model</li>
<li>Initial state is the computational basis state on four qubits: <span class="arithmatex">\(|0000\rangle\)</span>.</li>
<li>The state preparation circuit is applied right-to-left:
    1) <span class="arithmatex">\(H_2\)</span>, 2) <span class="arithmatex">\(CNOT_{21}\)</span>, 3) <span class="arithmatex">\(H_0\)</span>, 4) <span class="arithmatex">\(CNOT_{03}\)</span>.</li>
<li>After each <span class="arithmatex">\(CNOT_{ij}\)</span>, a two-qubit depolarizing channel acts on <span class="arithmatex">\((i,j)\)</span>:</li>
</ul>
<div class="arithmatex">\[
\mathcal{D}_p(\rho)=(1-p)\rho+\frac{p}{15}\sum_{P\in\mathcal{P}_2\setminus\{II\}} P\rho P,
\]</div>
<div class="codehilite"><pre><span></span><code>where $\mathcal{P}_2=\{I,X,Y,Z\}^{\otimes 2}$ on the two involved qubits.
</code></pre></div>

<ul>
<li>Ideal final state and its stabilizer</li>
<li>Apply the circuit to <span class="arithmatex">\(|0000\rangle\)</span>:<ul>
<li><span class="arithmatex">\(H_2\)</span> followed by <span class="arithmatex">\(CNOT_{21}\)</span> prepares a Bell pair on qubits <span class="arithmatex">\((2,1)\)</span>:</li>
</ul>
</li>
</ul>
<div class="arithmatex">\[
|{\Phi^+}\rangle_{21}=\frac{|00\rangle_{21}+|11\rangle_{21}}{\sqrt{2}}.
\]</div>
<div class="codehilite"><pre><span></span><code><span class="k">-</span> $H_0$ followed by $CNOT_{03}$ prepares a Bell pair on qubits $(0,3)$:
</code></pre></div>

<div class="arithmatex">\[
|{\Phi^+}\rangle_{03}=\frac{|00\rangle_{03}+|11\rangle_{03}}{\sqrt{2}}.
\]</div>
<ul>
<li>Hence the ideal four-qubit state is</li>
</ul>
<div class="arithmatex">\[
|\psi\rangle=|{\Phi^+}\rangle_{03}\otimes|{\Phi^+}\rangle_{21}.
\]</div>
<ul>
<li>The stabilizer generators (conjugating <span class="arithmatex">\(Z_i\)</span> through the circuit) are</li>
</ul>
<div class="arithmatex">\[
X_0X_3,\quad Z_0Z_3,\quad Z_2Z_1,\quad X_2X_1,
\]</div>
<div class="codehilite"><pre><span></span><code><span class="n">confirming</span> $|\<span class="n">psi</span>\<span class="n">rangle</span>$ <span class="k">is</span> <span class="n">a</span> <span class="n">product</span> <span class="nb">of</span> <span class="n">two</span> <span class="n">Bell</span> <span class="n">states</span> (<span class="n">each</span> <span class="n">Bell</span> <span class="k">state</span> <span class="k">has</span> <span class="n">stabilizer</span> $\<span class="n">langle</span> <span class="o">X</span>\<span class="n">otimes</span> <span class="o">X</span>,\,<span class="o">Z</span>\<span class="n">otimes</span> <span class="o">Z</span>\<span class="n">rangle</span>$).
</code></pre></div>

<ul>
<li>Location of errors and their propagation</li>
<li>Errors occur only after <span class="arithmatex">\(CNOT_{21}\)</span> (on qubits <span class="arithmatex">\((2,1)\)</span>) and after <span class="arithmatex">\(CNOT_{03}\)</span> (on qubits <span class="arithmatex">\((0,3)\)</span>).</li>
<li>The gates between these errors (<span class="arithmatex">\(H_0\)</span> and <span class="arithmatex">\(CNOT_{03}\)</span> after the first error, and no further gate after the second error) act on disjoint qubits from <span class="arithmatex">\((2,1)\)</span>; hence the first error does not propagate to <span class="arithmatex">\((0,3)\)</span> and vice versa.</li>
<li>Therefore, the net error at the end is a tensor product</li>
</ul>
<div class="arithmatex">\[
E_{\text{tot}}=E_{21}\otimes E_{03},
\]</div>
<div class="codehilite"><pre><span></span><code>with $E_{21}$ a two-qubit Pauli on $(2,1)$ and $E_{03}$ a two-qubit Pauli on $(0,3)$, independently drawn from the depolarizing distributions.
</code></pre></div>

<ul>
<li>Fidelity contribution from a single pair</li>
<li>For a single Bell pair <span class="arithmatex">\(|{\Phi^+}\rangle\)</span>, the two-qubit Paulis that leave the density matrix invariant (map the state to itself up to a global phase) are</li>
</ul>
<div class="arithmatex">\[
\{II,\ XX,\ YY,\ ZZ\}.
\]</div>
<div class="codehilite"><pre><span></span><code><span class="nv">Indeed</span>,<span class="w"> </span>$<span class="nv">XX</span>$<span class="w"> </span><span class="nv">and</span><span class="w"> </span>$<span class="nv">ZZ</span>$<span class="w"> </span><span class="nv">stabilize</span><span class="w"> </span>$<span class="o">|</span>{\<span class="nv">Phi</span><span class="o">^+</span>}\<span class="nv">rangle</span>$<span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">eigenvalue</span><span class="w"> </span>$<span class="o">+</span><span class="mi">1</span>$,<span class="w"> </span><span class="k">while</span><span class="w"> </span>$<span class="nv">YY</span><span class="o">=-</span><span class="ss">(</span><span class="nv">XX</span><span class="ss">)(</span><span class="nv">ZZ</span><span class="ss">)</span>$<span class="w"> </span><span class="nv">acts</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">eigenvalue</span><span class="w"> </span>$<span class="o">-</span><span class="mi">1</span>$,<span class="w"> </span><span class="nv">which</span><span class="w"> </span><span class="nv">still</span><span class="w"> </span><span class="nv">leaves</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">projector</span><span class="w"> </span>$<span class="o">|</span>\<span class="nv">Phi</span><span class="o">^+</span>\<span class="nv">rangle</span>\<span class="nv">langle</span>\<span class="nv">Phi</span><span class="o">^+|</span>$<span class="w"> </span><span class="nv">unchanged</span>.
</code></pre></div>

<ul>
<li>Under the depolarizing channel on that pair:<ul>
<li>With probability <span class="arithmatex">\((1-p)\)</span>, <span class="arithmatex">\(II\)</span> occurs (good).</li>
<li>With probability <span class="arithmatex">\(p\)</span>, a uniformly random non-identity Pauli from the 15 occurs; among these, exactly 3 are good: <span class="arithmatex">\(XX,YY,ZZ\)</span>.</li>
</ul>
</li>
<li>Thus, the probability that the pair remains in <span class="arithmatex">\(|{\Phi^+}\rangle\)</span> is</li>
</ul>
<div class="arithmatex">\[
f_{\text{pair}}=(1-p)+\frac{3}{15}p=1-\frac{12}{15}p=1-\frac{4}{5}p.
\]</div>
<ul>
<li>Overall four-qubit fidelity</li>
<li>Because the two error channels act on disjoint pairs and independently, the total state is preserved if and only if both pairs are preserved. Hence the total physical-state fidelity is</li>
</ul>
<div class="arithmatex">\[
F(p)=\big(f_{\text{pair}}\big)^2=\left(1-\frac{4}{5}p\right)^2.
\]</div>
<ol start="2">
<li>Mathematical Typesetting</li>
</ol>
<p>All key steps have been expressed in LaTeX above.</p>
<ol start="3">
<li>Conventions and Units</li>
</ol>
<ul>
<li>Qubits labeled as specified: physical qubits 0,1,2,3; pairs affected by the two CNOTs are (2,1) and (0,3).</li>
<li>Noise model is the stated two-qubit depolarizing channel with parameter <span class="arithmatex">\(p\)</span>.</li>
</ul>
<ol start="4">
<li>Final Answer:
F(p) = (1 - 4p/5)^2.</li>
</ol></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#3</span>
    </div>
    <div class="content markdown-body"><p>The correct answer is:
$
F_{\rm{physical}}=(1-\frac{12}{15}p)^2
$</p>
<p>Now let&rsquo;s solve the next Checkpoint.</p>
<h2 id="subproblem-2">Checkpoint 2</h2>
<p>Suppose that we wish to prepare a logical two-qubit GHZ state  <span class="arithmatex">\((|00\rangle_{AB}+|11\rangle_{AB})/\sqrt{2}\)</span> in the [[4,2,2]] code. To do so, we use the following state preparation circuit:</p>
<div class="arithmatex">\[
(CNOT_{03}) (H_0) (CNOT_{21}) (H_2).
\]</div>
<p>Note that this equation is written in matrix multiplication order, while the quantum operations in the circuit occur in the reverse order (from right-to-left in the above equation). <span class="arithmatex">\(H\)</span> is a single-qubit Hadamard gate.</p>
<p>What is the logical state fidelity of the final 2-qubit logical state at the end of the circuit as a function of the two-qubit gate error rate <span class="arithmatex">\(p\)</span>, assuming the state is post-selected on all detectable errors in the code?</p></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#4</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>

<span class="c1"># Pauli matrices ignoring phase</span>
<span class="n">paulis</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>

<span class="c1"># Single-qubit commutation: two Paulis commute if (both I) or same or one is I or are not from (X,Z) anti commute etc.</span>
<span class="c1"># We can define a commutation function for strings of length 4.</span>

<span class="n">anti_pairs</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">),(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">)}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">commute</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="c1"># p and q are strings over I,X,Y,Z of same length</span>
    <span class="n">anti</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="s1">&#39;I&#39;</span> <span class="ow">or</span> <span class="n">b</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="n">b</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="n">anti_pairs</span><span class="p">:</span>
            <span class="n">anti</span> <span class="o">^=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">anti</span><span class="o">==</span><span class="mi">0</span>

<span class="c1"># group generation ignoring phase</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_group</span><span class="p">(</span><span class="n">generators</span><span class="p">):</span>
    <span class="c1"># generators: list of strings</span>
    <span class="n">G</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;I&#39;</span><span class="o">*</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">changed</span><span class="p">:</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="p">):</span>
                <span class="c1"># multiply g*h ignoring phase</span>
                <span class="n">prod</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">h</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">b</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">==</span><span class="n">b</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># multiplication table ignoring phase</span>
                        <span class="c1"># X*Y = Z; Y*X = Z; but differing by phase; ignore phase -&gt; symmetric</span>
                        <span class="c1"># We&#39;ll define mapping as: X*Y-&gt;Z, Y*Z-&gt;X, Z*X-&gt;Y, and symmetric</span>
                        <span class="n">m</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span>
                            <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
                            <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span>
                        <span class="p">}</span>
                        <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)])</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">G</span><span class="p">:</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                    <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">G</span>

<span class="c1"># Define code </span>
<span class="n">S1</span> <span class="o">=</span> <span class="s1">&#39;XXXX&#39;</span>
<span class="n">S2</span> <span class="o">=</span> <span class="s1">&#39;ZZZZ&#39;</span>
<span class="n">X_A</span> <span class="o">=</span> <span class="s1">&#39;XIXI&#39;</span>
<span class="n">X_B</span> <span class="o">=</span> <span class="s1">&#39;XXII&#39;</span>
<span class="n">Z_A</span> <span class="o">=</span> <span class="s1">&#39;ZZII&#39;</span>
<span class="n">Z_B</span> <span class="o">=</span> <span class="s1">&#39;ZIZI&#39;</span>

<span class="c1"># Logical Bell state stabilizer group generators: S plus X_A X_B and Z_A Z_B</span>
<span class="c1"># Need to compute products X_A X_B etc.</span>

<span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
    <span class="n">prod</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">b</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">a</span><span class="o">==</span><span class="n">b</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">{</span>
                <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span>
            <span class="p">}</span>
            <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)])</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>

<span class="n">L1</span> <span class="o">=</span> <span class="n">multiply</span><span class="p">(</span><span class="n">X_A</span><span class="p">,</span> <span class="n">X_B</span><span class="p">)</span>  <span class="c1"># X_A X_B</span>
<span class="n">L2</span> <span class="o">=</span> <span class="n">multiply</span><span class="p">(</span><span class="n">Z_A</span><span class="p">,</span> <span class="n">Z_B</span><span class="p">)</span>  <span class="c1"># Z_A Z_B</span>

<span class="n">G_state</span> <span class="o">=</span> <span class="n">generate_group</span><span class="p">([</span><span class="n">S1</span><span class="p">,</span><span class="n">S2</span><span class="p">,</span><span class="n">L1</span><span class="p">,</span><span class="n">L2</span><span class="p">])</span>

<span class="c1"># Centralizer N(S): set of Paulis commuting with both S1 and S2</span>
<span class="c1"># We&#39;ll enumerate all 4-qubit Paulis ignoring phase</span>
<span class="n">P4</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">paulis</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">centralizer</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">P4</span> <span class="k">if</span> <span class="n">commute</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">S1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commute</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">S2</span><span class="p">)])</span>

<span class="n">len_G_state</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_state</span><span class="p">)</span>
<span class="n">len_centralizer</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">centralizer</span><span class="p">)</span>
<span class="n">len_G_state</span><span class="p">,</span> <span class="n">len_centralizer</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_state</span> <span class="o">-</span> <span class="n">centralizer</span><span class="p">)</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#5</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>&#39;&#39;
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#6</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>

<span class="n">paulis</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
<span class="n">anti_pairs</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">),(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">)}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">commute</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="n">anti</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="s1">&#39;I&#39;</span> <span class="ow">or</span> <span class="n">b</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="n">b</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="n">anti_pairs</span><span class="p">:</span>
            <span class="n">anti</span> <span class="o">^=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">anti</span><span class="o">==</span><span class="mi">0</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_group</span><span class="p">(</span><span class="n">generators</span><span class="p">):</span>
    <span class="n">G</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;I&#39;</span><span class="o">*</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">changed</span><span class="p">:</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="p">):</span>
                <span class="n">prod</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">h</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">b</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">a</span><span class="o">==</span><span class="n">b</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">m</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span>
                            <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
                            <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span>
                        <span class="p">}</span>
                        <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)])</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">G</span><span class="p">:</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                    <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">G</span>


<span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
    <span class="n">prod</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">b</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">a</span><span class="o">==</span><span class="n">b</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">{</span>
                <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span>
            <span class="p">}</span>
            <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)])</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>

<span class="n">S1</span> <span class="o">=</span> <span class="s1">&#39;XXXX&#39;</span><span class="p">;</span> <span class="n">S2</span> <span class="o">=</span> <span class="s1">&#39;ZZZZ&#39;</span>
<span class="n">X_A</span> <span class="o">=</span> <span class="s1">&#39;XIXI&#39;</span><span class="p">;</span> <span class="n">X_B</span> <span class="o">=</span> <span class="s1">&#39;XXII&#39;</span><span class="p">;</span> <span class="n">Z_A</span> <span class="o">=</span> <span class="s1">&#39;ZZII&#39;</span><span class="p">;</span> <span class="n">Z_B</span> <span class="o">=</span> <span class="s1">&#39;ZIZI&#39;</span>
<span class="n">L1</span> <span class="o">=</span> <span class="n">multiply</span><span class="p">(</span><span class="n">X_A</span><span class="p">,</span> <span class="n">X_B</span><span class="p">)</span>
<span class="n">L2</span> <span class="o">=</span> <span class="n">multiply</span><span class="p">(</span><span class="n">Z_A</span><span class="p">,</span> <span class="n">Z_B</span><span class="p">)</span>

<span class="n">G_state</span> <span class="o">=</span> <span class="n">generate_group</span><span class="p">([</span><span class="n">S1</span><span class="p">,</span><span class="n">S2</span><span class="p">,</span><span class="n">L1</span><span class="p">,</span><span class="n">L2</span><span class="p">])</span>
<span class="n">P4</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">product</span><span class="p">([</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">centralizer</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">P4</span> <span class="k">if</span> <span class="n">commute</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">S1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commute</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">S2</span><span class="p">)])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sizes:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">G_state</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">centralizer</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;L1:&#39;</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="s1">&#39;L2:&#39;</span><span class="p">,</span> <span class="n">L2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;G_state subset centralizer?&#39;</span><span class="p">,</span> <span class="n">G_state</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">centralizer</span><span class="p">))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#7</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code><span class="n">Sizes</span><span class="o">:</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="mi">64</span>
<span class="n">L1</span><span class="o">:</span><span class="w"> </span><span class="n">IXXI</span><span class="w"> </span><span class="n">L2</span><span class="o">:</span><span class="w"> </span><span class="n">IZZI</span>
<span class="n">G_state</span><span class="w"> </span><span class="n">subset</span><span class="w"> </span><span class="n">centralizer</span><span class="o">?</span><span class="w"> </span><span class="n">True</span>
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#8</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>

<span class="n">paulis</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
<span class="n">anti_pairs</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">),(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">)}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">commute</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="n">anti</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="s1">&#39;I&#39;</span> <span class="ow">or</span> <span class="n">b</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="n">b</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="n">anti_pairs</span><span class="p">:</span>
            <span class="n">anti</span> <span class="o">^=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">anti</span><span class="o">==</span><span class="mi">0</span>


<span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
    <span class="n">prod</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">b</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">a</span><span class="o">==</span><span class="n">b</span><span class="p">:</span> <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">{</span>
                <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span>
            <span class="p">}</span>
            <span class="n">prod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)])</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>

<span class="c1"># Define code elements</span>
<span class="n">S1</span> <span class="o">=</span> <span class="s1">&#39;XXXX&#39;</span><span class="p">;</span> <span class="n">S2</span> <span class="o">=</span> <span class="s1">&#39;ZZZZ&#39;</span>
<span class="n">X_A</span> <span class="o">=</span> <span class="s1">&#39;XIXI&#39;</span><span class="p">;</span> <span class="n">X_B</span> <span class="o">=</span> <span class="s1">&#39;XXII&#39;</span><span class="p">;</span> <span class="n">Z_A</span> <span class="o">=</span> <span class="s1">&#39;ZZII&#39;</span><span class="p">;</span> <span class="n">Z_B</span> <span class="o">=</span> <span class="s1">&#39;ZIZI&#39;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">gen_group</span><span class="p">(</span><span class="n">gens</span><span class="p">):</span>
    <span class="n">G</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;I&#39;</span><span class="o">*</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">frontier</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="o">*</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">frontier</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">frontier</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gens</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">multiply</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">h</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">G</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
                <span class="n">frontier</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">G</span>

<span class="n">L1</span> <span class="o">=</span> <span class="n">multiply</span><span class="p">(</span><span class="n">X_A</span><span class="p">,</span> <span class="n">X_B</span><span class="p">)</span>
<span class="n">L2</span> <span class="o">=</span> <span class="n">multiply</span><span class="p">(</span><span class="n">Z_A</span><span class="p">,</span> <span class="n">Z_B</span><span class="p">)</span>
<span class="n">G_state</span> <span class="o">=</span> <span class="n">gen_group</span><span class="p">([</span><span class="n">S1</span><span class="p">,</span><span class="n">S2</span><span class="p">,</span><span class="n">L1</span><span class="p">,</span><span class="n">L2</span><span class="p">])</span>

<span class="c1"># Construct 2-qubit Paulis for a given ordered pair tuple (u,v) -&gt; indices order in 4-qubit string</span>
<span class="n">P2</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">paulis</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">paulis</span><span class="p">]</span>

<span class="c1"># Map pair Paul&#39;s to 4-qubit string for (2,1) and (0,3)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">embed_21</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">p</span>  <span class="c1"># a on qubit2, b on qubit1</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">embed_03</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">p</span>  <span class="c1"># a on qubit0, b on qubit3</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>

<span class="c1"># Prepare sets</span>
<span class="n">accepted</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">p21</span> <span class="ow">in</span> <span class="n">P2</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">p03</span> <span class="ow">in</span> <span class="n">P2</span><span class="p">:</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">multiply</span><span class="p">(</span><span class="n">embed_03</span><span class="p">(</span><span class="n">p03</span><span class="p">),</span> <span class="n">embed_21</span><span class="p">(</span><span class="n">p21</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">commute</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="n">S1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commute</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="n">S2</span><span class="p">):</span>
            <span class="n">accepted</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">p21</span><span class="p">,</span><span class="n">p03</span><span class="p">,</span><span class="n">E</span><span class="p">))</span>

<span class="c1"># Compute counts per category</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>

<span class="c1"># For counting weights: categories n_err = #(pair non-identity)</span>
<span class="n">counts_accept</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
<span class="n">counts_good</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>

<span class="k">for</span> <span class="n">p21</span> <span class="ow">in</span> <span class="n">P2</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">p03</span> <span class="ow">in</span> <span class="n">P2</span><span class="p">:</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">multiply</span><span class="p">(</span><span class="n">embed_03</span><span class="p">(</span><span class="n">p03</span><span class="p">),</span> <span class="n">embed_21</span><span class="p">(</span><span class="n">p21</span><span class="p">))</span>
        <span class="n">n_err</span> <span class="o">=</span> <span class="p">(</span><span class="n">p21</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">p03</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">commute</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="n">S1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commute</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="n">S2</span><span class="p">):</span>
            <span class="n">counts_accept</span><span class="p">[</span><span class="n">n_err</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">G_state</span><span class="p">:</span>
                <span class="n">counts_good</span><span class="p">[</span><span class="n">n_err</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Counts accept by n_err:&#39;</span><span class="p">,</span> <span class="n">counts_accept</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Counts good by n_err:&#39;</span><span class="p">,</span> <span class="n">counts_good</span><span class="p">)</span>

<span class="c1"># Also total counts, to sanity-check</span>
<span class="n">total</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="mi">15</span> <span class="o">+</span> <span class="mi">15</span><span class="o">*</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">15</span><span class="o">*</span><span class="mi">15</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total combos per n_err:&#39;</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>

<span class="c1"># Now compute polynomial coefficients for acceptance and good probabilities</span>
<span class="c1"># acceptance probability =</span>
<span class="c1">#   (1-p)^2 * counts_accept[0] </span>
<span class="c1"># +  (1-p)*(p/15) * counts_accept[1]   [since there are counts_accept[1] distinct pairs overall]</span>
<span class="c1"># +  (p/15)^2 * counts_accept[2]</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">fractions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fraction</span>

<span class="n">counts_accept</span><span class="p">,</span> <span class="n">counts_good</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#9</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>Counts accept by n_err: {0: 1, 1: 6, 2: 57}
Counts good by n_err: {0: 1, 1: 6, 2: 9}
Total combos per n_err: {0: 1, 1: 30, 2: 225}
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#10</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Acc</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="mi">57</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="n">Good</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">Good</span><span class="o">/</span><span class="n">Acc</span><span class="p">)</span>
<span class="n">Acc_simplified</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="n">Acc</span><span class="p">))</span>
<span class="n">Good_simplified</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="n">Good</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Acc(p) =&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">Acc_simplified</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Good(p)=&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">Good_simplified</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;F(p)   =&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">F</span><span class="p">)))</span>
<span class="c1"># Also expand to get polynomial forms</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Acc expanded:&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">Acc</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Good expanded:&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">Good</span><span class="p">))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#11</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>Acc(p) = (64*p**2 - 120*p + 75)/75
Good(p)= (4*p - 5)**2/25
F(p)   = 3*(16*p**2 - 40*p + 25)/(64*p**2 - 120*p + 75)
Acc expanded: 64*p**2/75 - 8*p/5 + 1
Good expanded: 16*p**2/25 - 8*p/5 + 1
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#12</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="n">p</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">16</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">40</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="mi">25</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">64</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">120</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="mi">75</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#13</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">16</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mf">2</span><span class="o">/</span><span class="mf">75</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">O</span><span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="mf">3</span><span class="p">)</span>
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#14</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>
<span class="n">paulis</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">parity_class</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">p</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_x_or_y</span><span class="p">(</span><span class="n">c</span><span class="p">):</span> <span class="k">return</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_z_or_y</span><span class="p">(</span><span class="n">c</span><span class="p">):</span> <span class="k">return</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">xpar</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">is_x_or_y</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">is_x_or_y</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">zpar</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">is_z_or_y</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">is_z_or_y</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">xpar</span><span class="o">%</span><span class="mi">2</span><span class="p">,</span> <span class="n">zpar</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>

<span class="n">P2</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">paulis</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">paulis</span><span class="p">]</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>
<span class="n">cnt</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">parity_class</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">P2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Parity counts including II:&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cnt</span><span class="p">))</span>
<span class="c1"># Remove identity</span>
<span class="n">cnt_nonid</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">parity_class</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">P2</span> <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Parity counts non-id:&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cnt_nonid</span><span class="p">))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#15</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>Parity counts including II: {(0, 0): 4, (1, 0): 4, (1, 1): 4, (0, 1): 4}
Parity counts non-id: {(1, 0): 4, (1, 1): 4, (0, 1): 4, (0, 0): 3}
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#16</span>
    </div>
    <div class="content markdown-body"><ol>
<li>Step-by-Step Derivation</li>
</ol>
<ul>
<li>Setup and target</li>
<li>Stabilizers: S = âŸ¨S1, S2âŸ© with S1 = XXXX, S2 = ZZZZ.</li>
<li>Logical operators (one valid choice): X_A = XIXI, X_B = XXII, Z_A = ZZII, Z_B = ZIZI.</li>
<li>Target logical state: the logical Bell state (|00âŸ©<em>{AB} + |11âŸ©</em>{AB})/âˆš2, stabilized (at the logical level) by X_A X_B and Z_A Z_B.</li>
<li>
<p>Circuit: H_2 â†’ CNOT_{21} â†’ H_0 â†’ CNOT_{03}. Noise: after each CNOT, a 2-qubit depolarizing channel acts on that pair:</p>
<ul>
<li>On pair (2,1) after CNOT_{21}.</li>
<li>On pair (0,3) after CNOT_{03}.</li>
<li>Each error is a 2-qubit Pauli chosen uniformly from the 15 non-identity elements with probability p/15; identity with probability 1âˆ’p.</li>
</ul>
</li>
<li>
<p>Ideal state after the noiseless circuit</p>
</li>
<li>The circuit prepares |Î¦^+âŸ©<em>{03} âŠ— |Î¦^+âŸ©</em>{21}, where |Î¦^+âŸ© = (|00âŸ©+|11âŸ©)/âˆš2.</li>
<li>
<p>This state lies in the [[4,2,2]] codespace (it is stabilized by S1 = XXXX and S2 = ZZZZ) and implements the logical Bell state (|00âŸ©<em>{AB}+|11âŸ©</em>{AB})/âˆš2.</p>
</li>
<li>
<p>Post-selection criterion (error detection)</p>
</li>
<li>
<p>Post-select on trivial syndrome, i.e., accept only errors E that commute with both S1 and S2. Equivalently, E must lie in the normalizer N(S) of the stabilizer S.</p>
</li>
<li>
<p>Logical fidelity conditional on acceptance</p>
</li>
<li>Let P_acc be the total acceptance probability (sum over all error events that commute with S).</li>
<li>Let P_good be the probability that the final state equals the target logical state (i.e., error lies in the stabilizer group of the target physical state). Then the logical state fidelity conditioned on acceptance is</li>
</ul>
<div class="arithmatex">\[
F_{\text{logical}}(p) = \frac{P_{\text{good}}(p)}{P_{\text{acc}}(p)}.
\]</div>
<ul>
<li>Classifying two-qubit Paulis on a pair by X/Z parities</li>
<li>For a 2-qubit Pauli Q on a pair, define parities:<ul>
<li>x-parity = number of X or Y on the two qubits mod 2,</li>
<li>z-parity = number of Z or Y on the two qubits mod 2.</li>
</ul>
</li>
<li>Among the 16 elements on a pair (including II), the counts by (x,z)-parity classes are:<ul>
<li>(0,0): 4 elements (one is II, the other three are XX, YY, ZZ),</li>
<li>(1,0): 4 elements,</li>
<li>(0,1): 4 elements,</li>
<li>(1,1): 4 elements.</li>
</ul>
</li>
<li>Acceptance condition for the 4-qubit error E = E_{21} âŠ— E_{03}: E commutes with S1=XXXX iff the total z-parity across all four qubits is even; commutes with S2=ZZZZ iff the total x-parity is even. Hence E is accepted iff the pair parities match componentwise:</li>
</ul>
<div class="arithmatex">\[
x_{21}\equiv x_{03}\ (\text{mod }2),\quad z_{21}\equiv z_{03}\ (\text{mod }2).
\]</div>
<ul>
<li>Counting accepted and â€œgoodâ€ events by number of faults</li>
<li>There are at most two faulty locations (after each CNOT).</li>
<li>n_err = 0 (no error): 1 combination (II on each pair); accepted and good.</li>
<li>n_err = 1 (exactly one non-identity on one pair):<ul>
<li>Accepted iff the single non-identity lies in the (0,0) class, i.e., it is one of {XX, YY, ZZ} on that pair.</li>
<li>There are 3 such on pair (2,1) and 3 on pair (0,3): total 6 accepted.</li>
<li>All 6 are also â€œgood,â€ since XX, YY, ZZ on a Bell pair stabilize |Î¦^+âŸ© (up to phase), and the overall physical state remains the ideal one.</li>
</ul>
</li>
<li>n_err = 2 (non-identity on both pairs):<ul>
<li>Acceptance requires the parity classes to match: number of accepted combinations</li>
</ul>
</li>
</ul>
<div class="arithmatex">\[
4\cdot 4 + 4\cdot 4 + 4\cdot 4 + 3\cdot 3 = 57.
\]</div>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="nx">Explanation</span><span class="p">:</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">classes</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="nx">there</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="nx">choices</span><span class="w"> </span><span class="nx">per</span><span class="w"> </span><span class="nx">pair</span><span class="p">;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="nx">there</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nx">non</span><span class="o">-</span><span class="nx">identity</span><span class="w"> </span><span class="nx">choices</span><span class="w"> </span><span class="nx">per</span><span class="w"> </span><span class="nx">pair</span><span class="p">.</span>
<span class="o">-</span><span class="w"> </span><span class="err">â€œ</span><span class="nx">Good</span><span class="err">â€</span><span class="w"> </span><span class="nx">requires</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="nx">pair</span><span class="err">â€™</span><span class="nx">s</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">{</span><span class="nx">XX</span><span class="p">,</span><span class="w"> </span><span class="nx">YY</span><span class="p">,</span><span class="w"> </span><span class="nx">ZZ</span><span class="p">},</span><span class="w"> </span><span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.,</span><span class="w"> </span><span class="mi">3</span><span class="err">Ã—</span><span class="mi">3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="nx">combinations</span><span class="p">.</span><span class="w"> </span><span class="nx">These</span><span class="w"> </span><span class="nx">map</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="nx">Bell</span><span class="err">Ã—</span><span class="nx">Bell</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">itself</span><span class="w"> </span><span class="p">(</span><span class="nx">up</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">phase</span><span class="p">).</span>
</code></pre></div>

<ul>
<li>Probabilities and weights under the noise model</li>
<li>For each pair: P(II) = 1âˆ’p; P(Qâ‰ II) = p/15 for each of 15 non-identity elements.</li>
<li>Therefore:<ul>
<li>Acceptance probability:</li>
</ul>
</li>
</ul>
<div class="arithmatex">\[
      P_{\text{acc}}(p) &amp;= (1-p)^2\cdot 1 \\
      &amp;\quad + 2\,(1-p)\,(p/15)\cdot 3 \\
      &amp;\quad + (p/15)^2 \cdot 57 \\
      &amp;= 1 - \frac{8}{5}p + \frac{64}{75}p^2.
\]</div>
<div class="codehilite"><pre><span></span><code>- â€œGoodâ€ probability:
</code></pre></div>

<div class="arithmatex">\[
      P_{\text{good}}(p) &amp;= (1-p)^2\cdot 1 \\
      &amp;\quad + 2\,(1-p)\,(p/15)\cdot 3 \\
      &amp;\quad + (p/15)^2 \cdot 9 \\
      &amp;= \left(1 - \frac{4}{5}p\right)^2.
\]</div>
<div class="codehilite"><pre><span></span><code>  Note P_good equals the physical-state fidelity from Subproblem 1, because the state is a tensor product of two Bell pairs and â€œgoodâ€ requires each pair to remain in |Î¦^+âŸ© (up to phase).
</code></pre></div>

<ul>
<li>Logical fidelity conditioned on acceptance</li>
</ul>
<div class="arithmatex">\[
F_{\text{logical}}(p) \;=\; \frac{P_{\text{good}}(p)}{P_{\text{acc}}(p)} \;=\; \frac{1 - \frac{8}{5}p + \frac{16}{25}p^2}{1 - \frac{8}{5}p + \frac{64}{75}p^2}.
\]</div>
<p>A compact equivalent form:</p>
<div class="arithmatex">\[
F_{\text{logical}}(p) \;=\; \frac{48p^2 - 120p + 75}{64p^2 - 120p + 75} \;=\; 1 - \frac{16p^2}{64p^2 - 120p + 75}.
\]</div>
<p>Small-p expansion: <span class="arithmatex">\(F_{\text{logical}}(p) = 1 - \frac{16}{75}p^2 + O(p^3)\)</span> (no linear term, as all accepted single-fault events are harmless).</p>
<ol start="2">
<li>Mathematical Typesetting</li>
</ol>
<ul>
<li>All expressions above are written in LaTeX.</li>
</ul>
<ol start="3">
<li>Conventions and Units</li>
</ol>
<ul>
<li>Qubit ordering: (0,1,2,3).</li>
<li>Noise: two-qubit depolarizing after each CNOT, independent across the two pairs (2,1) and (0,3), with parameter p.</li>
</ul>
<ol start="4">
<li>Final Answer:
F_logical(p) = (1 - 8p/5 + 16p^2/25)/(1 - 8p/5 + 64p^2/75) = (48p^2 - 120p + 75)/(64p^2 - 120p + 75).</li>
</ol></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#17</span>
    </div>
    <div class="content markdown-body"><p>The correct answer is:
$
F_{\rm{logical}}=1 - \frac{\frac{16}{75}p^2}{1-\frac{8}{5}p + \frac{64}{75}p^2}
$</p>
<p>Now let&rsquo;s solve the next Checkpoint.</p>
<h2 id="subproblem-3">Checkpoint 3</h2>
<p>Suppose that we prepare a logical two-qubit <span class="arithmatex">\(|00\rangle_{AB}\)</span> state in the [[4,2,2]] code. To do so, we introduce an ancilla qubit, qubit 4, and use the following state preparation circuit:</p>
<div class="arithmatex">\[
M_4 (CNOT_{04}) (CNOT_{34}) (CNOT_{23}) (CNOT_{10}) (CNOT_{12}) (H_1)
\]</div>
<p>Note that this equation is written in matrix multiplication order, while the quantum operations in the circuit occur in the reverse order (from right-to-left in the above equation). <span class="arithmatex">\(H\)</span> is a single-qubit Hadamard gate and <span class="arithmatex">\(M\)</span> is a single-qubit measurement. The ancilla is used to detect errors in the state preparation circuit and makes the circuit fault-tolerant. If the ancilla measurement is <span class="arithmatex">\(|0\rangle\)</span> (<span class="arithmatex">\(|1\rangle\)</span>), the state preparation succeeds (fails).</p>
<p>What is the logical state fidelity of the final 2-qubit logical state at the end of the circuit as a function of two-qubit gate error rate <span class="arithmatex">\(p\)</span>, assuming the state is post-selected on all detectable errors in the code and on the ancilla qubit measuring <span class="arithmatex">\(|0\rangle\)</span>?</p></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#18</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>

<span class="c1"># Define Pauli group operations ignoring phase</span>
<span class="n">paulis</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
<span class="n">mult_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">):</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;I&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Multiplication ignoring phase on strings</span>

<span class="k">def</span><span class="w"> </span><span class="nf">pmul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mult_map</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>

<span class="c1"># Conjugation by CNOT(c,t) on a 5-qubit Pauli string s</span>

<span class="k">def</span><span class="w"> </span><span class="nf">cnot_conj</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="c1"># Rules: X_c -&gt; X_c X_t; Z_t -&gt; Z_c Z_t; Y_c -&gt; Y_c X_t; Y_t -&gt; Z_c Y_t</span>
    <span class="c1"># We implement by updating characters appropriately; need to combine if both changes apply</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">combine</span><span class="p">(</span><span class="n">qubit</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="n">s</span><span class="p">[</span><span class="n">qubit</span><span class="p">]</span> <span class="o">=</span> <span class="n">mult_map</span><span class="p">[(</span><span class="n">s</span><span class="p">[</span><span class="n">qubit</span><span class="p">],</span> <span class="n">p</span><span class="p">)]</span>
    <span class="c1"># Apply effect for control</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
        <span class="n">combine</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
        <span class="n">combine</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">)</span>  <span class="c1"># Y_c carries X on c and Z on c; effect on target same as X on control</span>
    <span class="c1"># Apply effect for target</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span>
        <span class="n">combine</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
        <span class="n">combine</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># Conjugation by H on qubit q: X&lt;-&gt;Z, Y -&gt; -Y (ignore phase so Y stays Y)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">h_conj</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
        <span class="n">s</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Z&#39;</span>
    <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span>
        <span class="n">s</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span>
    <span class="c1"># Y remains Y ignoring phase</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># Build mapping: final error from each inserted error after a given CNOT</span>
<span class="c1"># Circuit order (right-to-left):</span>
<span class="c1"># 1) H_1</span>
<span class="c1"># 2) CNOT_12</span>
<span class="c1"># 3) CNOT_10</span>
<span class="c1"># 4) CNOT_23</span>
<span class="c1"># 5) CNOT_34</span>
<span class="c1"># 6) CNOT_04</span>
<span class="c1"># 7) M_4</span>

<span class="c1"># We will define a function that, given a list of 5 two-qubit Pauli errors e2,e3,e4,e5,e6 (strings like &#39;IX&#39; on the pair),</span>
<span class="c1"># computes the final 5-qubit Pauli string.</span>

<span class="c1"># Helper to embed a two-qubit Pauli on qubits (i,j) into 5-qubit string</span>

<span class="k">def</span><span class="w"> </span><span class="nf">embed_ij</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span>
    <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># Apply conjugation function for the remainder of the circuit</span>

<span class="k">def</span><span class="w"> </span><span class="nf">propagate_to_end</span><span class="p">(</span><span class="n">err_after_gate_index</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="c1"># err_after_gate_index in {2,3,4,5,6}</span>
    <span class="c1"># P is a 5-qubit Pauli string representing an error that occurs just after that gate</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">P</span>
    <span class="c1"># Conjugate by the subsequent gates in chronological order: next indices &gt; err_after_gate_index</span>
    <span class="k">if</span> <span class="n">err_after_gate_index</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">cnot_conj</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># gate 3: CNOT_10</span>
    <span class="k">if</span> <span class="n">err_after_gate_index</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">cnot_conj</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># gate 4: CNOT_23</span>
    <span class="k">if</span> <span class="n">err_after_gate_index</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">cnot_conj</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># gate 5: CNOT_34</span>
    <span class="k">if</span> <span class="n">err_after_gate_index</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">cnot_conj</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># gate 6: CNOT_04</span>
    <span class="c1"># No conjugation by measurement</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="c1"># Let&#39;s verify conj functions by random tests (omitted for brevity)</span>

<span class="c1"># Stabilizers for data qubits 0..3</span>
<span class="n">S1</span> <span class="o">=</span> <span class="s1">&#39;XXXX&#39;</span>
<span class="n">S2</span> <span class="o">=</span> <span class="s1">&#39;ZZZZ&#39;</span>

<span class="c1"># Centralizer predicate for data 0..3</span>
<span class="n">anti_pairs</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">),(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">)}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">commute</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="c1"># p, q are 4-qubit strings</span>
    <span class="n">anti</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">==</span><span class="s1">&#39;I&#39;</span> <span class="ow">or</span> <span class="n">b</span><span class="o">==</span><span class="s1">&#39;I&#39;</span> <span class="ow">or</span> <span class="n">a</span><span class="o">==</span><span class="n">b</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="n">anti_pairs</span><span class="p">:</span>
            <span class="n">anti</span> <span class="o">^=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">anti</span><span class="o">==</span><span class="mi">0</span>

<span class="c1"># Generate group of target codeword stabilizer: &lt;S1,S2, Z_A, Z_B&gt;</span>
<span class="n">X_A</span> <span class="o">=</span> <span class="s1">&#39;XIXI&#39;</span><span class="p">;</span> <span class="n">X_B</span> <span class="o">=</span> <span class="s1">&#39;XXII&#39;</span><span class="p">;</span> <span class="n">Z_A</span> <span class="o">=</span> <span class="s1">&#39;ZZII&#39;</span><span class="p">;</span> <span class="n">Z_B</span> <span class="o">=</span> <span class="s1">&#39;ZIZI&#39;</span>

<span class="c1"># Multiply 4-qubit ignoring phase</span>
<span class="n">mult4</span> <span class="o">=</span> <span class="n">mult_map</span>

<span class="k">def</span><span class="w"> </span><span class="nf">pmul4</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mult4</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_group</span><span class="p">(</span><span class="n">gens</span><span class="p">):</span>
    <span class="n">G</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;I&#39;</span><span class="o">*</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">frontier</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="o">*</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">frontier</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">frontier</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gens</span><span class="p">:</span>
            <span class="n">nh</span> <span class="o">=</span> <span class="n">pmul4</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nh</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">G</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">nh</span><span class="p">)</span>
                <span class="n">frontier</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nh</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">G</span>

<span class="n">state_stab</span> <span class="o">=</span> <span class="n">generate_group</span><span class="p">([</span><span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">Z_A</span><span class="p">,</span> <span class="n">Z_B</span><span class="p">])</span>  <span class="c1"># size should be 16</span>
<span class="n">centralizer</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">paulis</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">commute</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">S1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commute</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">S2</span><span class="p">):</span>
        <span class="n">centralizer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="c1"># Now enumerate all 16^5 combinations</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">paulis</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span>  <span class="c1"># two-qubit Paulis on a pair</span>

<span class="c1"># Precompute mapping for each location and pair Pauli to final 5-qubit Pauli</span>
<span class="n">locations</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">2</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>  <span class="c1"># CNOT_12</span>
    <span class="mi">3</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>  <span class="c1"># CNOT_10</span>
    <span class="mi">4</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>  <span class="c1"># CNOT_23</span>
    <span class="mi">5</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>  <span class="c1"># CNOT_34</span>
    <span class="mi">6</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>  <span class="c1"># CNOT_04</span>
<span class="p">}</span>

<span class="n">maps</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">locations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
        <span class="n">emb</span> <span class="o">=</span> <span class="n">embed_ij</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="n">maps</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">pair</span><span class="p">]</span> <span class="o">=</span> <span class="n">propagate_to_end</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">emb</span><span class="p">)</span>

<span class="c1"># Now enumerate tuples (e2,e3,e4,e5,e6)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="n">counts_accept</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">counts_good</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">counts_tot</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="k">for</span> <span class="n">e2</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">e3</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">e4</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e5</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">e6</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
                    <span class="c1"># Compute final Pauli as product (order doesn&#39;t matter up to phase)</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;I&#39;</span><span class="o">*</span><span class="mi">5</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span><span class="n">e2</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="n">e3</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="n">e4</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="n">e5</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="n">e6</span><span class="p">)]:</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="n">pmul</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">maps</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">e</span><span class="p">])</span>
                    <span class="c1"># Split data and ancilla</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
                    <span class="n">anc</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                    <span class="c1"># Accept if anc in {I,Z} and data in centralizer</span>
                    <span class="n">accept</span> <span class="o">=</span> <span class="p">(</span><span class="n">anc</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">data</span> <span class="ow">in</span> <span class="n">centralizer</span><span class="p">)</span>
                    <span class="c1"># Good if accept and data in state_stab</span>
                    <span class="n">good</span> <span class="o">=</span> <span class="n">accept</span> <span class="ow">and</span> <span class="p">(</span><span class="n">data</span> <span class="ow">in</span> <span class="n">state_stab</span><span class="p">)</span>
                    <span class="c1"># Count by m = number of non-identity errors</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">e2</span><span class="o">!=</span><span class="s1">&#39;II&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">e3</span><span class="o">!=</span><span class="s1">&#39;II&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">e4</span><span class="o">!=</span><span class="s1">&#39;II&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">e5</span><span class="o">!=</span><span class="s1">&#39;II&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">e6</span><span class="o">!=</span><span class="s1">&#39;II&#39;</span><span class="p">)</span>
                    <span class="n">counts_tot</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">accept</span><span class="p">:</span>
                        <span class="n">counts_accept</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">good</span><span class="p">:</span>
                        <span class="n">counts_good</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1"># Print summaries</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total combinations per m (should be C(5,m)*15^m):&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">counts_tot</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accepted counts per m:&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">counts_accept</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Good counts per m:&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">counts_good</span><span class="p">))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#19</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>Total combinations per m (should be C(5,m)*15^m):
0 1
1 75
2 2250
3 33750
4 253125
5 759375
Accepted counts per m: {0: 1, 1: 7, 2: 282, 3: 4222, 4: 31637, 5: 94923}
Good counts per m: {0: 1, 1: 7, 2: 138, 3: 1198, 4: 7397, 5: 24027}
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#20</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Counts from enumeration</span>
<span class="n">counts_accept</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">282</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4222</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">31637</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">94923</span><span class="p">}</span>
<span class="n">counts_good</span>   <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">138</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">1198</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">7397</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">24027</span><span class="p">}</span>

<span class="n">Acc</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Good</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">cA</span> <span class="o">=</span> <span class="n">counts_accept</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">cG</span> <span class="o">=</span> <span class="n">counts_good</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">term</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">5</span><span class="o">-</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span><span class="o">**</span><span class="n">m</span>
    <span class="n">Acc</span> <span class="o">+=</span> <span class="n">cA</span> <span class="o">*</span> <span class="n">term</span>
    <span class="n">Good</span> <span class="o">+=</span> <span class="n">cG</span> <span class="o">*</span> <span class="n">term</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">Good</span><span class="o">/</span><span class="n">Acc</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Acc(p) =&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">Acc</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Good(p)=&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">Good</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;F_logical(p)=&#39;</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Series small p:&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#21</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>Acc(p) = (-262144*p**5 + 1269760*p**4 - 2457600*p**3 + 2376000*p**2 - 1147500*p + 253125)/253125
Good(p)= (-229376*p**5 + 1116160*p**4 - 2198400*p**3 + 2214000*p**2 - 1147500*p + 253125)/253125
F_logical(p)= (229376*p**5 - 1116160*p**4 + 2198400*p**3 - 2214000*p**2 + 1147500*p - 253125)/(262144*p**5 - 1269760*p**4 + 2457600*p**3 - 2376000*p**2 + 1147500*p - 253125)
Series small p: 1 - 16*p**2/25 - 704*p**3/375 + O(p**4)
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#22</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="n">p</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">num</span> <span class="o">=</span> <span class="mi">229376</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">1116160</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2198400</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2214000</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1147500</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="mi">253125</span>
<span class="n">den</span> <span class="o">=</span> <span class="mi">262144</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">1269760</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2457600</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2376000</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1147500</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="mi">253125</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Factor numerator:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Factor denominator:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="n">den</span><span class="p">))</span>

<span class="c1"># Try to factor out (1 - 4p/5)^2 maybe? Let&#39;s divide Good and Acc by (1 - a p)^k etc</span>
<span class="n">cand</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sp</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Divide polynomials by (1 - 4p/5)^2:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">num</span><span class="o">/</span><span class="n">cand</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">den</span><span class="o">/</span><span class="n">cand</span><span class="p">)))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#23</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>Factor numerator:
229376*p**5 - 1116160*p**4 + 2198400*p**3 - 2214000*p**2 + 1147500*p - 253125
Factor denominator:
(128*p**2 - 300*p + 225)*(2048*p**3 - 5120*p**2 + 3600*p - 1125)
Divide polynomials by (1 - 4p/5)^2:
25*(229376*p**5 - 1116160*p**4 + 2198400*p**3 - 2214000*p**2 + 1147500*p - 253125)/(4*p - 5)**2
25*(262144*p**5 - 1269760*p**4 + 2457600*p**3 - 2376000*p**2 + 1147500*p - 253125)/(4*p - 5)**2
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#24</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">counts_accept</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">282</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4222</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">31637</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">94923</span><span class="p">}</span>
<span class="n">counts_good</span>   <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">138</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">1198</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">7397</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">24027</span><span class="p">}</span>

<span class="n">Acc</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Good</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">Acc</span> <span class="o">+=</span> <span class="n">counts_accept</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">5</span><span class="o">-</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span><span class="o">**</span><span class="n">m</span>
    <span class="n">Good</span> <span class="o">+=</span> <span class="n">counts_good</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">5</span><span class="o">-</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span><span class="o">**</span><span class="n">m</span>
<span class="n">Delta</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">Acc</span> <span class="o">-</span> <span class="n">Good</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Delta(p) =&#39;</span><span class="p">,</span> <span class="n">Delta</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Factor Delta:&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">Delta</span><span class="p">))))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Series small p:&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">Delta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#25</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>Delta(p) = 16*p**2*(-2048*p**3 + 9600*p**2 - 16200*p + 10125)/253125
Factor Delta: -16*p**2*(8*p - 15)*(256*p**2 - 720*p + 675)/253125
Series small p: 16*p**2/25 - 128*p**3/125 + O(p**4)
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#26</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="n">p</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">Good</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">229376</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">1116160</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">2198400</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">2214000</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1147500</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="mi">253125</span><span class="p">)</span><span class="o">/</span><span class="mi">253125</span>
<span class="n">Acc</span>  <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">262144</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">1269760</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">2457600</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">2376000</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1147500</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="mi">253125</span><span class="p">)</span><span class="o">/</span><span class="mi">253125</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Factor Good numerator positive:&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="o">-</span><span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">Good</span><span class="o">*</span><span class="mi">253125</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Factor Acc numerator positive:&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="o">-</span><span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">Acc</span><span class="o">*</span><span class="mi">253125</span><span class="p">)))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#27</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>Factor Good numerator positive: 229376*p**5 - 1116160*p**4 + 2198400*p**3 - 2214000*p**2 + 1147500*p - 253125
Factor Acc numerator positive: (128*p**2 - 300*p + 225)*(2048*p**3 - 5120*p**2 + 3600*p - 1125)
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#28</span>
    </div>
    <div class="content markdown-body"><ol>
<li>Step-by-Step Derivation</li>
</ol>
<ul>
<li>Code, circuit, and noise</li>
<li>[[4,2,2]] code with stabilizers S = âŸ¨S1, S2âŸ©, S1 = XXXX, S2 = ZZZZ.</li>
<li>Logical operators (one valid choice): X_A = XIXI, X_B = XXII, Z_A = ZZII, Z_B = ZIZI.</li>
<li>Target logical state: |00âŸ©_{AB}, stabilized (within the codespace) by S together with Z_A and Z_B.</li>
<li>Circuit (right-to-left execution): H_1 â†’ CNOT_{12} â†’ CNOT_{10} â†’ CNOT_{23} â†’ CNOT_{34} â†’ CNOT_{04} â†’ measure Z on ancilla 4.</li>
<li>
<p>Noise: after each CNOT, a two-qubit depolarizing channel on that pair:</p>
<ul>
<li>Pairs in order: (1,2), (1,0), (2,3), (3,4), (0,4).</li>
<li>Each such channel applies II with probability (1âˆ’p), and one of the 15 non-identity two-qubit Paulis with probability p/15, independently.</li>
</ul>
</li>
<li>
<p>Post-selection (acceptance) criteria</p>
</li>
<li>Code post-selection: final data-qubit error E_data must commute with both S1 and S2 (i.e., E_data âˆˆ N(S), the normalizer of S).</li>
<li>
<p>Ancilla post-selection: the measured ancilla outcome must be |0âŸ©. In the Pauli picture, this is equivalent to requiring that the final Pauli on qubit 4 is in {I, Z} (X or Y on the ancilla flips the Z-measurement bit).</p>
</li>
<li>
<p>â€œGoodâ€ events (logical fidelity)</p>
</li>
<li>
<p>Among accepted events, the final 4-qubit data error must stabilize the target logical state |00âŸ©<em>{AB}. The stabilizer of |00âŸ©</em>{AB} is G_target = âŸ¨S1, S2, Z_A, Z_BâŸ© (size 16 ignoring phases). Any accepted error in G_target leaves the logical state unchanged; accepted errors in N(S)\G_target implement logical flips (e.g., X_A, X_B, â€¦) and are â€œbad.â€</p>
</li>
<li>
<p>Clifford/Pauli propagation and exhaustive counting</p>
</li>
<li>Because the circuit is Clifford and the errors are Paulis, each error can be propagated to the end via the conjugation rules for CNOT and H (we only need CNOT here since all errors are inserted after H_1).</li>
<li>For five error locations, enumerate all 16^5 Pauli choices (identity + 15 non-identity per location), and group by m â‰¡ number of non-identity insertions. For each configuration:
    1) Propagate each Pauli forward to the end and multiply them (ignoring global phases) to get a single 5-qubit Pauli E_final.
    2) Extract E_data = E_final on qubits 0..3 and E_anc = E_final on qubit 4.
    3) Accept iff E_data âˆˆ N(S) and E_anc âˆˆ {I, Z}.
    4) Good iff, in addition, E_data âˆˆ G_target.</li>
<li>
<p>The exact accepted/good counts obtained are:</p>
<ul>
<li>m = 0: accepted = 1, good = 1</li>
<li>m = 1: accepted = 7, good = 7</li>
<li>m = 2: accepted = 282, good = 138</li>
<li>m = 3: accepted = 4222, good = 1198</li>
<li>m = 4: accepted = 31637, good = 7397</li>
<li>m = 5: accepted = 94923, good = 24027
(Total configurations for each m are C(5,m)Â·15^m, matching 1, 75, 2250, 33750, 253125, 759375.)</li>
</ul>
</li>
<li>
<p>Probabilities</p>
</li>
<li>Acceptance probability:</li>
</ul>
<div class="arithmatex">\[
P_{\text{acc}}(p)=\sum_{m=0}^{5}\text{acc}_m\,(1-p)^{5-m}\left(\frac{p}{15}\right)^m,
\]</div>
<div class="codehilite"><pre><span></span><code><span class="k">where</span><span class="w"> </span><span class="nx">acc_m</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">acceptance</span><span class="w"> </span><span class="nx">counts</span><span class="w"> </span><span class="nx">above</span><span class="p">.</span><span class="w"> </span><span class="nx">Simplifying</span><span class="p">,</span>
</code></pre></div>

<div class="arithmatex">\[
P_{\text{acc}}(p)=\frac{(128p^2-300p+225)(2048p^3-5120p^2+3600p-1125)}{253125}.
\]</div>
<ul>
<li>â€œGoodâ€ probability:</li>
</ul>
<div class="arithmatex">\[
P_{\text{good}}(p)=\sum_{m=0}^{5}\text{good}_m\,(1-p)^{5-m}\left(\frac{p}{15}\right)^m,
\]</div>
<div class="codehilite"><pre><span></span><code>with good_m as above. In expanded form,
</code></pre></div>

<div class="arithmatex">\[
P_{\text{good}}(p)=\frac{-229376p^5+1116160p^4-2198400p^3+2214000p^2-1147500p+253125}{253125}.
\]</div>
<ul>
<li>Logical fidelity conditioned on acceptance:</li>
</ul>
<div class="arithmatex">\[
F_{\text{logical}}(p)=\frac{P_{\text{good}}(p)}{P_{\text{acc}}(p)}.
\]</div>
<ul>
<li>Closed forms and structure</li>
<li>It is convenient to write the infidelity as a ratio:</li>
</ul>
<div class="arithmatex">\[
1-F_{\text{logical}}(p)=\frac{P_{\text{acc}}(p)-P_{\text{good}}(p)}{P_{\text{acc}}(p)}.
\]</div>
<div class="codehilite"><pre><span></span><code>The numerator factors neatly:
</code></pre></div>

<div class="arithmatex">\[
P_{\text{acc}}(p)-P_{\text{good}}(p)=\frac{16\,p^2\,(15-8p)\,(675-720p+256p^2)}{253125}.
\]</div>
<div class="codehilite"><pre><span></span><code>Therefore,
</code></pre></div>

<div class="arithmatex">\[
F_{\text{logical}}(p)=1-\frac{16\,p^2\,(15-8p)\,(675-720p+256p^2)}{(128p^2-300p+225)\,(2048p^3-5120p^2+3600p-1125)}.
\]</div>
<ul>
<li>Small-p expansion (useful sanity check): since all accepted single-fault events are â€œgood,â€ the linear term vanishes:</li>
</ul>
<div class="arithmatex">\[
F_{\text{logical}}(p)=1-\frac{16}{25}p^2-\frac{704}{375}p^3+O(p^4).
\]</div>
<ol start="2">
<li>Mathematical Typesetting</li>
</ol>
<ul>
<li>All equations above are presented in LaTeX.</li>
</ul>
<ol start="3">
<li>Conventions and Units</li>
</ol>
<ul>
<li>Qubits are labeled 0,1,2,3 (data) and 4 (ancilla).</li>
<li>CNOT_{ij} has control i and target j.</li>
<li>Depolarizing parameter p per two-qubit gate as specified.</li>
</ul>
<ol start="4">
<li>Final Answer:
F_logical(p) = 1 - [16 p^2 (15 - 8 p)(675 - 720 p + 256 p^2)] / [(128 p^2 - 300 p + 225)(2048 p^3 - 5120 p^2 + 3600 p - 1125)].</li>
</ol>
<p>Equivalently,
F_logical(p) = (229376 p^5 - 1116160 p^4 + 2198400 p^3 - 2214000 p^2 + 1147500 p - 253125) / (262144 p^5 - 1269760 p^4 + 2457600 p^3 - 2376000 p^2 + 1147500 p - 253125).</p></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#29</span>
    </div>
    <div class="content markdown-body"><p>Populate your final answer into the code template provided below. This step is purely for formatting/display purposes. No additional reasoning or derivation should be performed. Do not import any modules or packages beyond what is provided in the template.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">answer</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the expression of the logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    at the end of the circuit as a function of two-qubit gate error rate $p$.</span>

<span class="sd">    Inputs</span>
<span class="sd">    ----------</span>
<span class="sd">    p: sympy.Symbol, two-qubit gate error rate, $p$</span>

<span class="sd">    Outputs</span>
<span class="sd">    ----------</span>
<span class="sd">    F_logical: sympy.Expr, logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ------------------ FILL IN YOUR RESULTS BELOW ------------------</span>
    <span class="n">F_logical</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># a SymPy expression of inputs</span>
    <span class="c1"># ---------------------------------------------------------------</span>

    <span class="k">return</span> <span class="n">F_logical</span>
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#30</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">answer</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the expression of the logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    at the end of the circuit as a function of two-qubit gate error rate $p$.</span>

<span class="sd">    Inputs</span>
<span class="sd">    ----------</span>
<span class="sd">    p: sympy.Symbol, two-qubit gate error rate, $p$</span>

<span class="sd">    Outputs</span>
<span class="sd">    ----------</span>
<span class="sd">    F_logical: sympy.Expr, logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ------------------ FILL IN YOUR RESULTS BELOW ------------------</span>
    <span class="n">F_logical</span> <span class="o">=</span> <span class="p">(</span><span class="mi">229376</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">1116160</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2198400</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2214000</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1147500</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="mi">253125</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">262144</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">1269760</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2457600</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2376000</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1147500</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="mi">253125</span><span class="p">)</span>
    <span class="c1"># ---------------------------------------------------------------</span>

    <span class="k">return</span> <span class="n">F_logical</span>
</code></pre></div></div>
</article>

</div>

<footer>
  Generated at 2025-09-24T22:02:12.031516
</footer>

<script>
(function() {
  // Tabs
  const tabs = document.querySelectorAll('.tab');
  const panels = document.querySelectorAll('.tab-content');
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      panels.forEach(p => p.classList.remove('active'));
      tab.classList.add('active');
      const target = document.querySelector(tab.dataset.target);
      if (target) target.classList.add('active');
    });
  });

  // Theme toggle
  const toggleBtn = document.getElementById('theme-toggle');
  function setTheme(dark) {
    if (dark) {
      document.documentElement.classList.add('dark');
      localStorage.setItem('dark', '1');
    } else {
      document.documentElement.classList.remove('dark');
      localStorage.setItem('dark', '0');
    }
  }
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const stored = localStorage.getItem('dark');
  setTheme(stored === null ? prefersDark : stored === '1');

  toggleBtn.addEventListener('click', () => {
    const isDark = document.documentElement.classList.contains('dark');
    setTheme(!isDark);
  });
})();
</script>
</body>
</html>