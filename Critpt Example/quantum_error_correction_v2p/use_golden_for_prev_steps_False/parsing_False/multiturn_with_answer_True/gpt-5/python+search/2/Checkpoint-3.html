<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Checkpoint-3</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #3D7B7B; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #F00 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666 } /* Operator */
.codehilite .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #9C6500 } /* Comment.Preproc */
.codehilite .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.codehilite .gr { color: #E40000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #008400 } /* Generic.Inserted */
.codehilite .go { color: #717171 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #04D } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #687822 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #00F; font-weight: bold } /* Name.Class */
.codehilite .no { color: #800 } /* Name.Constant */
.codehilite .nd { color: #A2F } /* Name.Decorator */
.codehilite .ni { color: #717171; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #00F } /* Name.Function */
.codehilite .nl { color: #767600 } /* Name.Label */
.codehilite .nn { color: #00F; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #A2F; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #BBB } /* Text.Whitespace */
.codehilite .mb { color: #666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666 } /* Literal.Number.Float */
.codehilite .mh { color: #666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #A45A77 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #00F } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666 } /* Literal.Number.Integer.Long */

</style>
<style>
    :root {
  --bg: #ffffff;
  --fg: #222222;
  --muted: #555555;
  --border: #e0e0e0;
  --accent: #005fcc;
  --code-bg: #f6f8fa;
  --role-user: #0ea5e9;
  --role-assistant: #22c55e;
  --role-system: #9ca3af;
  --return-code: #a35291;
}
html.dark {
  --bg: #0b0b0b;
  --fg: #e8e8e8;
  --muted: #a0a0a0;
  --border: #333333;
  --accent: #3b82f6;
  --code-bg: #111827;
  --role-user: #0ea5e9;
  --role-assistant: #22c55e;
  --role-system: #9ca3af;
  --return-code: #a35291;
}
* {
  box-sizing: border-box;
}
body {
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--fg);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", sans-serif;
  line-height: 1.6;
}
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 1.25rem;
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  background: var(--bg);
  z-index: 10;
}
h1 {
  margin: 0;
  font-size: 1.1rem;
}
.tabs {
  display: flex;
  gap: 0.5rem;
}
.tab {
  padding: 0.4rem 0.8rem;
  border: 1px solid var(--border);
  border-bottom: none;
  background: transparent;
  cursor: pointer;
  border-radius: 6px 6px 0 0;
  color: var(--fg);
}
.tab.active {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
}
.tab-content {
  display: none;
  padding: 1rem 1.25rem;
  border-top: 1px solid var(--border);
}
.tab-content.active {
  display: block;
}
#theme-toggle {
  border: 1px solid var(--border);
  padding: 0.2rem 0.6rem;
  font-size: 0.9rem;
  border-radius: 4px;
  cursor: pointer;
  background: transparent;
  color: var(--fg);
}
.main {
  max-width: 1200px;
  margin: 0 auto;
}
.message {
  border: 1px solid var(--border);
  border-left-width: 6px;
  border-radius: 6px;
  padding: 0.8rem 1rem;
  margin-bottom: 1rem;
  background: rgba(0,0,0,0.02);
}
.message .meta {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  margin-bottom: 0.6rem;
  color: var(--muted);
  font-size: 0.85rem;
}
.message .badge {
  font-weight: 600;
}
.role-user {
  border-left-color: var(--role-user);
}
.role-assistant {
  border-left-color: var(--role-assistant);
}
.role-system {
  border-left-color: var(--role-system);
}
.role-unknown {
  border-left-color: var(--accent);
}

.output-code-container {
  display: flex;
  gap: 1rem;               /* space between children */
  align-items: center;     /* vertical alignment */
  justify-content: start;  /* horizontal alignment */
}

.output-code-container .codeblock {
  flex: 0 1 auto;
}

.codeblock {
  border: 1px solid var(--border);
  border-left-width: 6px;
  border-radius: 6px;
  padding: 0.8rem 1rem;
  margin-bottom: 1rem;
  background: rgba(0,0,0,0.02);
}
.codeblock-content {
  margin-bottom: 0.6rem;
  border: 1px dashed var(--border);
  border-radius: 4px;
  padding: 0.4rem 0.6rem;
  background: rgba(0,0,0,0.02);
}

.codeblock.eval_code {
  border-left-color: var(--role-user);
}
.codeblock.target_code {
  border-left-color: var(--role-assistant);
}
.codeblock.output_code {
  border-left-color: var(--role-system);
}

html.dark .codeblock-content {
  background: rgba(255,255,255,0.03);
}
.codeblock > summary {
  cursor: pointer;
  font-weight: 600;
  list-style: none; /* remove default triangle in some browsers */
}
.codeblock > summary::-webkit-details-marker {
  display: none; /* Safari/Chrome marker */
}
.codeblock > summary::before {
  content: "‚ñ∂ ";
  display: inline-block;
  transform: rotate(0deg);
  transition: transform 0.12s ease-out;
}
.codeblock[open] > summary::before {
  transform: rotate(90deg);
}
.codeblock .tag {
  color: var(--muted);
  font-weight: 400;
  font-size: 0.85em;
  margin-left: 0.25rem;
}

.markdown-body pre code {
  background: var(--code-bg);
  display: block;
  padding: 0.75rem;
  overflow-x: auto;
  border-radius: 4px;
  border: 1px solid var(--border);
}
.markdown-body code {
  background: var(--code-bg);
  padding: 0.15rem 0.3rem;
  border-radius: 4px;
}
/* Extra info tree */
details > summary {
  cursor: pointer;
  font-weight: 600;
}
details .block {
  padding-left: 1rem;
  margin: 0.25rem 0 0.5rem 0;
  border-left: 2px solid var(--border);
}
.kv .key {
  font-weight: 600;
}
.kv .type {
  color: var(--muted);
  margin-left: 0.5rem;
  font-size: 0.85rem;
}
footer {
  margin: 2rem 0;
  text-align: center;
  color: var(--muted);
  font-size: 0.85rem;
}
/* CodeHilite (pygments) overrides to respect theme vars */
.codehilite {
  background: var(--code-bg) !important;
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 0.75rem !important;
}
.reasoning {
  margin-bottom: 0.6rem;
  border: 1px dashed var(--border);
  border-radius: 4px;
  padding: 0.4rem 0.6rem;
  background: rgba(0,0,0,0.02);
}
html.dark .reasoning {
  background: rgba(255,255,255,0.03);
}
.reasoning > summary {
  cursor: pointer;
  font-weight: 600;
  list-style: none; /* remove default triangle in some browsers */
}
.reasoning > summary::-webkit-details-marker {
  display: none; /* Safari/Chrome marker */
}
.reasoning > summary::before {
  content: "‚ñ∂ ";
  display: inline-block;
  transform: rotate(0deg);
  transition: transform 0.12s ease-out;
}
.reasoning[open] > summary::before {
  transform: rotate(90deg);
}
.reasoning .tag {
  color: var(--muted);
  font-weight: 400;
  font-size: 0.85em;
  margin-left: 0.25rem;
}
.reasoning-body {
  margin-top: 0.5rem;
}
</style>

<!-- ===== MATHJAX CONFIG ===== -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [ ["\\(","\\)"] ],
    displayMath: [ ["\\[","\\]"] ],
    processEscapes: true,
    processEnvironments: true
  },
  options: {
    ignoreHtmlClass: ".*",
    processHtmlClass: "arithmatex"

    // skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    // if you dynamically add content later, you can call MathJax.typesetPromise()
  }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<!-- ========================== -->
</head>
<body>
<header>
  <h1>Checkpoint-3</h1>
  <div>
    <button id="theme-toggle" aria-label="toggle dark mode">üåì</button>
  </div>
</header>

<div class="main">
  
<article class="message role-system">
    <div class="meta">
        <span class="badge">System</span>
        <span class="idx">#0</span>
    </div>
    <div class="content markdown-body"><p>You are a physics research assistant specializing in solving complex, research-level problems using precise, step-by-step reasoning.</p>
<p><strong>Input</strong>
Problems will be provided in Markdown format.</p>
<p><strong>Output (Markdown format)</strong></p>
<ol>
<li><strong>Step-by-Step Derivation</strong> - Show every non-trivial step in the solution.  Justify steps using relevant physical laws, theorems, mathematical identities or numerical codes.</li>
<li><strong>Mathematical Typesetting</strong> - Use LaTeX for all mathematics:  <code>$...$</code> for inline expressions, <code>$$...$$</code> for display equations.</li>
<li><strong>Conventions and Units</strong> - Follow the unit system and conventions specified in the problem.</li>
<li>
<p><strong>Final Answer</strong> - At the end of the solution,  start a new line with <strong>&ldquo;Final Answer:&rdquo;</strong>, and present the final result.</p>
<p>For final answers involving values, follow the precision requirements specified in the problem.
If no precision is specified:
- If an exact value is possible, provide it (e.g., \$\sqrt(2)\$, \$\pi/4\$).
- If exact form is not feasible, retain at least 12 significant digits in the result. </p>
</li>
<li>
<p><strong>Formatting Compliance</strong> - If the user requests a specific output format (e.g., code, table),  provide the final answer accordingly.
You must use web search engine to gather all the necessary information before solving the problem.
You must use web search engine to gather all the necessary information before solving the problem.
You must use web search engine to gather all the necessary information before solving the problem.</p>
</li>
</ol></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#1</span>
    </div>
    <div class="content markdown-body"><h1 id="problem-setup">Problem setup:</h1>
<p>In quantum error correction, you encode quantum states into logical states made of many qubits in order to improve their resilience to errors. In quantum error detection, you do the same but can only detect the presence of errors and not correct them. In this problem, we will consider a single [[4,2,2]] quantum error detection code, which encodes two logical qubits into four physical qubits, and investigate how robust logical quantum operations in this code are to quantum errors.</p>
<p>Our convention is that the four physical qubits in the [[4,2,2]] code are labelled 0,1,2,3. The two logical qubits are labelled A and B. The stabilizers are <span class="arithmatex">\(XXXX\)</span> and <span class="arithmatex">\(ZZZZ\)</span>, where <span class="arithmatex">\(X\)</span> and <span class="arithmatex">\(Z\)</span> are Pauli matrices. The logical <span class="arithmatex">\(X\)</span> and <span class="arithmatex">\(Z\)</span> operators on the two qubits are <span class="arithmatex">\(X_A = XIXI\)</span>, <span class="arithmatex">\(X_B=XXII\)</span>, <span class="arithmatex">\(Z_A = ZZII\)</span>, <span class="arithmatex">\(Z_B = ZIZI\)</span>, up to multiplication by stabilizers.</p>
<p>We will consider different state preparation circuits consisting of controlled not <span class="arithmatex">\(CNOT_{ij}\)</span> gates, where <span class="arithmatex">\(CNOT_{ij}\)</span> has control qubit <span class="arithmatex">\(i\)</span> and target qubit <span class="arithmatex">\(j\)</span>. As a simple model of quantum errors in hardware, we will suppose that each <span class="arithmatex">\(CNOT_{ij}\)</span> gate in the circuit has a two qubit depolarizing error channel following it that produces one of the 15 non-identity two-qubit Paulis with equal probability <span class="arithmatex">\(p/15\)</span>. The probability <span class="arithmatex">\(p\)</span> indicates the probability of an error in a single two-qubit gate. We will assess the logical infidelity of certain state preparation protocols as a function of the physical infidelity <span class="arithmatex">\(p\)</span>.</p>
<h1 id="subproblems">Checkpoints</h1>
<h2 id="subproblem-1">Checkpoint 1</h2>
<p>Suppose that we wish to prepare a logical two-qubit GHZ state  <span class="arithmatex">\((|00\rangle_{AB}+|11\rangle_{AB})/\sqrt{2}\)</span> in the [[4,2,2]] code. To do so, we use the following state preparation circuit:</p>
<div class="arithmatex">\[
(CNOT_{03}) (H_0) (CNOT_{21}) (H_2).
\]</div>
<p>Note that this equation is written in matrix multiplication order, while the quantum operations in the circuit occur in the reverse order (from right-to-left in the above equation). <span class="arithmatex">\(H\)</span> is a single-qubit Hadamard gate.</p>
<p>What is the physical state fidelity of the final physical 4-qubit state at the end of the circuit as a function of the two-qubit gate error rate <span class="arithmatex">\(p\)</span>?</p></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#2</span>
    </div>
    <div class="content markdown-body"><p>1) Step-by-step derivation</p>
<ul>
<li>Circuit, noise model, and target state</li>
<li>The circuit is applied right-to-left:
    1) H2
    2) CNOT21
    3) H0
    4) CNOT03</li>
<li>Only the two CNOTs are followed by two-qubit depolarizing channels acting on the gate‚Äôs two qubits. The model states that with probability p an error occurs and, conditioned on an error, one of the 15 non-identity two-qubit Paulis is applied uniformly at random, i.e.,</li>
</ul>
<div class="arithmatex">\[
\mathcal{E}^{(2)}(\rho)=(1-p)\rho+\frac{p}{15}\sum_{P\in\mathcal{P}_2\setminus\{II\}}P\rho P,
\]</div>
<div class="codehilite"><pre><span></span><code>where $\mathcal{P}_2=\{I,X,Y,Z\}^{\otimes 2}$. This is the ‚Äúuniform Pauli‚Äù form of the 2-qubit depolarizing/Pauli channel. ([qiskit.github.io](https://qiskit.github.io/qiskit-aer/stubs/qiskit_aer.noise.depolarizing_error.html?utm_source=openai), [docs.quantum.ibm.com](https://docs.quantum.ibm.com/api/qiskit/0.42/qiskit_aer.noise.depolarizing_error?utm_source=openai), [qml-tutorial.github.io](https://qml-tutorial.github.io/chapter2/2/?utm_source=openai))
</code></pre></div>

<ul>
<li>H followed by CNOT on |00‚ü© prepares a Bell state; hence each pair (2,1) and (0,3) is prepared into <span class="arithmatex">\(|\Phi^+\rangle=(|00\rangle+|11\rangle)/\sqrt{2}\)</span>. Therefore, the ideal final 4-qubit state is a product of two Bell pairs,</li>
</ul>
<div class="arithmatex">\[
|\Psi_{\mathrm{ideal}}\rangle = |\Phi^+\rangle_{21}\otimes|\Phi^+\rangle_{03}.
\]</div>
<div class="codehilite"><pre><span></span><code>([en.wikipedia.org](https://en.wikipedia.org/wiki/Bell_state))
</code></pre></div>

<ul>
<li>Factorization of the noisy state</li>
<li>The first error channel acts on qubits (2,1) immediately after CNOT21. No later gate touches qubits 1 or 2. The second error channel acts on (0,3) after CNOT03. Therefore, the final state factors as a tensor product of two two-qubit states:</li>
</ul>
<div class="arithmatex">\[
\rho_{\text{final}}=\rho_{21}\otimes\rho_{03},
\]</div>
<div class="codehilite"><pre><span></span><code>with
</code></pre></div>

<div class="arithmatex">\[
\]</div>
<ul>
<li>Bell-pair survival under a 2-qubit depolarizing/Pauli channel</li>
<li>For a single pair (say, 21), the fidelity with the ideal Bell state is</li>
</ul>
<div class="arithmatex">\[
      =(1-p)\underbrace{\langle\Phi^+|\Phi^+\rangle}_{=1}
\]</div>
<ul>
<li>Using the stabilizer properties of <span class="arithmatex">\(|\Phi^+\rangle\)</span>,</li>
</ul>
<div class="arithmatex">\[
      (Z\!\otimes\!Z)|\Phi^+\rangle=|\Phi^+\rangle,\quad
\]</div>
<div class="codehilite"><pre><span></span><code><span class="nv">so</span><span class="w"> </span>$<span class="o">|</span>\<span class="nv">langle</span>\<span class="nv">Phi</span><span class="o">^+|</span><span class="nv">P</span><span class="o">|</span>\<span class="nv">Phi</span><span class="o">^+</span>\<span class="nv">rangle</span><span class="o">|^</span><span class="mi">2</span><span class="o">=</span><span class="mi">1</span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>$<span class="nv">P</span>\<span class="nv">in</span>\{<span class="nv">XX</span>,<span class="nv">YY</span>,<span class="nv">ZZ</span>\}$<span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">remaining</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="nv">non</span><span class="o">-</span><span class="nv">identity</span><span class="w"> </span><span class="nv">two</span><span class="o">-</span><span class="nv">qubit</span><span class="w"> </span><span class="nv">Paulis</span><span class="w"> </span><span class="ss">(</span><span class="nv">they</span><span class="w"> </span><span class="nv">map</span><span class="w"> </span>$<span class="o">|</span>\<span class="nv">Phi</span><span class="o">^+</span>\<span class="nv">rangle</span>$<span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">some</span><span class="w"> </span><span class="nv">orthogonal</span><span class="w"> </span><span class="nv">Bell</span><span class="w"> </span><span class="nv">state</span>,<span class="w"> </span><span class="nv">e</span>.<span class="nv">g</span>.,<span class="w"> </span>$<span class="nv">ZI</span><span class="o">|</span>\<span class="nv">Phi</span><span class="o">^+</span>\<span class="nv">rangle</span><span class="o">=|</span>\<span class="nv">Phi</span><span class="o">^-</span>\<span class="nv">rangle</span>$<span class="ss">)</span>.<span class="w"> </span><span class="nv">Hence</span>,
</code></pre></div>

<div class="arithmatex">\[
      =1-\frac{12}{15}\,p
\]</div>
<div class="codehilite"><pre><span></span><code>(The three Paulis XX, YY, ZZ leave the pure density matrix unchanged, since $P|\Phi^+\rangle\langle\Phi^+|P=|\Phi^+\rangle\langle\Phi^+|$ even when the eigenvalue is ‚àí1.)
</code></pre></div>

<ul>
<li>Four-qubit physical-state fidelity</li>
<li>The target is a product state <span class="arithmatex">\(|\Psi_{\mathrm{ideal}}\rangle=|\Phi^+\rangle_{21}\otimes|\Phi^+\rangle_{03}\)</span> and the noisy state factors: <span class="arithmatex">\(\rho_{\text{final}}=\rho_{21}\otimes\rho_{03}\)</span>. Using <span class="arithmatex">\(\mathrm{Tr}[(A\otimes B)(C\otimes D)]=\mathrm{Tr}[AC]\mathrm{Tr}[BD]\)</span>,</li>
</ul>
<div class="arithmatex">\[
      =\langle\Phi^+|\rho_{21}|\Phi^+\rangle\;\langle\Phi^+|\rho_{03}|\Phi^+\rangle
      =\left(F_{\text{pair}}(p)\right)^2
\]</div>
<p>2) Mathematical details used
- Depolarizing/Pauli channel acting uniformly on non-identity n-qubit Paulis (here n=2) and the standard H‚ÄìCNOT Bell-state preparation. (<a href="https://qiskit.github.io/qiskit-aer/stubs/qiskit_aer.noise.depolarizing_error.html?utm_source=openai">qiskit.github.io</a>, <a href="https://docs.quantum.ibm.com/api/qiskit/0.42/qiskit_aer.noise.depolarizing_error?utm_source=openai">docs.quantum.ibm.com</a>, <a href="https://en.wikipedia.org/wiki/Bell_state">en.wikipedia.org</a>)</p>
<p>3) Conventions and units
- Qubits labeled 0,1,2,3 as in the prompt. Gates are ideal except for the specified post-CNOT two-qubit depolarizing channels of error probability p. Fidelity is the state overlap with the ideal pure state, <span class="arithmatex">\(F=\langle\psi|\rho|\psi\rangle\)</span>.</p>
<p>Final Answer:</p>
<div class="arithmatex">\[
F_{\mathrm{phys}}(p)=\left(1-\frac{4}{5}p\right)^2.
\]</div></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#3</span>
    </div>
    <div class="content markdown-body"><p>The correct answer is:
$
F_{\rm{physical}}=(1-\frac{12}{15}p)^2
$</p>
<p>Now let&rsquo;s solve the next Checkpoint.</p>
<h2 id="subproblem-2">Checkpoint 2</h2>
<p>Suppose that we wish to prepare a logical two-qubit GHZ state  <span class="arithmatex">\((|00\rangle_{AB}+|11\rangle_{AB})/\sqrt{2}\)</span> in the [[4,2,2]] code. To do so, we use the following state preparation circuit:</p>
<div class="arithmatex">\[
(CNOT_{03}) (H_0) (CNOT_{21}) (H_2).
\]</div>
<p>Note that this equation is written in matrix multiplication order, while the quantum operations in the circuit occur in the reverse order (from right-to-left in the above equation). <span class="arithmatex">\(H\)</span> is a single-qubit Hadamard gate.</p>
<p>What is the logical state fidelity of the final 2-qubit logical state at the end of the circuit as a function of the two-qubit gate error rate <span class="arithmatex">\(p\)</span>, assuming the state is post-selected on all detectable errors in the code?</p></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#4</span>
    </div>
    <div class="content markdown-body"><p>1) Step-by-step derivation</p>
<ul>
<li>Setup: code, circuit, noise, target</li>
<li>[[4,2,2]] code with stabilizers S = ‚ü®XXXX, ZZZZ‚ü©. A convenient choice of logical Paulis (up to stabilizers) is
    X_A = X I X I, X_B = X X I I, Z_A = Z Z I I, Z_B = Z I Z I, in the physical-qubit order (0,1,2,3). The codespace basis and stabilizers are standard for this code. (<a href="https://errorcorrectionzoo.org/c/stab_4_2_2">errorcorrectionzoo.org</a>, <a href="https://ar5iv.org/html/quant-ph/0703264?utm_source=openai">ar5iv.org</a>)</li>
<li>The state-preparation circuit acts right-to-left: H2 ‚Üí CNOT21 ‚Üí H0 ‚Üí CNOT03. Ideal action on |0000‚ü©: H2+CNOT21 prepares |Œ¶+‚ü©21; H0+CNOT03 prepares |Œ¶+‚ü©03, so the ideal 4-qubit state is
    |Œ®ideal‚ü© = |Œ¶+‚ü©21 ‚äó |Œ¶+‚ü©03,
    where |Œ¶+‚ü© = (|00‚ü©+|11‚ü©)/‚àö2. (<a href="https://qubit.guide/5.7-bell-states?utm_source=openai">qubit.guide</a>, <a href="https://en.wikipedia.org/wiki/Bell_state">en.wikipedia.org</a>)</li>
<li>
<p>Noise model: After each CNOTij, a two-qubit depolarizing (uniform Pauli) channel acts on those two qubits: with probability 1‚àíp nothing happens; with probability p a random non-identity 2-qubit Pauli from the 15 possibilities is applied uniformly (probability p/15 each). For n qubits this is the ‚Äúuniform Pauli‚Äù point of the depolarizing family. (<a href="https://qiskit.github.io/qiskit-aer/stubs/qiskit_aer.noise.depolarizing_error.html?utm_source=openai">qiskit.github.io</a>)</p>
</li>
<li>
<p>One Bell pair under a two-qubit Pauli channel</p>
</li>
<li>
<p>The Bell state |Œ¶+‚ü© is stabilized by XX and ZZ, and (up to a global phase) any two-qubit Pauli maps a Bell state to some Bell state. In particular, the four operators {I, XX, YY, ZZ} leave |Œ¶+‚ü© invariant (eigenvalue ¬±1), while the remaining 12 Paulis map |Œ¶+‚ü© to the other three Bell states in 4-to-1 groupings (cosets). Therefore, for a single depolarized pair:
    P(Œ¶+) = (1‚àíp) + 3¬∑(p/15) = 1 ‚àí 12p/15,
    P(Œ¶‚àí) = P(Œ®+) = P(Œ®‚àí) = 4p/15.
    (This uses that Bell states are permuted by local/two-qubit Paulis and |Œ¶+‚ü© is an eigenstate of XX and ZZ.) (<a href="https://en.wikipedia.org/wiki/Bell_state">en.wikipedia.org</a>)</p>
</li>
<li>
<p>Independent noise on the two disjoint pairs</p>
</li>
<li>
<p>The two error channels act independently on (2,1) and (0,3), and no later gate mixes the pairs, so the joint distribution for the pair-types factorizes.</p>
</li>
<li>
<p>Post-selection criterion (detectable errors rejected)</p>
</li>
<li>
<p>Measuring the stabilizers XXXX and ZZZZ yields the trivial syndrome (+1,+1) iff the total Pauli error P commutes with both stabilizers, i.e., P lies in the normalizer of S. Equivalently for our two-Bell-pair picture, write the pairwise parities
    sXX(pair) = eigenvalue of X‚äóX on that pair, sZZ(pair) = eigenvalue of Z‚äóZ,
    which for the four Bell states are
    Œ¶+: (+,+), Œ¶‚àí: (‚àí,+), Œ®+: (+,‚àí), Œ®‚àí: (‚àí,‚àí).
    Since XXXX = (X2X1)(X0X3) and ZZZZ = (Z2Z1)(Z0Z3), the stabilizer outcomes are the products of the corresponding pairwise parities. Hence the run is accepted iff the two pairs have the same Bell label (their (sXX,sZZ) agree componentwise). (<a href="https://quantum.cloud.ibm.com/learning/courses/foundations-of-quantum-error-correction/stabilizer-formalism/stabilizer-codes?utm_source=openai">quantum.cloud.ibm.com</a>)</p>
</li>
<li>
<p>Acceptance probability</p>
</li>
<li>
<p>Let q := P(Œ¶+) = 1 ‚àí 12p/15 = 1 ‚àí 4p/5 and r := P(Œ¶‚àí) = P(Œ®+) = P(Œ®‚àí) = 4p/15 for each pair. The acceptance probability is
    Pacc = q^2 + 3 r^2
          = (1 ‚àí 4p/5)^2 + 3 (4p/15)^2
          = 1 ‚àí 8p/5 + (64/75)p^2.</p>
</li>
<li>
<p>Which accepted events keep the logical Bell state correct?</p>
</li>
<li>The target logical state is the logical Bell state |Œ¶+‚ü©AB, which our physical product |Œ¶+‚ü©21|Œ¶+‚ü©03 realizes. Accepted events fall into four classes:
    1) (Œ¶+,Œ¶+): P = P21‚äóP03 with Ppair ‚àà {I, XX, YY, ZZ}. Using XXXX = (X2X1)(X0X3) and ZZZZ = (Z2Z1)(Z0Z3), one checks that any such P equals a stabilizer times one of {I, X_A X_B, Z_A Z_B, Y_A Y_B}. All of these act as ¬±1 on |Œ¶+‚ü©AB (global phase allowed), so the logical state remains the target. (<a href="https://errorcorrectionzoo.org/c/stab_4_2_2">errorcorrectionzoo.org</a>, <a href="https://ar5iv.org/html/quant-ph/0703264?utm_source=openai">ar5iv.org</a>)
    2) (Œ¶‚àí,Œ¶‚àí): A representative is P = Z2 ¬∑ Z0, which equals the logical Z_B (up to stabilizers) because Z_B = Z0 Z2. This maps |Œ¶+‚ü©AB ‚Üí |Œ¶‚àí‚ü©AB, orthogonal to the target. All choices in this class are equivalent to logical Z_B (times stabilizers), hence ‚Äúbad‚Äù for fidelity. (<a href="https://ar5iv.org/html/quant-ph/0703264?utm_source=openai">ar5iv.org</a>)
    3) (Œ®+,Œ®+): A representative is P = X2 ¬∑ X0 = X_A, mapping |Œ¶+‚ü©AB ‚Üí |Œ®+‚ü©AB (orthogonal). All such are equivalent to logical X_A (times stabilizers), so ‚Äúbad.‚Äù (<a href="https://ar5iv.org/html/quant-ph/0703264?utm_source=openai">ar5iv.org</a>)
    4) (Œ®‚àí,Œ®‚àí): A representative is P = Y2 ¬∑ Y0 ‚àù X_A Z_B, mapping |Œ¶+‚ü©AB ‚Üí |Œ®‚àí‚ü©AB (orthogonal). Again ‚Äúbad.‚Äù (<a href="https://ar5iv.org/html/quant-ph/0703264?utm_source=openai">ar5iv.org</a>)</li>
<li>
<p>Therefore, among accepted runs, only the (Œ¶+,Œ¶+) sector produces the correct logical Bell state.</p>
</li>
<li>
<p>Logical fidelity conditioned on post-selection</p>
</li>
<li>The (conditional) logical state fidelity is the probability mass of the (Œ¶+,Œ¶+) sector conditioned on acceptance:
    Flogical(p) = P[(Œ¶+,Œ¶+)] / Pacc = q^2 / (q^2 + 3 r^2)
                = (1 ‚àí 4p/5)^2 / [ (1 ‚àí 4p/5)^2 + 3 (4p/15)^2 ].</li>
<li>Series for small p: Flogical(p) = 1 ‚àí (16/75) p^2 + O(p^3), reflecting the removal (by post-selection) of all O(p) logical errors. (<a href="https://quantum.cloud.ibm.com/learning/courses/foundations-of-quantum-error-correction/stabilizer-formalism/stabilizer-codes?utm_source=openai">quantum.cloud.ibm.com</a>)</li>
</ul>
<p>2) Mathematical identities and facts used
- Bell-state properties and preparation by H‚ÄìCNOT; |Œ¶+‚ü© stabilized by XX and ZZ; Paulis permute the Bell basis. (<a href="https://en.wikipedia.org/wiki/Bell_state">en.wikipedia.org</a>)
- [[4,2,2]] code stabilizers and typical logical representatives used above. (<a href="https://errorcorrectionzoo.org/c/stab_4_2_2">errorcorrectionzoo.org</a>, <a href="https://ar5iv.org/html/quant-ph/0703264?utm_source=openai">ar5iv.org</a>)
- Error detection accepts exactly errors commuting with all stabilizer generators (normalizer elements). (<a href="https://quantum.cloud.ibm.com/learning/courses/foundations-of-quantum-error-correction/stabilizer-formalism/stabilizer-codes?utm_source=openai">quantum.cloud.ibm.com</a>)
- Uniform two-qubit depolarizing channel (uniform Pauli at the ‚ÄúPauli point‚Äù). (<a href="https://qiskit.github.io/qiskit-aer/stubs/qiskit_aer.noise.depolarizing_error.html?utm_source=openai">qiskit.github.io</a>)</p>
<p>3) Conventions and units
- Qubits labeled (0,1,2,3); logical qubits A,B. Gates ideal except for the specified two-qubit depolarizing channel of strength p applied after each CNOT. Fidelity is the pure-state overlap with the conditional logical state.</p>
<p>4) Final Answer:</p>
<div class="arithmatex">\[
F_{\rm logical}(p)
=\frac{\bigl(1-\tfrac{4}{5}p\bigr)^2}
       {\bigl(1-\tfrac{4}{5}p\bigr)^2+3\bigl(\tfrac{4}{15}p\bigr)^2}
=\frac{1-\tfrac{8}{5}p+\tfrac{16}{25}p^2}{1-\tfrac{8}{5}p+\tfrac{64}{75}p^2}\,.
\]</div></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#5</span>
    </div>
    <div class="content markdown-body"><p>The correct answer is:
$
F_{\rm{logical}}=1 - \frac{\frac{16}{75}p^2}{1-\frac{8}{5}p + \frac{64}{75}p^2}
$</p>
<p>Now let&rsquo;s solve the next Checkpoint.</p>
<h2 id="subproblem-3">Checkpoint 3</h2>
<p>Suppose that we prepare a logical two-qubit <span class="arithmatex">\(|00\rangle_{AB}\)</span> state in the [[4,2,2]] code. To do so, we introduce an ancilla qubit, qubit 4, and use the following state preparation circuit:</p>
<div class="arithmatex">\[
M_4 (CNOT_{04}) (CNOT_{34}) (CNOT_{23}) (CNOT_{10}) (CNOT_{12}) (H_1)
\]</div>
<p>Note that this equation is written in matrix multiplication order, while the quantum operations in the circuit occur in the reverse order (from right-to-left in the above equation). <span class="arithmatex">\(H\)</span> is a single-qubit Hadamard gate and <span class="arithmatex">\(M\)</span> is a single-qubit measurement. The ancilla is used to detect errors in the state preparation circuit and makes the circuit fault-tolerant. If the ancilla measurement is <span class="arithmatex">\(|0\rangle\)</span> (<span class="arithmatex">\(|1\rangle\)</span>), the state preparation succeeds (fails).</p>
<p>What is the logical state fidelity of the final 2-qubit logical state at the end of the circuit as a function of two-qubit gate error rate <span class="arithmatex">\(p\)</span>, assuming the state is post-selected on all detectable errors in the code and on the ancilla qubit measuring <span class="arithmatex">\(|0\rangle\)</span>?</p></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#6</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>

<span class="c1"># Define Pauli multiplication ignoring global phase</span>
<span class="n">mul_table</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">):</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;I&#39;</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">pauli_mul</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
    <span class="c1"># p and q are strings over {I,X,Y,Z} of same length</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mul_table</span><span class="p">[(</span><span class="n">pi</span><span class="p">,</span><span class="n">qi</span><span class="p">)]</span> <span class="k">for</span> <span class="n">pi</span><span class="p">,</span><span class="n">qi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>

<span class="c1"># Conjugation of a Pauli string by CNOT(control, target)</span>
<span class="c1"># Returns U P U^‚Ä†</span>

<span class="k">def</span><span class="w"> </span><span class="nf">conj_by_cnot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="c1"># Copy to avoid interfering updates; apply rules based on original</span>
    <span class="n">Pc</span><span class="p">,</span> <span class="n">Pt</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
    <span class="c1"># If X on control, multiply X on target</span>
    <span class="k">if</span> <span class="n">Pc</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span>
        <span class="c1"># multiply current P[t] by X</span>
        <span class="n">P</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">mul_table</span><span class="p">[(</span><span class="n">P</span><span class="p">[</span><span class="n">t</span><span class="p">],</span><span class="s1">&#39;X&#39;</span><span class="p">)]</span>
    <span class="c1"># If Z on target, multiply Z on control</span>
    <span class="k">if</span> <span class="n">Pt</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span>
        <span class="n">P</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">mul_table</span><span class="p">[(</span><span class="n">P</span><span class="p">[</span><span class="n">c</span><span class="p">],</span><span class="s1">&#39;Z&#39;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

<span class="c1"># Commutation check via symplectic product</span>
<span class="n">symp_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;I&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;X&#39;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;Y&#39;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;Z&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">anticommutes</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">Q</span><span class="p">):</span>
    <span class="c1"># P,Q strings same length</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">q</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">Q</span><span class="p">):</span>
        <span class="n">xp</span><span class="p">,</span><span class="n">zp</span> <span class="o">=</span> <span class="n">symp_map</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
        <span class="n">xq</span><span class="p">,</span><span class="n">zq</span> <span class="o">=</span> <span class="n">symp_map</span><span class="p">[</span><span class="n">q</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">^=</span> <span class="p">(</span><span class="n">xp</span> <span class="o">&amp;</span> <span class="n">zq</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">zp</span> <span class="o">&amp;</span> <span class="n">xq</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">==</span><span class="mi">1</span>

<span class="c1"># Circuit specification</span>
<span class="c1"># Qubits indices: 0,1,2,3 are data; 4 is ancilla</span>
<span class="c1"># Time order (after H1): gates are g0: CNOT12, g1: CNOT10, g2: CNOT23, g3: CNOT34, g4: CNOT04</span>
<span class="n">cnots</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)]</span>

<span class="c1"># Precompute propagation to end for each gate and each local 2-qubit Pauli</span>
<span class="n">single_qubit_labels</span> <span class="o">=</span> <span class="s1">&#39;IXYZ&#39;</span>
<span class="n">paulis2</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="n">b</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">single_qubit_labels</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">single_qubit_labels</span><span class="p">]</span>  <span class="c1"># 16 including II</span>

<span class="c1"># Map from two-qubit Pauli (on control,target) to full 5-qubit Pauli after propagation</span>
<span class="n">prop_effects</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of dicts for each gate</span>
<span class="k">for</span> <span class="n">gi</span><span class="p">,(</span><span class="n">c</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cnots</span><span class="p">):</span>
    <span class="n">effects</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Past gates after this gate</span>
    <span class="n">later</span> <span class="o">=</span> <span class="n">cnots</span><span class="p">[</span><span class="n">gi</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">P2</span> <span class="ow">in</span> <span class="n">paulis2</span><span class="p">:</span>
        <span class="c1"># Embed into 5-qubit string at positions c and t</span>
        <span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span>
        <span class="n">P</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">P</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="c1"># propagate through later CNOTs</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="n">tt</span><span class="p">)</span> <span class="ow">in</span> <span class="n">later</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">conj_by_cnot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">tt</span><span class="p">)</span>
        <span class="n">effects</span><span class="p">[</span><span class="n">P2</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span>
    <span class="n">prop_effects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">effects</span><span class="p">)</span>

<span class="c1"># Stabilizers extended to 5 qubits (ancilla I)</span>
<span class="n">S1</span> <span class="o">=</span> <span class="s1">&#39;XXXXI&#39;</span>  <span class="c1"># XXXX on 0..3</span>
<span class="n">S2</span> <span class="o">=</span> <span class="s1">&#39;ZZZZI&#39;</span>  <span class="c1"># ZZZZ on 0..3</span>
<span class="c1"># Logical Zs (on data)</span>
<span class="n">Z_A</span> <span class="o">=</span> <span class="s1">&#39;ZZI I&#39;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Z on 0,1</span>
<span class="n">Z_B</span> <span class="o">=</span> <span class="s1">&#39;ZIZ I&#39;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Z on 0,2</span>
<span class="c1"># Extend with ancilla I</span>
<span class="n">Z_A5</span> <span class="o">=</span> <span class="n">Z_A</span> <span class="o">+</span> <span class="s1">&#39;I&#39;</span>
<span class="n">Z_B5</span> <span class="o">=</span> <span class="n">Z_B</span> <span class="o">+</span> <span class="s1">&#39;I&#39;</span>

<span class="c1"># Enumerate all patterns</span>
<span class="c1"># For each gate choose one of 16 paulis (identity or non-identity)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;accepted_total&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span>  <span class="c1"># by k errors</span>
    <span class="s1">&#39;accepted_good&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span>
    <span class="s1">&#39;accepted_bad&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span>
<span class="p">}</span>

<span class="c1"># Precompute identity detection etc for speed? We&#39;ll do on the fly.</span>

<span class="c1"># Iterate over all choices of P2 for each gate (5 nested loops)</span>
<span class="c1"># We&#39;ll optimize by using integer indexes and lookups.</span>
<span class="n">paulis2_list</span> <span class="o">=</span> <span class="n">paulis2</span>
<span class="nb">len</span><span class="p">(</span><span class="n">paulis2_list</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>

<span class="c1"># For speed, convert to list of 16 ints representing non-identity vs identity</span>
<span class="c1"># We&#39;ll define helper to compute final error by multiplying strings</span>

<span class="k">def</span><span class="w"> </span><span class="nf">is_identity2</span><span class="p">(</span><span class="n">P2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">P2</span> <span class="o">==</span> <span class="s1">&#39;II&#39;</span>

<span class="c1"># We&#39;ll also precompute 5x16 mapping to 5-qubit strings P_effects</span>
<span class="n">prop</span> <span class="o">=</span> <span class="n">prop_effects</span>

<span class="c1"># Multiplication function across 5-qubit strings</span>

<span class="k">def</span><span class="w"> </span><span class="nf">multiply_many</span><span class="p">(</span><span class="n">Ps</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;IIIII&#39;</span>
    <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">Ps</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">P</span> <span class="o">!=</span> <span class="s1">&#39;IIIII&#39;</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">pauli_mul</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="c1"># Main loop</span>
<span class="n">n_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">idxs</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">n_total</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">Ps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">gi</span><span class="p">,</span><span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idxs</span><span class="p">):</span>
        <span class="n">P2</span> <span class="o">=</span> <span class="n">paulis2_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">P2</span> <span class="o">!=</span> <span class="s1">&#39;II&#39;</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">Ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="n">gi</span><span class="p">][</span><span class="n">P2</span><span class="p">])</span>
    <span class="c1"># total propagated error at end</span>
    <span class="n">Ptot</span> <span class="o">=</span> <span class="n">multiply_many</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span>
    <span class="c1"># Ancilla acceptance: ancilla Pauli must be I or Z (no X or Y)</span>
    <span class="n">anc</span> <span class="o">=</span> <span class="n">Ptot</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">anc</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span>
        <span class="k">continue</span>  <span class="c1"># rejected by ancilla measurement (since ideal ancilla is |0&gt;)</span>
    <span class="c1"># Code detection acceptance: data part must commute with both stabilizers</span>
    <span class="c1"># Equivalent to Ptot must commute with S1,S2 since ancilla I/Z commutes with them trivially</span>
    <span class="k">if</span> <span class="n">anticommutes</span><span class="p">(</span><span class="n">Ptot</span><span class="p">,</span> <span class="n">S1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">anticommutes</span><span class="p">(</span><span class="n">Ptot</span><span class="p">,</span> <span class="n">S2</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="c1"># accepted</span>
    <span class="n">counts</span><span class="p">[</span><span class="s1">&#39;accepted_total&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># Goodness: if data commutes with both Z_A and Z_B -&gt; logical |00&gt; unchanged</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">anticommutes</span><span class="p">(</span><span class="n">Ptot</span><span class="p">,</span> <span class="n">Z_A5</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">anticommutes</span><span class="p">(</span><span class="n">Ptot</span><span class="p">,</span> <span class="n">Z_B5</span><span class="p">)):</span>
        <span class="n">counts</span><span class="p">[</span><span class="s1">&#39;accepted_good&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">counts</span><span class="p">[</span><span class="s1">&#39;accepted_bad&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">counts</span><span class="p">,</span> <span class="n">n_total</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#7</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>&#39;&#39;
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#8</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span>
</code></pre></div></div>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#9</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>Done
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#10</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code><span class="c1"># Let&#39;s print counts</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</code></pre></div></div>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#11</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 3, in &lt;module&gt;
NameError: name &#39;counts&#39; is not defined
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#12</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code><span class="c1"># Rerun the enumeration because the previous scope was ephemeral? Let&#39;s wrap it into a function to reuse.</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>

<span class="n">mul_table</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">):</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span><span class="s1">&#39;I&#39;</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">pauli_mul</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mul_table</span><span class="p">[(</span><span class="n">pi</span><span class="p">,</span><span class="n">qi</span><span class="p">)]</span> <span class="k">for</span> <span class="n">pi</span><span class="p">,</span><span class="n">qi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>

<span class="n">symp_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;I&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;X&#39;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;Y&#39;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;Z&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">anticommutes</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">Q</span><span class="p">):</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">q</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">Q</span><span class="p">):</span>
        <span class="n">xp</span><span class="p">,</span><span class="n">zp</span> <span class="o">=</span> <span class="n">symp_map</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
        <span class="n">xq</span><span class="p">,</span><span class="n">zq</span> <span class="o">=</span> <span class="n">symp_map</span><span class="p">[</span><span class="n">q</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">^=</span> <span class="p">(</span><span class="n">xp</span> <span class="o">&amp;</span> <span class="n">zq</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">zp</span> <span class="o">&amp;</span> <span class="n">xq</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">==</span><span class="mi">1</span>

<span class="k">def</span><span class="w"> </span><span class="nf">conj_by_cnot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="n">Pc</span><span class="p">,</span> <span class="n">Pt</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">Pc</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span>
        <span class="n">P</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">mul_table</span><span class="p">[(</span><span class="n">P</span><span class="p">[</span><span class="n">t</span><span class="p">],</span><span class="s1">&#39;X&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">Pt</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span>
        <span class="n">P</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">mul_table</span><span class="p">[(</span><span class="n">P</span><span class="p">[</span><span class="n">c</span><span class="p">],</span><span class="s1">&#39;Z&#39;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

<span class="n">single_qubit_labels</span> <span class="o">=</span> <span class="s1">&#39;IXYZ&#39;</span>
<span class="n">paulis2</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="n">b</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">single_qubit_labels</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">single_qubit_labels</span><span class="p">]</span>

<span class="n">cnots</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)]</span>

<span class="c1"># Precompute propagation</span>
<span class="n">prop_effects</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">gi</span><span class="p">,(</span><span class="n">c</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cnots</span><span class="p">):</span>
    <span class="n">effects</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">later</span> <span class="o">=</span> <span class="n">cnots</span><span class="p">[</span><span class="n">gi</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">P2</span> <span class="ow">in</span> <span class="n">paulis2</span><span class="p">:</span>
        <span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span>
        <span class="n">P</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">P</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">cc</span><span class="p">,</span><span class="n">tt</span><span class="p">)</span> <span class="ow">in</span> <span class="n">later</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">conj_by_cnot</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">tt</span><span class="p">)</span>
        <span class="n">effects</span><span class="p">[</span><span class="n">P2</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span>
    <span class="n">prop_effects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">effects</span><span class="p">)</span>

<span class="n">S1</span> <span class="o">=</span> <span class="s1">&#39;XXXXI&#39;</span>
<span class="n">S2</span> <span class="o">=</span> <span class="s1">&#39;ZZZZI&#39;</span>
<span class="n">Z_A5</span> <span class="o">=</span> <span class="s1">&#39;ZZI II&#39;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">Z_B5</span> <span class="o">=</span> <span class="s1">&#39;ZIZ II&#39;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">counts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;accepted_total&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;accepted_good&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;accepted_bad&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span><span class="p">}</span>

<span class="c1"># Main enumeration</span>
<span class="k">for</span> <span class="n">idxs</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">Ps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">gi</span><span class="p">,</span><span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idxs</span><span class="p">):</span>
        <span class="n">P2</span> <span class="o">=</span> <span class="n">paulis2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">P2</span> <span class="o">!=</span> <span class="s1">&#39;II&#39;</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">Ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop_effects</span><span class="p">[</span><span class="n">gi</span><span class="p">][</span><span class="n">P2</span><span class="p">])</span>
    <span class="c1"># Multiply</span>
    <span class="n">Ptot</span> <span class="o">=</span> <span class="s1">&#39;IIIII&#39;</span>
    <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">Ps</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">P</span> <span class="o">!=</span> <span class="s1">&#39;IIIII&#39;</span><span class="p">:</span>
            <span class="n">Ptot</span> <span class="o">=</span> <span class="n">pauli_mul</span><span class="p">(</span><span class="n">Ptot</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
    <span class="c1"># Ancilla acceptance (must be I or Z)</span>
    <span class="k">if</span> <span class="n">Ptot</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="c1"># Code detection acceptance</span>
    <span class="k">if</span> <span class="n">anticommutes</span><span class="p">(</span><span class="n">Ptot</span><span class="p">,</span> <span class="n">S1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">anticommutes</span><span class="p">(</span><span class="n">Ptot</span><span class="p">,</span> <span class="n">S2</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="c1"># Accepted</span>
    <span class="n">counts</span><span class="p">[</span><span class="s1">&#39;accepted_total&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">anticommutes</span><span class="p">(</span><span class="n">Ptot</span><span class="p">,</span> <span class="n">Z_A5</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">anticommutes</span><span class="p">(</span><span class="n">Ptot</span><span class="p">,</span> <span class="n">Z_B5</span><span class="p">)):</span>
        <span class="n">counts</span><span class="p">[</span><span class="s1">&#39;accepted_good&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">counts</span><span class="p">[</span><span class="s1">&#39;accepted_bad&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</code></pre></div></div>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#13</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>{&#39;accepted_bad&#39;: [0, 0, 144, 3024, 24240, 70896],
 &#39;accepted_good&#39;: [1, 7, 138, 1198, 7397, 24027],
 &#39;accepted_total&#39;: [1, 7, 282, 4222, 31637, 94923]}
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#14</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">fractions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fraction</span>

<span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">282</span><span class="p">,</span><span class="mi">4222</span><span class="p">,</span><span class="mi">31637</span><span class="p">,</span><span class="mi">94923</span><span class="p">]</span>
<span class="n">G</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">138</span><span class="p">,</span><span class="mi">1198</span><span class="p">,</span><span class="mi">7397</span><span class="p">,</span><span class="mi">24027</span><span class="p">]</span>

<span class="c1"># Build polynomials D(p) and N(p) with rational coefficients</span>
<span class="c1"># D(p) = sum_k A_k * (1-p)^{5-k} * (p/15)^k</span>
<span class="c1"># Expand using binomial theorem</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">comb</span>

<span class="k">def</span><span class="w"> </span><span class="nf">poly_add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
    <span class="c1"># polynomials as list of coefficients [c0, c1, ..., cn]; extend to max length</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="p">[</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">q</span> <span class="o">+</span> <span class="p">[</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">pi</span><span class="o">+</span><span class="n">qi</span> <span class="k">for</span> <span class="n">pi</span><span class="p">,</span><span class="n">qi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">poly_mul</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">pi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">qj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
            <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pi</span><span class="o">*</span><span class="n">qj</span>
    <span class="k">return</span> <span class="n">r</span>

<span class="c1"># Represent (1-p)^{m} as polynomial</span>

<span class="k">def</span><span class="w"> </span><span class="nf">poly_one_minus_p_pow</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Fraction</span><span class="p">(</span><span class="n">comb</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">j</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">Fraction</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">j</span><span class="p">))</span>
    <span class="c1"># That gives sum_{j} (-1)^j C(m,j) p^j; but we want as a polynomial in p with constant term 1</span>
    <span class="k">return</span> <span class="n">coeffs</span>

<span class="c1"># Represent (p/15)^k as polynomial (0,...,0, (1/15)^k) of degree k</span>

<span class="k">def</span><span class="w"> </span><span class="nf">poly_p_pow_over_15</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span><span class="o">*</span><span class="n">k</span> <span class="o">+</span> <span class="p">[</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="o">**</span><span class="n">k</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">coeffs</span>

<span class="c1"># Build D,N</span>
<span class="n">D</span> <span class="o">=</span> <span class="p">[</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
<span class="n">N</span> <span class="o">=</span> <span class="p">[</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="c1"># (1-p)^{5-k}</span>
    <span class="n">om</span> <span class="o">=</span> <span class="n">poly_one_minus_p_pow</span><span class="p">(</span><span class="mi">5</span><span class="o">-</span><span class="n">k</span><span class="p">)</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">poly_p_pow_over_15</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">termD</span> <span class="o">=</span> <span class="n">poly_mul</span><span class="p">([</span><span class="n">Fraction</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">k</span><span class="p">])],</span> <span class="n">poly_mul</span><span class="p">(</span><span class="n">om</span><span class="p">,</span> <span class="n">pp</span><span class="p">))</span>
    <span class="n">termN</span> <span class="o">=</span> <span class="n">poly_mul</span><span class="p">([</span><span class="n">Fraction</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="n">k</span><span class="p">])],</span> <span class="n">poly_mul</span><span class="p">(</span><span class="n">om</span><span class="p">,</span> <span class="n">pp</span><span class="p">))</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">poly_add</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">termD</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">poly_add</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">termN</span><span class="p">)</span>

<span class="c1"># Print polynomials</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;D coefficients (from p^0 to p^5):&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">numerator</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">denominator</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">D</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;N coefficients:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">numerator</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">denominator</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">N</span><span class="p">])</span>

<span class="c1"># Simplify by multiplying by 15^5 to remove denominators and by 5!/ etc? We&#39;ll just present as ratio of integer polynomials.</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">lcm</span>

<span class="k">def</span><span class="w"> </span><span class="nf">lcm_list</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">gcd</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="n">x</span><span class="o">//</span><span class="n">gcd</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">L</span>

<span class="c1"># Compute common denominators to convert coefficients to integers</span>
<span class="n">D_denoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">denominator</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">D</span><span class="p">]</span>
<span class="n">N_denoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">denominator</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">N</span><span class="p">]</span>
<span class="n">L_D</span> <span class="o">=</span> <span class="n">lcm_list</span><span class="p">(</span><span class="n">D_denoms</span><span class="p">)</span>
<span class="n">L_N</span> <span class="o">=</span> <span class="n">lcm_list</span><span class="p">(</span><span class="n">N_denoms</span><span class="p">)</span>
<span class="n">D_int</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">L_D</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">D</span><span class="p">]</span>
<span class="n">N_int</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">L_N</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">N</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;D integer coeffs with common denom&#39;</span><span class="p">,</span> <span class="n">L_D</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">D_int</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;N integer coeffs with common denom&#39;</span><span class="p">,</span> <span class="n">L_N</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">N_int</span><span class="p">)</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#15</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>D coefficients (from p^0 to p^5):
[&#39;1/1&#39;, &#39;-68/15&#39;, &#39;704/75&#39;, &#39;-32768/3375&#39;, &#39;253952/50625&#39;, &#39;-262144/253125&#39;]
N coefficients:
[&#39;1/1&#39;, &#39;-68/15&#39;, &#39;656/75&#39;, &#39;-29312/3375&#39;, &#39;223232/50625&#39;, &#39;-229376/253125&#39;]
D integer coeffs with common denom 253125 : [253125, -1147500, 2376000, -2457600, 1269760, -262144]
N integer coeffs with common denom 253125 : [253125, -1147500, 2214000, -2198400, 1116160, -229376]
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#16</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="c1"># Verify small-p expansion</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fractions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fraction</span>

<span class="c1"># Convert to floats or keep Fractions</span>
<span class="n">D</span> <span class="o">=</span> <span class="p">[</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">253125</span><span class="p">,</span><span class="mi">253125</span><span class="p">),</span> <span class="n">Fraction</span><span class="p">(</span><span class="o">-</span><span class="mi">1147500</span><span class="p">,</span><span class="mi">253125</span><span class="p">),</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">2376000</span><span class="p">,</span><span class="mi">253125</span><span class="p">),</span> <span class="n">Fraction</span><span class="p">(</span><span class="o">-</span><span class="mi">2457600</span><span class="p">,</span><span class="mi">253125</span><span class="p">),</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1269760</span><span class="p">,</span><span class="mi">253125</span><span class="p">),</span> <span class="n">Fraction</span><span class="p">(</span><span class="o">-</span><span class="mi">262144</span><span class="p">,</span><span class="mi">253125</span><span class="p">)]</span>
<span class="n">N</span> <span class="o">=</span> <span class="p">[</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">253125</span><span class="p">,</span><span class="mi">253125</span><span class="p">),</span> <span class="n">Fraction</span><span class="p">(</span><span class="o">-</span><span class="mi">1147500</span><span class="p">,</span><span class="mi">253125</span><span class="p">),</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">2214000</span><span class="p">,</span><span class="mi">253125</span><span class="p">),</span> <span class="n">Fraction</span><span class="p">(</span><span class="o">-</span><span class="mi">2198400</span><span class="p">,</span><span class="mi">253125</span><span class="p">),</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1116160</span><span class="p">,</span><span class="mi">253125</span><span class="p">),</span> <span class="n">Fraction</span><span class="p">(</span><span class="o">-</span><span class="mi">229376</span><span class="p">,</span><span class="mi">253125</span><span class="p">)]</span>

<span class="c1"># Expand F = N/D to p^2</span>
<span class="c1"># F = (N0 + N1 p + N2 p^2 + ...)/(D0 + D1 p + D2 p^2 + ...)</span>
<span class="c1"># Use series formula F = (N0/D0) + (N1 D0 - N0 D1)/D0^2 p + (N2 D0^2 - N1 D0 D1 + N0(D1^2 - D0 D2))/D0^3 p^2</span>
<span class="n">N0</span><span class="p">,</span><span class="n">N1</span><span class="p">,</span><span class="n">N2</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">N</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">N</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">D0</span><span class="p">,</span><span class="n">D1</span><span class="p">,</span><span class="n">D2</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="n">F0</span> <span class="o">=</span> <span class="n">N0</span><span class="o">/</span><span class="n">D0</span>
<span class="n">F1</span> <span class="o">=</span> <span class="p">(</span><span class="n">N1</span><span class="o">*</span><span class="n">D0</span> <span class="o">-</span> <span class="n">N0</span><span class="o">*</span><span class="n">D1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">D0</span><span class="o">*</span><span class="n">D0</span><span class="p">)</span>
<span class="n">F2</span> <span class="o">=</span> <span class="p">(</span><span class="n">N2</span><span class="o">*</span><span class="n">D0</span><span class="o">*</span><span class="n">D0</span> <span class="o">-</span> <span class="n">N1</span><span class="o">*</span><span class="n">D0</span><span class="o">*</span><span class="n">D1</span> <span class="o">+</span> <span class="n">N0</span><span class="o">*</span><span class="p">(</span><span class="n">D1</span><span class="o">*</span><span class="n">D1</span> <span class="o">-</span> <span class="n">D0</span><span class="o">*</span><span class="n">D2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">D0</span><span class="o">*</span><span class="n">D0</span><span class="o">*</span><span class="n">D0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Series: F ‚âà&#39;</span><span class="p">,</span> <span class="n">F0</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="s1">&#39;p +&#39;</span><span class="p">,</span> <span class="n">F2</span><span class="p">,</span> <span class="s1">&#39;p^2&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;As floats:&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">F0</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">F1</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">F2</span><span class="p">))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#17</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code><span class="n">Series</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="err">‚âà</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">-</span><span class="mi">16</span><span class="o">/</span><span class="mi">25</span><span class="w"> </span><span class="n">p</span><span class="o">^</span><span class="mi">2</span>
<span class="n">As</span><span class="w"> </span><span class="n">floats</span><span class="o">:</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">-</span><span class="mf">0.64</span>
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#18</span>
    </div>
    <div class="content markdown-body"><p>1) Step-by-step derivation</p>
<ul>
<li>Code, logicals, and target state</li>
<li>[[4,2,2]] detection code with stabilizers S = ‚ü®XXXX, ZZZZ‚ü© on qubits (0,1,2,3). A convenient choice of logical Paulis is
    X_A = X I X I, X_B = X X I I, Z_A = Z Z I I, Z_B = Z I Z I (up to stabilizers). The logical computational basis contains
    |00ÃÑ‚ü© = (|0000‚ü© + |1111‚ü©)/‚àö2, which is stabilized by XXXX and ZZZZ. (<a href="https://errorcorrectionzoo.org/c/stab_4_2_2?utm_source=openai">errorcorrectionzoo.org</a>, <a href="https://ar5iv.labs.arxiv.org/html/1309.5598?utm_source=openai">ar5iv.labs.arxiv.org</a>)</li>
<li>
<p>We prepare |00ÃÑ‚ü© using the circuit (right-to-left in time)
    H1 ‚Üí CNOT12 ‚Üí CNOT10 ‚Üí CNOT23 ‚Üí CNOT34 ‚Üí CNOT04 ‚Üí measure ancilla 4 in Z.
    Ideally, the last two CNOTs parity-check Z0Z3 onto ancilla, and for the GHZ-like |00ÃÑ‚ü© the ancilla deterministically yields 0. Parity readout of Z-parities with two CNOTs and a Z-measurement is standard. (<a href="https://en.wikipedia.org/wiki/Parity_measurement?utm_source=openai">en.wikipedia.org</a>)</p>
</li>
<li>
<p>Noise model and acceptance rule</p>
</li>
<li>After each two-qubit CNOTij we apply an independent two-qubit depolarizing/Pauli channel that, with probability p, applies one of the 15 non-identity two-qubit Paulis uniformly (p/15 each), and with probability 1‚àíp applies I‚äóI. This is the ‚Äúuniform Pauli point‚Äù of the n-qubit depolarizing family. (<a href="https://qiskit.github.io/qiskit-aer/stubs/qiskit_aer.noise.depolarizing_error.html?utm_source=openai">qiskit.github.io</a>, <a href="https://quantumcomputing.stackexchange.com/questions/28640/how-do-i-apply-depolarization-error-on-2-qubits-using-qiskit?utm_source=openai">quantumcomputing.stackexchange.com</a>)</li>
<li>
<p>Post-selection: keep only shots with (i) ancilla measurement result 0 and (ii) no detectable code syndrome, i.e., the effective data Pauli P commutes with both stabilizers XXXX and ZZZZ. (Commutation with stabilizers characterizes undetected errors in stabilizer codes.) (<a href="https://en.wikipedia.org/wiki/Stabilizer_code?utm_source=openai">en.wikipedia.org</a>)</p>
</li>
<li>
<p>Clifford/Pauli propagation and classification</p>
</li>
<li>Because the circuit is Clifford and the noise is Pauli, any fault pattern maps to a single Pauli Ptot on the five qubits at the end of the circuit. Propagation through CNOT uses the standard conjugation rules:
    X on control ‚Üí X_c X_t, Z on target ‚Üí Z_c Z_t (Z on control and X on target unchanged). (<a href="https://zxcalc.github.io/book/html/main_htmlch6.html?utm_source=openai">zxcalc.github.io</a>, <a href="https://en.wikipedia.org/wiki/Clifford_gate?utm_source=openai">en.wikipedia.org</a>)</li>
<li>Acceptance conditions in terms of Ptot:
    1) Ancilla acceptance: with the ideal final state having ancilla |0‚ü© decoupled, Ptot must have no X or Y on qubit 4 (I or Z are allowed) to observe outcome 0 deterministically. (<a href="https://en.wikipedia.org/wiki/Parity_measurement?utm_source=openai">en.wikipedia.org</a>)
    2) Code acceptance: the data restriction Pdata must commute with XXXX and ZZZZ. (<a href="https://en.wikipedia.org/wiki/Stabilizer_code?utm_source=openai">en.wikipedia.org</a>)</li>
<li>
<p>Logical correctness among accepted events: the target is the +1 eigenstate of Z_A and Z_B. Thus, among accepted Pdata in the normalizer, the output is ‚Äúgood‚Äù iff Pdata commutes with both Z_A and Z_B (i.e., it is a stabilizer or Z-type logical), and ‚Äúbad‚Äù iff it anticommutes with either (i.e., includes an X_A or X_B component). (<a href="https://ar5iv.labs.arxiv.org/html/1309.5598?utm_source=openai">ar5iv.labs.arxiv.org</a>)</p>
</li>
<li>
<p>Exhaustive Pauli enumeration (exact counting)</p>
</li>
<li>There are five noisy CNOTs; at each location the error is chosen from {II}‚à™(15 non-identity two-qubit Paulis). We exhaustively propagated all 16^5 patterns to the end, tested the two acceptance criteria above, and classified accepted events as ‚Äúgood‚Äù or ‚Äúbad‚Äù by commutation with Z_A and Z_B.</li>
<li>Let Ak be the number of accepted patterns with exactly k non-identity gate faults, and Gk (Bk) the number of accepted-good (accepted-bad) patterns with k faults. Exact counts are:<ul>
<li>Accepted totals Ak for k=0..5: [1, 7, 282, 4222, 31637, 94923]</li>
<li>Accepted good Gk:              [1, 7, 138, 1198, 7397, 24027]</li>
<li>Accepted bad  Bk:              [0, 0, 144, 3024, 24240, 70896]</li>
</ul>
</li>
<li>From these, the accepted probability and the conditional logical fidelity are polynomials in p. Writing the weight of a k-fault pattern as (1‚àíp)^{5‚àík} (p/15)^k, we have<ul>
<li>Acceptance probability:
  Pacc(p) = ‚àë_{k=0}^{5} Ak (1‚àíp)^{5‚àík} (p/15)^k.</li>
<li>Numerator for fidelity:
  Ngood(p) = ‚àë_{k=0}^{5} Gk (1‚àíp)^{5‚àík} (p/15)^k.</li>
<li>Logical fidelity conditioned on acceptance:
  Flogical(p) = Ngood(p)/Pacc(p).</li>
</ul>
</li>
<li>Expanding and simplifying yields exact rational polynomials</li>
</ul>
<div class="arithmatex">\[
    P_{\rm acc}(p)
    = 1 - \frac{68}{15}p + \frac{704}{75}p^2 - \frac{32768}{3375}p^3
      + \frac{253952}{50625}p^4 - \frac{262144}{253125}p^5,
\]</div>
<div class="arithmatex">\[
    N_{\rm good}(p)
    = 1 - \frac{68}{15}p + \frac{656}{75}p^2 - \frac{29312}{3375}p^3
      + \frac{223232}{50625}p^4 - \frac{229376}{253125}p^5.
\]</div>
<div class="codehilite"><pre><span></span><code>Hence
</code></pre></div>

<div class="arithmatex">\[
    F_{\rm logical}(p)=\frac{N_{\rm good}(p)}{P_{\rm acc}(p)}.
\]</div>
<ul>
<li>Small-p expansion:</li>
</ul>
<div class="arithmatex">\[
    F_{\rm logical}(p)=1 - \frac{16}{25}\,p^2 + O(p^3),
\]</div>
<div class="codehilite"><pre><span></span><code>i.e., all O(p) logical errors are removed by the post-selection and the ancilla (flag) parity check, as expected for a single-fault-tolerant state-preparation gadget. ([arxiv.org](https://arxiv.org/abs/1811.00566?utm_source=openai))
</code></pre></div>

<p>2) Mathematical identities and rules used
- Stabilizer-code acceptance criterion = commutation of error with stabilizers; logical operators defined modulo stabilizers; commuting with Z-logicals preserves the |00ÃÑ‚ü© state. (<a href="https://en.wikipedia.org/wiki/Stabilizer_code?utm_source=openai">en.wikipedia.org</a>, <a href="https://ar5iv.labs.arxiv.org/html/1309.5598?utm_source=openai">ar5iv.labs.arxiv.org</a>)
- Clifford/Pauli conjugation through CNOT (used to propagate faults). (<a href="https://zxcalc.github.io/book/html/main_htmlch6.html?utm_source=openai">zxcalc.github.io</a>)
- Two-qubit depolarizing/Pauli channel at the uniform-Pauli point (15 non-identity Paulis with equal probability). (<a href="https://qiskit.github.io/qiskit-aer/stubs/qiskit_aer.noise.depolarizing_error.html?utm_source=openai">qiskit.github.io</a>)
- Parity measurement with two CNOTs to a Z-measured ancilla. (<a href="https://en.wikipedia.org/wiki/Parity_measurement?utm_source=openai">en.wikipedia.org</a>)</p>
<p>3) Conventions and units
- Qubits 0‚Äì3 are data; qubit 4 is an ancilla measured in Z. H and measurements are ideal. A two-qubit depolarizing error acts after each CNOT. Fidelity F = ‚ü®œàtarget|œÅlogical|œàtarget‚ü©.</p>
<p>4) Final Answer:</p>
<div class="arithmatex">\[
F_{\rm logical}(p)
=\frac{1 - \frac{68}{15}p + \frac{656}{75}p^2 - \frac{29312}{3375}p^3
      + \frac{223232}{50625}p^4 - \frac{229376}{253125}p^5}
      {1 - \frac{68}{15}p + \frac{704}{75}p^2 - \frac{32768}{3375}p^3
      + \frac{253952}{50625}p^4 - \frac{262144}{253125}p^5}
= 1 - \frac{\frac{16}{25}p^2 - \frac{128}{125}p^3 + \frac{2048}{3375}p^4 - \frac{32768}{253125}p^5}
        {1 - \frac{68}{15}p + \frac{704}{75}p^2 - \frac{32768}{3375}p^3
      + \frac{253952}{50625}p^4 - \frac{262144}{253125}p^5}\,,
\]</div>
<p>so in particular <span class="arithmatex">\(F_{\rm logical}(p)=1-\frac{16}{25}p^2+O(p^3)\)</span>.</p></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#19</span>
    </div>
    <div class="content markdown-body"><p>Populate your final answer into the code template provided below. This step is purely for formatting/display purposes. No additional reasoning or derivation should be performed. Do not import any modules or packages beyond what is provided in the template.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">answer</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the expression of the logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    at the end of the circuit as a function of two-qubit gate error rate $p$.</span>

<span class="sd">    Inputs</span>
<span class="sd">    ----------</span>
<span class="sd">    p: sympy.Symbol, two-qubit gate error rate, $p$</span>

<span class="sd">    Outputs</span>
<span class="sd">    ----------</span>
<span class="sd">    F_logical: sympy.Expr, logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ------------------ FILL IN YOUR RESULTS BELOW ------------------</span>
    <span class="n">F_logical</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># a SymPy expression of inputs</span>
    <span class="c1"># ---------------------------------------------------------------</span>

    <span class="k">return</span> <span class="n">F_logical</span>
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#20</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">answer</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the expression of the logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    at the end of the circuit as a function of two-qubit gate error rate $p$.</span>

<span class="sd">    Inputs</span>
<span class="sd">    ----------</span>
<span class="sd">    p: sympy.Symbol, two-qubit gate error rate, $p$</span>

<span class="sd">    Outputs</span>
<span class="sd">    ----------</span>
<span class="sd">    F_logical: sympy.Expr, logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ------------------ FILL IN YOUR RESULTS BELOW ------------------</span>
    <span class="n">num</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">1</span>
        <span class="o">-</span> <span class="n">sp</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">68</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
        <span class="o">+</span> <span class="n">sp</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">656</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">**</span><span class="mi">2</span>
        <span class="o">-</span> <span class="n">sp</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">29312</span><span class="p">,</span> <span class="mi">3375</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">**</span><span class="mi">3</span>
        <span class="o">+</span> <span class="n">sp</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">223232</span><span class="p">,</span> <span class="mi">50625</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">**</span><span class="mi">4</span>
        <span class="o">-</span> <span class="n">sp</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">229376</span><span class="p">,</span> <span class="mi">253125</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">**</span><span class="mi">5</span>
    <span class="p">)</span>
    <span class="n">den</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">1</span>
        <span class="o">-</span> <span class="n">sp</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">68</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
        <span class="o">+</span> <span class="n">sp</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">704</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">**</span><span class="mi">2</span>
        <span class="o">-</span> <span class="n">sp</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">32768</span><span class="p">,</span> <span class="mi">3375</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">**</span><span class="mi">3</span>
        <span class="o">+</span> <span class="n">sp</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">253952</span><span class="p">,</span> <span class="mi">50625</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">**</span><span class="mi">4</span>
        <span class="o">-</span> <span class="n">sp</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mi">262144</span><span class="p">,</span> <span class="mi">253125</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="o">**</span><span class="mi">5</span>
    <span class="p">)</span>
    <span class="n">F_logical</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>  <span class="c1"># a SymPy expression of inputs</span>
    <span class="c1"># ---------------------------------------------------------------</span>

    <span class="k">return</span> <span class="n">F_logical</span>
</code></pre></div></div>
</article>

</div>

<footer>
  Generated at 2025-09-24T22:02:11.845138
</footer>

<script>
(function() {
  // Tabs
  const tabs = document.querySelectorAll('.tab');
  const panels = document.querySelectorAll('.tab-content');
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      panels.forEach(p => p.classList.remove('active'));
      tab.classList.add('active');
      const target = document.querySelector(tab.dataset.target);
      if (target) target.classList.add('active');
    });
  });

  // Theme toggle
  const toggleBtn = document.getElementById('theme-toggle');
  function setTheme(dark) {
    if (dark) {
      document.documentElement.classList.add('dark');
      localStorage.setItem('dark', '1');
    } else {
      document.documentElement.classList.remove('dark');
      localStorage.setItem('dark', '0');
    }
  }
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const stored = localStorage.getItem('dark');
  setTheme(stored === null ? prefersDark : stored === '1');

  toggleBtn.addEventListener('click', () => {
    const isDark = document.documentElement.classList.contains('dark');
    setTheme(!isDark);
  });
})();
</script>
</body>
</html>