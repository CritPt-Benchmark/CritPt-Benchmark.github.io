<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Checkpoint-3</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #3D7B7B; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #F00 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666 } /* Operator */
.codehilite .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #9C6500 } /* Comment.Preproc */
.codehilite .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.codehilite .gr { color: #E40000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #008400 } /* Generic.Inserted */
.codehilite .go { color: #717171 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #04D } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #687822 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #00F; font-weight: bold } /* Name.Class */
.codehilite .no { color: #800 } /* Name.Constant */
.codehilite .nd { color: #A2F } /* Name.Decorator */
.codehilite .ni { color: #717171; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #00F } /* Name.Function */
.codehilite .nl { color: #767600 } /* Name.Label */
.codehilite .nn { color: #00F; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #A2F; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #BBB } /* Text.Whitespace */
.codehilite .mb { color: #666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666 } /* Literal.Number.Float */
.codehilite .mh { color: #666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #A45A77 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #00F } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666 } /* Literal.Number.Integer.Long */

</style>
<style>
    :root {
  --bg: #ffffff;
  --fg: #222222;
  --muted: #555555;
  --border: #e0e0e0;
  --accent: #005fcc;
  --code-bg: #f6f8fa;
  --role-user: #0ea5e9;
  --role-assistant: #22c55e;
  --role-system: #9ca3af;
  --return-code: #a35291;
}
html.dark {
  --bg: #0b0b0b;
  --fg: #e8e8e8;
  --muted: #a0a0a0;
  --border: #333333;
  --accent: #3b82f6;
  --code-bg: #111827;
  --role-user: #0ea5e9;
  --role-assistant: #22c55e;
  --role-system: #9ca3af;
  --return-code: #a35291;
}
* {
  box-sizing: border-box;
}
body {
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--fg);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", sans-serif;
  line-height: 1.6;
}
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 1.25rem;
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  background: var(--bg);
  z-index: 10;
}
h1 {
  margin: 0;
  font-size: 1.1rem;
}
.tabs {
  display: flex;
  gap: 0.5rem;
}
.tab {
  padding: 0.4rem 0.8rem;
  border: 1px solid var(--border);
  border-bottom: none;
  background: transparent;
  cursor: pointer;
  border-radius: 6px 6px 0 0;
  color: var(--fg);
}
.tab.active {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
}
.tab-content {
  display: none;
  padding: 1rem 1.25rem;
  border-top: 1px solid var(--border);
}
.tab-content.active {
  display: block;
}
#theme-toggle {
  border: 1px solid var(--border);
  padding: 0.2rem 0.6rem;
  font-size: 0.9rem;
  border-radius: 4px;
  cursor: pointer;
  background: transparent;
  color: var(--fg);
}
.main {
  max-width: 1200px;
  margin: 0 auto;
}
.message {
  border: 1px solid var(--border);
  border-left-width: 6px;
  border-radius: 6px;
  padding: 0.8rem 1rem;
  margin-bottom: 1rem;
  background: rgba(0,0,0,0.02);
}
.message .meta {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  margin-bottom: 0.6rem;
  color: var(--muted);
  font-size: 0.85rem;
}
.message .badge {
  font-weight: 600;
}
.role-user {
  border-left-color: var(--role-user);
}
.role-assistant {
  border-left-color: var(--role-assistant);
}
.role-system {
  border-left-color: var(--role-system);
}
.role-unknown {
  border-left-color: var(--accent);
}

.output-code-container {
  display: flex;
  gap: 1rem;               /* space between children */
  align-items: center;     /* vertical alignment */
  justify-content: start;  /* horizontal alignment */
}

.output-code-container .codeblock {
  flex: 0 1 auto;
}

.codeblock {
  border: 1px solid var(--border);
  border-left-width: 6px;
  border-radius: 6px;
  padding: 0.8rem 1rem;
  margin-bottom: 1rem;
  background: rgba(0,0,0,0.02);
}
.codeblock-content {
  margin-bottom: 0.6rem;
  border: 1px dashed var(--border);
  border-radius: 4px;
  padding: 0.4rem 0.6rem;
  background: rgba(0,0,0,0.02);
}

.codeblock.eval_code {
  border-left-color: var(--role-user);
}
.codeblock.target_code {
  border-left-color: var(--role-assistant);
}
.codeblock.output_code {
  border-left-color: var(--role-system);
}

html.dark .codeblock-content {
  background: rgba(255,255,255,0.03);
}
.codeblock > summary {
  cursor: pointer;
  font-weight: 600;
  list-style: none; /* remove default triangle in some browsers */
}
.codeblock > summary::-webkit-details-marker {
  display: none; /* Safari/Chrome marker */
}
.codeblock > summary::before {
  content: "‚ñ∂ ";
  display: inline-block;
  transform: rotate(0deg);
  transition: transform 0.12s ease-out;
}
.codeblock[open] > summary::before {
  transform: rotate(90deg);
}
.codeblock .tag {
  color: var(--muted);
  font-weight: 400;
  font-size: 0.85em;
  margin-left: 0.25rem;
}

.markdown-body pre code {
  background: var(--code-bg);
  display: block;
  padding: 0.75rem;
  overflow-x: auto;
  border-radius: 4px;
  border: 1px solid var(--border);
}
.markdown-body code {
  background: var(--code-bg);
  padding: 0.15rem 0.3rem;
  border-radius: 4px;
}
/* Extra info tree */
details > summary {
  cursor: pointer;
  font-weight: 600;
}
details .block {
  padding-left: 1rem;
  margin: 0.25rem 0 0.5rem 0;
  border-left: 2px solid var(--border);
}
.kv .key {
  font-weight: 600;
}
.kv .type {
  color: var(--muted);
  margin-left: 0.5rem;
  font-size: 0.85rem;
}
footer {
  margin: 2rem 0;
  text-align: center;
  color: var(--muted);
  font-size: 0.85rem;
}
/* CodeHilite (pygments) overrides to respect theme vars */
.codehilite {
  background: var(--code-bg) !important;
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 0.75rem !important;
}
.reasoning {
  margin-bottom: 0.6rem;
  border: 1px dashed var(--border);
  border-radius: 4px;
  padding: 0.4rem 0.6rem;
  background: rgba(0,0,0,0.02);
}
html.dark .reasoning {
  background: rgba(255,255,255,0.03);
}
.reasoning > summary {
  cursor: pointer;
  font-weight: 600;
  list-style: none; /* remove default triangle in some browsers */
}
.reasoning > summary::-webkit-details-marker {
  display: none; /* Safari/Chrome marker */
}
.reasoning > summary::before {
  content: "‚ñ∂ ";
  display: inline-block;
  transform: rotate(0deg);
  transition: transform 0.12s ease-out;
}
.reasoning[open] > summary::before {
  transform: rotate(90deg);
}
.reasoning .tag {
  color: var(--muted);
  font-weight: 400;
  font-size: 0.85em;
  margin-left: 0.25rem;
}
.reasoning-body {
  margin-top: 0.5rem;
}
</style>

<!-- ===== MATHJAX CONFIG ===== -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [ ["\\(","\\)"] ],
    displayMath: [ ["\\[","\\]"] ],
    processEscapes: true,
    processEnvironments: true
  },
  options: {
    ignoreHtmlClass: ".*",
    processHtmlClass: "arithmatex"

    // skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    // if you dynamically add content later, you can call MathJax.typesetPromise()
  }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<!-- ========================== -->
</head>
<body>
<header>
  <h1>Checkpoint-3</h1>
  <div>
    <button id="theme-toggle" aria-label="toggle dark mode">üåì</button>
  </div>
</header>

<div class="main">
  
<article class="message role-system">
    <div class="meta">
        <span class="badge">System</span>
        <span class="idx">#0</span>
    </div>
    <div class="content markdown-body"><p>You are a physics research assistant specializing in solving complex, research-level problems using precise, step-by-step reasoning.</p>
<p><strong>Input</strong>
Problems will be provided in Markdown format.</p>
<p><strong>Output (Markdown format)</strong></p>
<ol>
<li><strong>Step-by-Step Derivation</strong> - Show every non-trivial step in the solution.  Justify steps using relevant physical laws, theorems, mathematical identities or numerical codes.</li>
<li><strong>Mathematical Typesetting</strong> - Use LaTeX for all mathematics:  <code>$...$</code> for inline expressions, <code>$$...$$</code> for display equations.</li>
<li><strong>Conventions and Units</strong> - Follow the unit system and conventions specified in the problem.</li>
<li>
<p><strong>Final Answer</strong> - At the end of the solution,  start a new line with <strong>&ldquo;Final Answer:&rdquo;</strong>, and present the final result.</p>
<p>For final answers involving values, follow the precision requirements specified in the problem.
If no precision is specified:
- If an exact value is possible, provide it (e.g., \$\sqrt(2)\$, \$\pi/4\$).
- If exact form is not feasible, retain at least 12 significant digits in the result. </p>
</li>
<li>
<p><strong>Formatting Compliance</strong> - If the user requests a specific output format (e.g., code, table),  provide the final answer accordingly.
You must use web search engine to gather all the necessary information before solving the problem.
You must use web search engine to gather all the necessary information before solving the problem.
You must use web search engine to gather all the necessary information before solving the problem.</p>
</li>
</ol></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#1</span>
    </div>
    <div class="content markdown-body"><h1 id="problem-setup">Problem setup:</h1>
<p>In quantum error correction, you encode quantum states into logical states made of many qubits in order to improve their resilience to errors. In quantum error detection, you do the same but can only detect the presence of errors and not correct them. In this problem, we will consider a single [[4,2,2]] quantum error detection code, which encodes two logical qubits into four physical qubits, and investigate how robust logical quantum operations in this code are to quantum errors.</p>
<p>Our convention is that the four physical qubits in the [[4,2,2]] code are labelled 0,1,2,3. The two logical qubits are labelled A and B. The stabilizers are <span class="arithmatex">\(XXXX\)</span> and <span class="arithmatex">\(ZZZZ\)</span>, where <span class="arithmatex">\(X\)</span> and <span class="arithmatex">\(Z\)</span> are Pauli matrices. The logical <span class="arithmatex">\(X\)</span> and <span class="arithmatex">\(Z\)</span> operators on the two qubits are <span class="arithmatex">\(X_A = XIXI\)</span>, <span class="arithmatex">\(X_B=XXII\)</span>, <span class="arithmatex">\(Z_A = ZZII\)</span>, <span class="arithmatex">\(Z_B = ZIZI\)</span>, up to multiplication by stabilizers.</p>
<p>We will consider different state preparation circuits consisting of controlled not <span class="arithmatex">\(CNOT_{ij}\)</span> gates, where <span class="arithmatex">\(CNOT_{ij}\)</span> has control qubit <span class="arithmatex">\(i\)</span> and target qubit <span class="arithmatex">\(j\)</span>. As a simple model of quantum errors in hardware, we will suppose that each <span class="arithmatex">\(CNOT_{ij}\)</span> gate in the circuit has a two qubit depolarizing error channel following it that produces one of the 15 non-identity two-qubit Paulis with equal probability <span class="arithmatex">\(p/15\)</span>. The probability <span class="arithmatex">\(p\)</span> indicates the probability of an error in a single two-qubit gate. We will assess the logical infidelity of certain state preparation protocols as a function of the physical infidelity <span class="arithmatex">\(p\)</span>.</p>
<h2 id="subproblem-1">Checkpoint 1</h2>
<p>Suppose that we wish to prepare a logical two-qubit GHZ state  <span class="arithmatex">\((|00\rangle_{AB}+|11\rangle_{AB})/\sqrt{2}\)</span> in the [[4,2,2]] code. To do so, we use the following state preparation circuit:</p>
<div class="arithmatex">\[
(CNOT_{03}) (H_0) (CNOT_{21}) (H_2).
\]</div>
<p>Note that this equation is written in matrix multiplication order, while the quantum operations in the circuit occur in the reverse order (from right-to-left in the above equation). <span class="arithmatex">\(H\)</span> is a single-qubit Hadamard gate.</p>
<p>What is the physical state fidelity of the final physical 4-qubit state at the end of the circuit as a function of the two-qubit gate error rate <span class="arithmatex">\(p\)</span>?</p></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#2</span>
    </div>
    <div class="content markdown-body"><p>1) Step-by-Step Derivation</p>
<ul>
<li>Noise model and goal</li>
</ul>
<p>Each CNOT in the circuit is followed by an independent two-qubit depolarizing channel on the same two qubits that, with probability p, applies one of the 15 non-identity two-qubit Pauli operators equiprobably (probability p/15 each), and with probability 1 ‚àí p applies identity. We are asked for the physical state fidelity F(p) = ‚ü®œàideal|œÅout|œàideal‚ü© of the final 4-qubit state produced by the noisy circuit with respect to the ideal state produced by the same circuit without noise.</p>
<ul>
<li>Ideal state prepared by the circuit</li>
</ul>
<p>Circuit (right-to-left order): H2 ‚Üí CNOT21 ‚Üí H0 ‚Üí CNOT03, acting on |0000‚ü©.</p>
<p>Use H|0‚ü© = (|0‚ü© + |1‚ü©)/‚àö2 and that CNOT flips the target iff the control is |1‚ü©. (<a href="https://en.wikipedia.org/wiki/Hadamard_transform?utm_source=openai">en.wikipedia.org</a>)</p>
<p>1) After H2:
     |œà1‚ü© = |0‚ü©0 |0‚ü©1 (|0‚ü©2 + |1‚ü©2)/‚àö2 |0‚ü©3
           = (|0000‚ü© + |0110‚ü©)/‚àö2.</p>
<p>2) After CNOT21 (control 2, target 1): already included above; |œà1‚ü© = (|0000‚ü© + |0110‚ü©)/‚àö2.</p>
<p>3) After H0:
     |œà2‚ü© = (1/2)(|0000‚ü© + |1000‚ü© + |0110‚ü© + |1110‚ü©).</p>
<p>4) After CNOT03 (control 0, target 3):
     |œàideal‚ü© = (1/2)(|0000‚ü© + |1001‚ü© + |0110‚ü© + |1111‚ü©).</p>
<p>Recognize this as a tensor product of two Bell states (on qubit pairs 0‚Äì3 and 1‚Äì2):
  |œàideal‚ü© = |Œ¶+‚ü©03 ‚äó |Œ¶+‚ü©12 with |Œ¶+‚ü© = (|00‚ü© + |11‚ü©)/‚àö2. (<a href="https://en.wikipedia.org/wiki/Bell_state">en.wikipedia.org</a>)</p>
<ul>
<li>Where the noise acts</li>
</ul>
<p>The depolarizing channels act:
  - after CNOT21 on qubits (2,1) (i.e., the pair 1‚Äì2), and
  - after CNOT03 on qubits (0,3) (the pair 0‚Äì3).</p>
<p>No subsequent gates touch those qubits across pairs, so the two error channels act independently on the two disjoint Bell pairs and do not propagate to the other pair.</p>
<ul>
<li>Fidelity for a single Bell pair under a two-qubit depolarizing channel</li>
</ul>
<p>Let œÅ = |Œ¶+‚ü©‚ü®Œ¶+| and apply the two-qubit depolarizing channel once:
  Œõ(œÅ) = (1 ‚àí p)œÅ + (p/15)‚àëP‚â†I PœÅP, where the sum ranges over the 15 non-identity two-qubit Paulis on that pair (as stated in the problem). The state fidelity with respect to |Œ¶+‚ü© is</p>
<p>Fpair(p) = ‚ü®Œ¶+|Œõ(œÅ)|Œ¶+‚ü©
           = (1 ‚àí p) + (p/15)‚àëP‚â†I |‚ü®Œ¶+|P|Œ¶+‚ü©|^2.</p>
<p>For |Œ¶+‚ü©, the only two-qubit Paulis with nonzero expectation are
  X ‚äó X, Y ‚äó Y, Z ‚äó Z, with eigenvalues +1, ‚àí1, +1, respectively; all other two-qubit Paulis have expectation 0. Therefore
  ‚àëP‚â†I |‚ü®Œ¶+|P|Œ¶+‚ü©|^2 = 1^2 + (‚àí1)^2 + 1^2 = 3.</p>
<p>Hence
  Fpair(p) = (1 ‚àí p) + (p/15)¬∑3 = 1 ‚àí (4/5)p.</p>
<ul>
<li>Total 4-qubit fidelity</li>
</ul>
<p>The final ideal state is |Œ¶+‚ü©03 ‚äó |Œ¶+‚ü©12 and the two depolarizing channels act independently on 03 and 12. The overall fidelity is therefore the product of the independent pair fidelities:
  F(p) = Fpair(p)^2 = [1 ‚àí (4/5)p]^2.</p>
<p>As a quick consistency check: at p = 1, each pair has fidelity 3/15 = 1/5 with |Œ¶+‚ü©, so the 4-qubit fidelity is (1/5)^2 = 1/25 = 0.04, which matches F(1) = [1 ‚àí 4/5]^2 = (1/5)^2.</p>
<p>2) Mathematical Typesetting</p>
<ul>
<li>Key equations provided above in LaTeX form.</li>
</ul>
<p>3) Conventions and Units</p>
<ul>
<li>Qubits labeled 0,1,2,3; CNOTij has control i and target j; H as standard Hadamard; Bell state definition |Œ¶+‚ü© = (|00‚ü© + |11‚ü©)/‚àö2. (<a href="https://en.wikipedia.org/wiki/Controlled_NOT_gate?utm_source=openai">en.wikipedia.org</a>)</li>
</ul>
<p>4) Final Answer:
F(p) = [1 ‚àí (4/5)p]^2.</p></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#3</span>
    </div>
    <div class="content markdown-body"><h2 id="subproblem-2">Checkpoint 2</h2>
<p>Suppose that we wish to prepare a logical two-qubit GHZ state  <span class="arithmatex">\((|00\rangle_{AB}+|11\rangle_{AB})/\sqrt{2}\)</span> in the [[4,2,2]] code. To do so, we use the following state preparation circuit:</p>
<div class="arithmatex">\[
(CNOT_{03}) (H_0) (CNOT_{21}) (H_2).
\]</div>
<p>Note that this equation is written in matrix multiplication order, while the quantum operations in the circuit occur in the reverse order (from right-to-left in the above equation). <span class="arithmatex">\(H\)</span> is a single-qubit Hadamard gate.</p>
<p>What is the logical state fidelity of the final 2-qubit logical state at the end of the circuit as a function of the two-qubit gate error rate <span class="arithmatex">\(p\)</span>, assuming the state is post-selected on all detectable errors in the code?</p></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#4</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>
<span class="n">letters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
<span class="c1"># mapping: (vX, vZ) bits for a single site relative to X and Z anticommute parity</span>
<span class="n">bit</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;I&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;X&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;Y&#39;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;Z&#39;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)}</span>
<span class="c1"># two-qubit on a pair (ordered letters)</span>
<span class="n">all_pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">letters</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">]</span>
<span class="c1"># exclude identity pair</span>
<span class="n">nonid_pairs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_pairs</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;I&#39;</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;I&#39;</span><span class="p">)]</span>
<span class="c1"># compute parity class for each pair</span>
<span class="n">par</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="p">((</span><span class="n">bit</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span><span class="o">^</span><span class="n">bit</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">bit</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="n">bit</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]))</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>
<span class="n">cnt</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">par</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">nonid_pairs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;counts per parity on a pair:&#39;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
<span class="c1"># Accept if par(P)==par(Q)</span>
<span class="n">nonid_pairs_list</span> <span class="o">=</span> <span class="n">nonid_pairs</span>
<span class="n">N_acc</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">N_good</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">acc_examples</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">nonid_pairs_list</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">Q</span> <span class="ow">in</span> <span class="n">nonid_pairs_list</span><span class="p">:</span>
        <span class="c1"># acceptance if par(P)==par(Q)</span>
        <span class="k">if</span> <span class="n">par</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">==</span><span class="n">par</span><span class="p">(</span><span class="n">Q</span><span class="p">):</span>
            <span class="n">N_acc</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># good if both parities are (0,0)</span>
            <span class="k">if</span> <span class="n">par</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">==</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">N_good</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">acc_examples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">P</span><span class="p">,</span><span class="n">Q</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;N_acc&#39;</span><span class="p">,</span> <span class="n">N_acc</span><span class="p">,</span> <span class="s1">&#39;N_good&#39;</span><span class="p">,</span> <span class="n">N_good</span><span class="p">)</span>
<span class="c1"># sanity: examples</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;first few good examples:&#39;</span><span class="p">,</span> <span class="n">acc_examples</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#5</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>counts per parity on a pair: Counter({(0, 1): 4, (1, 1): 4, (1, 0): 4, (0, 0): 3})
N_acc 57 N_good 9
first few good examples: [((&#39;X&#39;, &#39;X&#39;), (&#39;X&#39;, &#39;X&#39;)), ((&#39;X&#39;, &#39;X&#39;), (&#39;Y&#39;, &#39;Y&#39;)), ((&#39;X&#39;, &#39;X&#39;), (&#39;Z&#39;, &#39;Z&#39;)), ((&#39;Y&#39;, &#39;Y&#39;), (&#39;X&#39;, &#39;X&#39;)), ((&#39;Y&#39;, &#39;Y&#39;), (&#39;Y&#39;, &#39;Y&#39;)), ((&#39;Y&#39;, &#39;Y&#39;), (&#39;Z&#39;, &#39;Z&#39;))]
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#6</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="n">p</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">Pacc</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">57</span><span class="o">/</span><span class="p">(</span><span class="mi">15</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span>
<span class="n">Pgood</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">9</span><span class="o">/</span><span class="p">(</span><span class="mi">15</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span>
<span class="n">F</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">Pgood</span><span class="o">/</span><span class="n">Pacc</span><span class="p">)</span>
<span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;F=&#39;</span><span class="p">,</span><span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">F</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;expanded numerator=&#39;</span><span class="p">,</span><span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">F</span><span class="p">)</span><span class="o">.</span><span class="n">as_numer_denom</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;expanded denominator=&#39;</span><span class="p">,</span><span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">F</span><span class="p">)</span><span class="o">.</span><span class="n">as_numer_denom</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#7</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>F= (0.64*p**2 - 1.6*p + 1.0)/(0.853333333333333*p**2 - 1.6*p + 1.0)
expanded numerator= 0.64*p**2 - 1.6*p + 1.0
expanded denominator= 0.853333333333333*p**2 - 1.6*p + 1.0
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#8</span>
    </div>
    <div class="content markdown-body"><p>1) Step-by-Step Derivation</p>
<ul>
<li>
<p>Setup, code and circuit</p>
</li>
<li>
<p>[[4,2,2]] code: stabilizers S = ‚ü®XXXX, ZZZZ‚ü©. The codespace is the simultaneous +1 eigenspace of these two commuting generators. (<a href="https://ar5iv.labs.arxiv.org/html/1907.11157v1?utm_source=openai">ar5iv.labs.arxiv.org</a>, <a href="https://en.wikipedia.org/wiki/Stabilizer_code?utm_source=openai">en.wikipedia.org</a>)</p>
</li>
<li>Logical GHZ target on logical qubits A,B: (|00‚ü©AB + |11‚ü©AB)/‚àö2.</li>
<li>
<p>Circuit (right-to-left action): H2 ‚Üí CNOT21 ‚Üí H0 ‚Üí CNOT03 on input |0000‚ü©.</p>
</li>
<li>
<p>Ideal output state of the circuit</p>
</li>
</ul>
<p>Apply H and CNOT pairwise:
  1) H2; CNOT21 prepares a Bell pair on qubits (2,1): |Œ¶+‚ü©12.
  2) H0; CNOT03 prepares another Bell pair on qubits (0,3): |Œ¶+‚ü©03.</p>
<p>Therefore the ideal 4-qubit output is</p>
<div class="arithmatex">\[
\]</div>
<p>The Bell state |Œ¶+‚ü© is stabilized by XX and ZZ (equivalently by {II, XX, ZZ, ‚àíYY} with generators XX, ZZ). Hence</p>
<div class="arithmatex">\[
(X_0X_3X_1X_2)|\psi_{\text{ideal}}\rangle=(X^{\otimes 4})|\psi_{\text{ideal}}\rangle=|\psi_{\text{ideal}}\rangle,
\]</div>
<div class="arithmatex">\[
(Z_0Z_3Z_1Z_2)|\psi_{\text{ideal}}\rangle=(Z^{\otimes 4})|\psi_{\text{ideal}}\rangle=|\psi_{\text{ideal}}\rangle,
\]</div>
<p>so the state lies in the [[4,2,2]] codespace. (<a href="https://en.wikipedia.org/wiki/Bell_state?utm_source=openai">en.wikipedia.org</a>, <a href="https://medium.com/qiskit/explore-the-clifford-group-a-crucial-tool-for-benchmarking-error-correction-and-more-b9fdca16bb46?utm_source=openai">medium.com</a>, <a href="https://errorcorrectionzoo.org/c/stab_4_2_2?utm_source=openai">errorcorrectionzoo.org</a>)</p>
<ul>
<li>Noise model</li>
</ul>
<p>Each CNOT gate is followed by an independent two-qubit depolarizing channel on the same two qubits that, with probability p, applies one of the 15 non-identity two-qubit Pauli operators uniformly (probability p/15 each), and with probability 1‚àíp applies identity. This is the standard ‚ÄúPauli version‚Äù of a two-qubit depolarizing channel. (<a href="https://en.wikipedia.org/wiki/Quantum_depolarizing_channel?utm_source=openai">en.wikipedia.org</a>, <a href="https://quantumchannelzoo.org/channel/depolarizing?utm_source=openai">quantumchannelzoo.org</a>)</p>
<p>Since the only two-qubit gates are CNOT21 and CNOT03 and the errors occur after these gates, the final error has the form</p>
<div class="arithmatex">\[
E = P_{03}\otimes Q_{12},
\]</div>
<p>where each of P03, Q12 ‚àà {II, IX, IY, IZ, XI, ‚Ä¶, ZZ} and independently equals II with probability 1‚àíp and any non-identity two-qubit Pauli with probability p/15.</p>
<ul>
<li>Post-selection (‚Äúdetect and discard‚Äù)</li>
</ul>
<p>We post-select on the ‚Äúno-error-detected‚Äù syndrome, i.e., both stabilizer measurements XXXX and ZZZZ return +1. For a Pauli error E, this occurs iff E commutes with both stabilizer generators; otherwise it anticommutes with at least one and is rejected. (<a href="https://learning.quantum.ibm.com/course/foundations-of-quantum-error-correction/the-stabilizer-formalism?utm_source=openai">learning.quantum.ibm.com</a>, <a href="https://en.wikipedia.org/wiki/Stabilizer_code?utm_source=openai">en.wikipedia.org</a>)</p>
<ul>
<li>Commutation bookkeeping by parity classes</li>
</ul>
<p>For a two-qubit Pauli on a pair (say, qubits a,b), define the parity vector</p>
<div class="arithmatex">\[
\pi(P_{ab})=\big(\pi_Z(P_{ab}),\,\pi_X(P_{ab})\big)\in\{0,1\}^2,
\]</div>
<p>where œÄZ(Pab) is 1 iff Pab anticommutes with Z‚äóZ on that pair, and œÄX(Pab) is 1 iff Pab anticommutes with X‚äóX on that pair.</p>
<p>Using the binary (symplectic) representation of Paulis, the parity components are just the XOR of the single-qubit ‚ÄúZ-part‚Äù and ‚ÄúX-part‚Äù bits across the two sites. Concretely, for single-qubit L‚àà{I,X,Y,Z}, write bits b(L)=(vZ,vX) with
  I:(0,0), X:(0,1), Y:(1,1), Z:(1,0). Then for a pair Pab = La‚äóLb,</p>
<div class="arithmatex">\[
\pi(P_{ab}) = b(L_a)\oplus b(L_b).
\]</div>
<p>The full 4-qubit error E = P03‚äóQ12 commutes with X‚äó4 (resp. Z‚äó4) iff the X-parities (resp. Z-parities) of the two pairs match. Thus,</p>
<div class="arithmatex">\[
E\ \text{is accepted} \iff \pi(P_{03})=\pi(Q_{12}).
\]</div>
<p>This parity/symplectic-commutation correspondence is standard in stabilizer theory. (<a href="https://en.wikipedia.org/wiki/Stabilizer_code?utm_source=openai">en.wikipedia.org</a>)</p>
<ul>
<li>Enumerating parity classes on one pair</li>
</ul>
<p>The 15 non-identity two-qubit Paulis on a given pair split into four parity classes:</p>
<div class="arithmatex">\[
  \text{class} &amp; \# \\
  \hline
  \pi=(0,0)\ \text{(commutes with both XX, ZZ)} &amp; 3\ \ (\{XX,YY,ZZ\})\\
  \pi=(0,1) &amp; 4\\
  \pi=(1,0) &amp; 4\\
  \pi=(1,1) &amp; 4
\]</div>
<p>(Easy to check by the XOR rule, or by listing.) The class (0,0) is exactly the nontrivial stabilizer of |Œ¶+‚ü© on that pair, so acting with any of {XX,YY,ZZ} maps |Œ¶+‚ü© to ¬±|Œ¶+‚ü©. (<a href="https://medium.com/qiskit/explore-the-clifford-group-a-crucial-tool-for-benchmarking-error-correction-and-more-b9fdca16bb46?utm_source=openai">medium.com</a>)</p>
<ul>
<li>Which accepted errors are ‚Äúgood‚Äù (i.e., preserve the target state)?</li>
</ul>
<p>Since the ideal state is |Œ¶+‚ü©03‚äó|Œ¶+‚ü©12 and the 16 Bell-product states form an orthonormal basis, an accepted error E has nonzero overlap with the target if and only if it preserves each pair‚Äôs |Œ¶+‚ü© up to a global phase; otherwise it maps at least one pair to a different Bell state orthogonal to |Œ¶+‚ü©, yielding zero overlap. Therefore:
  - On a single pair, ‚Äúgood‚Äù non-identity Paulis are exactly {XX,YY,ZZ}, i.e., class (0,0).
  - For the full error E = P03‚äóQ12,
    - Acceptance requires œÄ(P03)=œÄ(Q12).
    - Goodness (nonzero overlap) requires P03‚àà{XX,YY,ZZ} and Q12‚àà{XX,YY,ZZ}.
    Hence among accepted double errors, only the 3√ó3=9 choices are good; the other accepted classes (matching non-(0,0) parities) are logical errors that change the encoded state within the codespace. (<a href="https://medium.com/qiskit/explore-the-clifford-group-a-crucial-tool-for-benchmarking-error-correction-and-more-b9fdca16bb46?utm_source=openai">medium.com</a>)</p>
<ul>
<li>Counting accepted vs. good events by error weight</li>
</ul>
<p>Let ‚Äúweight‚Äù mean how many gates suffered a non-identity two-qubit Pauli.
  - Weight 0: probability (1‚àíp)^2. Accepted and good.
  - Weight 1: exactly one of the two gates has a non-identity 2-qubit Pauli.
    - Acceptance requires that single-pair error be in class (0,0), i.e., one of {XX,YY,ZZ}. Count per gate = 3 of the 15 possibilities; with two gates total, accepted singles = 2√ó3.
    - All such singles are good because {XX,YY,ZZ} stabilizes |Œ¶+‚ü© on that pair.
    Probability contribution: 2¬∑(p/15)¬∑(1‚àíp)¬∑3 = (6/15)p(1‚àíp). Accepted = good.
  - Weight 2: both gates have non-identity 2-qubit Paulis.
    - Acceptance requires parity match across pairs. Using the class counts above,
      total accepted ordered pairs =
      3¬∑3 + 4¬∑4 + 4¬∑4 + 4¬∑4 = 9 + 16 + 16 + 16 = 57.
    - Good among these are exactly 3¬∑3 = 9 (both in class (0,0)).
    Probability contribution: (p/15)^2 times the respective counts.</p>
<p>Therefore</p>
<div class="arithmatex">\[
  P_{\text{acc}}(p) &amp;= (1-p)^2 + \frac{6}{15}p(1-p) + \frac{57}{15^2}p^2,\\
  P_{\text{good}}(p) &amp;= (1-p)^2 + \frac{6}{15}p(1-p) + \frac{9}{15^2}p^2.
\]</div>
<ul>
<li>Logical-state fidelity under post-selection</li>
</ul>
<p>Conditioning on acceptance, the (normalized) post-selected state is a classical mixture over accepted Pauli-error images. The only terms with nonzero overlap with |œàideal‚ü© are the ‚Äúgood‚Äù ones above; all other accepted terms are orthogonal (they are other Bell-product basis states). Hence the logical-state fidelity equals the good fraction of accepted shots:</p>
<div class="arithmatex">\[
F_{\text{logical}}(p)=\frac{P_{\text{good}}(p)}{P_{\text{acc}}(p)}.
\]</div>
<p>Plugging in and simplifying,</p>
<div class="arithmatex">\[
  F_{\text{logical}}(p)
  &amp;= \frac{(1-p)^2 + \frac{6}{15}p(1-p) + \frac{9}{225}p^2}
          {(1-p)^2 + \frac{6}{15}p(1-p) + \frac{57}{225}p^2}\\[2mm]
  &amp;= \frac{75 - 120p + 48p^2}{75 - 120p + 64p^2}.
\]</div>
<p>Series at small p: <span class="arithmatex">\(F_{\text{logical}}(p)=1 - \frac{16}{75}p^2 + O(p^3)\)</span>, i.e., all single-gate errors are detected and discarded; logical infidelity appears only at order p^2.</p>
<p>2) Mathematical Typesetting</p>
<ul>
<li>All key relations shown above in LaTeX.</li>
</ul>
<p>3) Conventions and Units</p>
<ul>
<li>Qubits labeled 0,1,2,3; stabilizers XXXX and ZZZZ; Bell-state facts (stabilizers XX, ZZ) and stabilizer-code detection rule (anticommute ‚áí detected) used as standard. (<a href="https://medium.com/qiskit/explore-the-clifford-group-a-crucial-tool-for-benchmarking-error-correction-and-more-b9fdca16bb46?utm_source=openai">medium.com</a>, <a href="https://learning.quantum.ibm.com/course/foundations-of-quantum-error-correction/the-stabilizer-formalism?utm_source=openai">learning.quantum.ibm.com</a>)</li>
</ul>
<p>4) Final Answer:</p>
<div class="arithmatex">\[
F_{\text{logical}}(p)=\frac{75 - 120\,p + 48\,p^2}{75 - 120\,p + 64\,p^2}.
\]</div>
<p>This satisfies Flogical(0)=1 and, to lowest order, 1‚àíFlogical(p)=\tfrac{16}{75}p^2+O(p^3).</p></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#9</span>
    </div>
    <div class="content markdown-body"><h2 id="subproblem-3">Checkpoint 3</h2>
<p>Suppose that we prepare a logical two-qubit <span class="arithmatex">\(|00\rangle_{AB}\)</span> state in the [[4,2,2]] code. To do so, we introduce an ancilla qubit, qubit 4, and use the following state preparation circuit:</p>
<div class="arithmatex">\[
M_4 (CNOT_{04}) (CNOT_{34}) (CNOT_{23}) (CNOT_{10}) (CNOT_{12}) (H_1)
\]</div>
<p>Note that this equation is written in matrix multiplication order, while the quantum operations in the circuit occur in the reverse order (from right-to-left in the above equation). <span class="arithmatex">\(H\)</span> is a single-qubit Hadamard gate and <span class="arithmatex">\(M\)</span> is a single-qubit measurement. The ancilla is used to detect errors in the state preparation circuit and makes the circuit fault-tolerant. If the ancilla measurement is <span class="arithmatex">\(|0\rangle\)</span> (<span class="arithmatex">\(|1\rangle\)</span>), the state preparation succeeds (fails).</p>
<p>What is the logical state fidelity of the final 2-qubit logical state at the end of the circuit as a function of two-qubit gate error rate <span class="arithmatex">\(p\)</span>, assuming the state is post-selected on all detectable errors in the code and on the ancilla qubit measuring <span class="arithmatex">\(|0\rangle\)</span>?</p></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#10</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>

<span class="c1"># Pauli representation helpers</span>
<span class="n">single_to_bits</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">bits_to_single</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span><span class="s1">&#39;I&#39;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span><span class="s1">&#39;X&#39;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="s1">&#39;Y&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="s1">&#39;Z&#39;</span><span class="p">}</span>

<span class="c1"># propagate Pauli (x,z) through CNOT(c-&gt;t): conjugation U P U^</span>
<span class="c1"># x,z are lists of 5 ints (0/1)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">propagate_through_cnot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
    <span class="c1"># Copy to avoid in-place illusions</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[:]</span>
    <span class="c1"># X on control propagates to target: x_t ^= x_c</span>
    <span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">^=</span> <span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
    <span class="c1"># Z on target propagates to control: z[c] ^= z[t]</span>
    <span class="n">z</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">^=</span> <span class="n">z</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">z</span>

<span class="c1"># Build list of gates in time order (1..5): CNOT12, CNOT10, CNOT23, CNOT34, CNOT04</span>
<span class="n">gates</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)]</span>

<span class="c1"># For each error location i in 0..4 (after gate i), subsequent gates indices are i+1..4</span>

<span class="c1"># 2-qubit Pauli alphabet for a pair</span>
<span class="n">letters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
<span class="n">pair_paulis</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">letters</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">]</span>  <span class="c1"># includes II</span>

<span class="c1"># Map 2-qubit Pauli on pair (c,t) to 5-qubit x,z</span>

<span class="k">def</span><span class="w"> </span><span class="nf">pair_to_5bits</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">pair</span>
    <span class="n">xa</span><span class="p">,</span><span class="n">za</span> <span class="o">=</span> <span class="n">single_to_bits</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
    <span class="n">xb</span><span class="p">,</span><span class="n">zb</span> <span class="o">=</span> <span class="n">single_to_bits</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
    <span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">=</span><span class="n">xa</span><span class="p">;</span> <span class="n">z</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">=</span><span class="n">za</span>
    <span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">=</span><span class="n">xb</span><span class="p">;</span> <span class="n">z</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">=</span><span class="n">zb</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">z</span>

<span class="c1"># Combine two Paulis in (x,z) rep: XOR sum</span>

<span class="k">def</span><span class="w"> </span><span class="nf">combine</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">z2</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="o">^</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="o">^</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span><span class="n">z2</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">z</span>

<span class="c1"># Evaluate acceptance and goodness</span>

<span class="k">def</span><span class="w"> </span><span class="nf">accepted_and_good</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
    <span class="c1"># Ancilla acceptance: no X or Y on qubit 4 =&gt; x4==0</span>
    <span class="n">anc_ok</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Code acceptance: commute with XXXX and ZZZZ on data 0..3</span>
    <span class="c1"># Commute with XXXX &lt;=&gt; even number of Z/Y on 0..3 =&gt; parity of z[0..3]==0</span>
    <span class="c1"># Commute with ZZZZ &lt;=&gt; even number of X/Y on 0..3 =&gt; parity of x[0..3]==0</span>
    <span class="n">data_x_par</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">^</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">^</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">data_z_par</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">^</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">^</span><span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">stab_ok</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_x_par</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">data_z_par</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">anc_ok</span> <span class="ow">and</span> <span class="n">stab_ok</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">acc</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
    <span class="c1"># Goodness: within accepted, we require no logical X_A or X_B component</span>
    <span class="c1"># Determine a,b by commutation with Z_A=ZZII (on 0,1) and Z_B=ZIZI (on 0,2)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">^</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># anticommute with Z_A</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">^</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># anticommute with Z_B</span>
    <span class="n">good</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">good</span>

<span class="c1"># Propagate a chosen pair Pauli at location i forward to end, return (x,z)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">forward_image_of_error_at_location</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
    <span class="n">c</span><span class="p">,</span><span class="n">t</span> <span class="o">=</span> <span class="n">gates</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span>
    <span class="n">x</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">pair_to_5bits</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="c1"># propagate through subsequent gates</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">loc</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gates</span><span class="p">)):</span>
        <span class="n">cj</span><span class="p">,</span><span class="n">tj</span> <span class="o">=</span> <span class="n">gates</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">x</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">propagate_through_cnot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">cj</span><span class="p">,</span><span class="n">tj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">z</span>

<span class="c1"># Precompute forward images for all locations and pair Paulis</span>
<span class="n">forward_images</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">pair_paulis</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pair_paulis</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">forward_image_of_error_at_location</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">forward_images</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>

<span class="c1"># Enumerate all combinations across 5 locations</span>
<span class="c1"># For each location choose index 0..15; index 0 corresponds to II; non-identity others</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="n">counts_acc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span>
<span class="n">counts_good</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span>
<span class="n">counts_total</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span>

<span class="c1"># We&#39;ll also compute acceptance/goodness ignoring weight to verify sum counts</span>

<span class="c1"># iterate over all 16^5 ~ 1,048,576 combinations</span>

<span class="n">choices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">choices</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="c1"># Build final x,z by combining images for all 5 locations</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sel</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">idx</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">weight</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">xi</span><span class="p">,</span><span class="n">zi</span> <span class="o">=</span> <span class="n">forward_images</span><span class="p">[</span><span class="n">loc</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">x</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">combine</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">xi</span><span class="p">,</span><span class="n">zi</span><span class="p">)</span>
    <span class="n">acc</span><span class="p">,</span> <span class="n">good</span> <span class="o">=</span> <span class="n">accepted_and_good</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
    <span class="n">counts_total</span><span class="p">[</span><span class="n">weight</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">acc</span><span class="p">:</span>
        <span class="n">counts_acc</span><span class="p">[</span><span class="n">weight</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">good</span><span class="p">:</span>
            <span class="n">counts_good</span><span class="p">[</span><span class="n">weight</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>

<span class="n">counts_acc</span><span class="p">,</span> <span class="n">counts_good</span><span class="p">,</span> <span class="n">counts_total</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#11</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>&#39;&#39;
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#12</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;counts_total by weight k=0..5:&#39;</span><span class="p">,</span> <span class="n">counts_total</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;counts_acc by weight:&#39;</span><span class="p">,</span> <span class="n">counts_acc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;counts_good by weight:&#39;</span><span class="p">,</span> <span class="n">counts_good</span><span class="p">)</span>
<span class="c1"># sanity checks: total combos = 16^5</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;total combos=&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">counts_total</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;acc_total=&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">counts_acc</span><span class="p">),</span> <span class="s1">&#39;good_total=&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">counts_good</span><span class="p">))</span>
</code></pre></div></div>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#13</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
NameError: name &#39;counts_total&#39; is not defined
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#14</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code><span class="c1"># Rerun enumeration carefully</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>

<span class="n">single_to_bits</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">letters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
<span class="n">pair_paulis</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">letters</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">letters</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">propagate_through_cnot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:];</span> <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[:]</span>
    <span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">^=</span> <span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
    <span class="n">z</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">^=</span> <span class="n">z</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">z</span>

<span class="n">gates</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">pair_to_5bits</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">;</span> <span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">pair</span>
    <span class="n">xa</span><span class="p">,</span><span class="n">za</span> <span class="o">=</span> <span class="n">single_to_bits</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
    <span class="n">xb</span><span class="p">,</span><span class="n">zb</span> <span class="o">=</span> <span class="n">single_to_bits</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
    <span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">=</span><span class="n">xa</span><span class="p">;</span> <span class="n">z</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">=</span><span class="n">za</span>
    <span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">=</span><span class="n">xb</span><span class="p">;</span> <span class="n">z</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">=</span><span class="n">zb</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">z</span>


<span class="k">def</span><span class="w"> </span><span class="nf">accepted_and_good</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
    <span class="n">anc_ok</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">data_x_par</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">^</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">^</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">data_z_par</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">^</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">^</span><span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">stab_ok</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_x_par</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">data_z_par</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">anc_ok</span> <span class="ow">and</span> <span class="n">stab_ok</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">acc</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">^</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">^</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">b</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">forward_image_of_error_at_location</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
    <span class="n">c</span><span class="p">,</span><span class="n">t</span> <span class="o">=</span> <span class="n">gates</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span>
    <span class="n">x</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">pair_to_5bits</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">loc</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gates</span><span class="p">)):</span>
        <span class="n">cj</span><span class="p">,</span><span class="n">tj</span> <span class="o">=</span> <span class="n">gates</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">x</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">propagate_through_cnot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">cj</span><span class="p">,</span><span class="n">tj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">z</span>

<span class="c1"># precompute images</span>
<span class="n">forward_images</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="mi">16</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pair_paulis</span><span class="p">):</span>
        <span class="n">forward_images</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">forward_image_of_error_at_location</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="n">counts_total</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span>
<span class="n">counts_acc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span>
<span class="n">counts_good</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span>

<span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">;</span> <span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span>
    <span class="n">weight</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sel</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">idx</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">weight</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">xi</span><span class="p">,</span><span class="n">zi</span> <span class="o">=</span> <span class="n">forward_images</span><span class="p">[</span><span class="n">loc</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">^</span><span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">)]</span>
            <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">^</span><span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">zi</span><span class="p">)]</span>
    <span class="n">acc</span><span class="p">,</span><span class="n">good</span> <span class="o">=</span> <span class="n">accepted_and_good</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
    <span class="n">counts_total</span><span class="p">[</span><span class="n">weight</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">acc</span><span class="p">:</span>
        <span class="n">counts_acc</span><span class="p">[</span><span class="n">weight</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">good</span><span class="p">:</span>
            <span class="n">counts_good</span><span class="p">[</span><span class="n">weight</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;total combos =&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">counts_total</span><span class="p">),</span> <span class="s1">&#39;should be&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;counts_total by weight:&#39;</span><span class="p">,</span> <span class="n">counts_total</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;counts_acc by weight:&#39;</span><span class="p">,</span> <span class="n">counts_acc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;counts_good by weight:&#39;</span><span class="p">,</span> <span class="n">counts_good</span><span class="p">)</span>
</code></pre></div></div>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#15</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>total combos = 1048576 should be 1048576
counts_total by weight: [1, 75, 2250, 33750, 253125, 759375]
counts_acc by weight: [1, 7, 282, 4222, 31637, 94923]
counts_good by weight: [1, 7, 138, 1198, 7397, 24027]
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#16</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="n">p</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">counts_acc</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">282</span><span class="p">,</span><span class="mi">4222</span><span class="p">,</span><span class="mi">31637</span><span class="p">,</span><span class="mi">94923</span><span class="p">]</span>
<span class="n">counts_good</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">138</span><span class="p">,</span><span class="mi">1198</span><span class="p">,</span><span class="mi">7397</span><span class="p">,</span><span class="mi">24027</span><span class="p">]</span>
<span class="c1"># probability polynomials</span>
<span class="n">Pacc</span><span class="o">=</span><span class="mi">0</span>
<span class="n">Pgood</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">counts_acc</span><span class="p">):</span>
    <span class="n">Pacc</span> <span class="o">+=</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span><span class="o">**</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">5</span><span class="o">-</span><span class="n">k</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">counts_good</span><span class="p">):</span>
    <span class="n">Pgood</span> <span class="o">+=</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span><span class="o">**</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">5</span><span class="o">-</span><span class="n">k</span><span class="p">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">Pgood</span><span class="o">/</span><span class="n">Pacc</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;F(p) =&#39;</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
<span class="n">num</span><span class="p">,</span><span class="n">den</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">together</span><span class="p">(</span><span class="n">F</span><span class="p">)</span><span class="o">.</span><span class="n">as_numer_denom</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;num degrees&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">num</span><span class="p">),</span> <span class="s1">&#39;den degrees&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">den</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;num expanded =&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;den expanded =&#39;</span><span class="p">,</span> <span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">den</span><span class="p">))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#17</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>F(p) = (229376*p**5 - 1116160*p**4 + 2198400*p**3 - 2214000*p**2 + 1147500*p - 253125)/(262144*p**5 - 1269760*p**4 + 2457600*p**3 - 2376000*p**2 + 1147500*p - 253125)
num degrees 5 den degrees 5
num expanded = 229376*p**5 - 1116160*p**4 + 2198400*p**3 - 2214000*p**2 + 1147500*p - 253125
den expanded = 262144*p**5 - 1269760*p**4 + 2457600*p**3 - 2376000*p**2 + 1147500*p - 253125
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#18</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="n">p</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="p">(</span><span class="mi">229376</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">1116160</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2198400</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2214000</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1147500</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="mi">253125</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">262144</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">1269760</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2457600</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2376000</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1147500</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="mi">253125</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#19</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">16</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mf">2</span><span class="o">/</span><span class="mf">25</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">704</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mf">3</span><span class="o">/</span><span class="mf">375</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">O</span><span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="mf">4</span><span class="p">)</span>
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#20</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="n">p</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">counts_acc</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">282</span><span class="p">,</span><span class="mi">4222</span><span class="p">,</span><span class="mi">31637</span><span class="p">,</span><span class="mi">94923</span><span class="p">]</span>
<span class="n">Pacc</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">counts_acc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span><span class="o">**</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">5</span><span class="o">-</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">Pacc</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">Pacc</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#21</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>-262144*p**5/253125 + 253952*p**4/50625 - 32768*p**3/3375 + 704*p**2/75 - 68*p/15 + 1
1 - 68*p/15 + 704*p**2/75 - 32768*p**3/3375 + O(p**4)
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#22</span>
    </div>
    
                    <details class="tool-call">
                      <summary>Tool Call <span class="tag">(code to execute)</span></summary>
                      <div class="markdown-body tool-call-body">
                        <div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="n">p</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="p">(</span><span class="mi">229376</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">1116160</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2198400</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2214000</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1147500</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="mi">253125</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">262144</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">1269760</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2457600</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2376000</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1147500</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="mi">253125</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;F(0)=&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;F(1)=&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
</code></pre></div>
                      </div>
                    </details>
</article>


<article class="message role-tool">
    <div class="meta">
        <span class="badge">Tool</span>
        <span class="idx">#23</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code>F(0)= 1.0
F(1)= 0.25312095066527607
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#24</span>
    </div>
    <div class="content markdown-body"><p>1) Step-by-Step Derivation</p>
<ul>
<li>
<p>Circuit, code and target</p>
</li>
<li>
<p>[[4,2,2]] code stabilizers: S = ‚ü®XXXX, ZZZZ‚ü© on data qubits 0‚Äì3. A standard logical basis is
    $
    {|\overline{00}\rangle,|\overline{01}\rangle,|\overline{10}\rangle,|\overline{11}\rangle}
    =
    \left{
    \tfrac{|0000\rangle+|1111\rangle}{\sqrt2},
    \tfrac{|0011\rangle+|1100\rangle}{\sqrt2},
    \tfrac{|0101\rangle+|1010\rangle}{\sqrt2},
    \tfrac{|0110\rangle+|1001\rangle}{\sqrt2}
    \right}.
    $
    Hence <span class="arithmatex">\(|\overline{00}\rangle=(|0000\rangle+|1111\rangle)/\sqrt2\)</span> and is stabilized by XXXX and ZZZZ. (<a href="https://errorcorrectionzoo.org/c/stab_4_2_2?utm_source=openai">errorcorrectionzoo.org</a>, <a href="https://ar5iv.labs.arxiv.org/html/1907.11157v1?utm_source=openai">ar5iv.labs.arxiv.org</a>)</p>
</li>
<li>Logical Pauli representatives (as given in the problem): <span class="arithmatex">\(X_A=X I X I\)</span>, <span class="arithmatex">\(X_B=X X I I\)</span>, <span class="arithmatex">\(Z_A=Z Z I I\)</span>, <span class="arithmatex">\(Z_B=Z I Z I\)</span>.</li>
<li>
<p>Circuit (right-to-left): <span class="arithmatex">\(H_1 \to \mathrm{CNOT}_{12}\to \mathrm{CNOT}_{10}\to \mathrm{CNOT}_{23}\to \mathrm{CNOT}_{34}\to \mathrm{CNOT}_{04}\to M_4\)</span>.
    Acting on <span class="arithmatex">\(|0000\rangle_{0..3}|0\rangle_4\)</span>, the first four gates prepare <span class="arithmatex">\(|\overline{00}\rangle\)</span> on data (a 4-qubit GHZ). The two CNOTs to the ancilla compute the X-parity of data qubits 0 and 3 into the ancilla; on the ideal GHZ the ancilla is <span class="arithmatex">\(|0\rangle\)</span>. (<a href="https://en.wikipedia.org/wiki/Controlled_NOT_gate?utm_source=openai">en.wikipedia.org</a>)</p>
</li>
<li>
<p>Noise model and acceptance</p>
</li>
<li>
<p>After each two-qubit gate, an independent two-qubit depolarizing channel acts on the same two qubits: with probability <span class="arithmatex">\(p\)</span> a uniformly random non-identity two-qubit Pauli (15 choices) is applied, and with probability <span class="arithmatex">\(1-p\)</span> the identity acts. (<a href="https://algassert.com/post/2001?utm_source=openai">algassert.com</a>)</p>
</li>
<li>
<p>We post-select on: (i) code checks pass (no syndrome) and (ii) ancilla outcome <span class="arithmatex">\(0\)</span>.
    In stabilizer language, a Pauli error <span class="arithmatex">\(E\)</span> on the data is accepted by code checks iff it commutes with XXXX and ZZZZ. Ancilla acceptance in this circuit is equivalent to having no <span class="arithmatex">\(X\)</span>-support on qubit 4 at the end (otherwise the final <span class="arithmatex">\(Z\)</span>-basis readout flips). These are standard stabilizer/Heisenberg facts; we use Pauli propagation through CNOT in the Heisenberg picture. (<a href="https://ar5iv.labs.arxiv.org/html/1907.11157v1?utm_source=openai">ar5iv.labs.arxiv.org</a>, <a href="https://arxiv.org/abs/quant-ph/9807006?utm_source=openai">arxiv.org</a>)</p>
</li>
<li>
<p>Heisenberg propagation rules we use (conjugation by CNOT with control c and target t):
  $
  X_c\mapsto X_c X_t,\quad
  Z_t\mapsto Z_c Z_t,\quad
  X_t\mapsto X_t,\quad
  Z_c\mapsto Z_c.
  $
  We encode Paulis by binary ‚Äúsymplectic‚Äù <span class="arithmatex">\((\boldsymbol{x}|\boldsymbol{z})\)</span> vectors and update with the linear rules
  $
  x_t\leftarrow x_t\oplus x_c,\quad
  z_c\leftarrow z_c\oplus z_t,
  $
  leaving other bits unchanged. (<a href="https://arxiv.org/abs/quant-ph/9807006?utm_source=openai">arxiv.org</a>)</p>
</li>
<li>
<p>What counts as a ‚Äúgood‚Äù accepted event?</p>
</li>
</ul>
<p>Let <span class="arithmatex">\(E_{\mathrm{fin}}\)</span> be the final Pauli on qubits 0‚Äì4 after pushing each fault forward through the remaining gates (Heisenberg). Condition on acceptance:
  1) Code acceptance ‚áî parity constraints on data bits:
     $
     \sum_{i=0}^3 x_i\equiv 0\pmod 2,\qquad \sum_{i=0}^3 z_i\equiv 0\pmod 2,
     $
     i.e., <span class="arithmatex">\(E_{\mathrm{fin}}\)</span> commutes with XXXX and ZZZZ. (<a href="https://ar5iv.labs.arxiv.org/html/1907.11157v1?utm_source=openai">ar5iv.labs.arxiv.org</a>)
  2) Ancilla acceptance ‚áî <span class="arithmatex">\(x_4=0\)</span> (no <span class="arithmatex">\(X/Y\)</span> on qubit 4).</p>
<p>Among accepted events, the logical state equals the target <span class="arithmatex">\(|\overline{00}\rangle\)</span> iff the logical <span class="arithmatex">\(X\)</span> exponents vanish. Equivalently, <span class="arithmatex">\(E_{\mathrm{fin}}\)</span> must commute with both logical <span class="arithmatex">\(Z\)</span>‚Äôs <span class="arithmatex">\(Z_A=ZZII\)</span> and <span class="arithmatex">\(Z_B=ZIZI\)</span> (so that no <span class="arithmatex">\(X_A\)</span> or <span class="arithmatex">\(X_B\)</span> component is present). In symplectic bits this is the pair of constraints
  $
  a = x_0\oplus x_1=0,\qquad b=x_0\oplus x_2=0.
  $
  Any residual <span class="arithmatex">\(Z_A\)</span>/<span class="arithmatex">\(Z_B\)</span> and/or stabilizer factors are harmless on <span class="arithmatex">\(|\overline{00}\rangle\)</span>. (<a href="https://ar5iv.labs.arxiv.org/html/1907.11157v1?utm_source=openai">ar5iv.labs.arxiv.org</a>)</p>
<ul>
<li>Exact combinatorial enumeration (Clifford‚ÄìPauli method)</li>
</ul>
<p>There are five noisy CNOT locations. At each location the fault is one of 16 two-qubit Paulis (II or one of the 15 non-identity). We enumerated all <span class="arithmatex">\(16^5\)</span> fault patterns, propagated each to the end using the CNOT rules above, and tallied:
  - the Hamming weight <span class="arithmatex">\(k\)</span> (number of non-identity faults),
  - whether it is accepted (both code checks pass and ancilla is 0),
  - whether, conditioned on acceptance, it is ‚Äúgood‚Äù (leaves <span class="arithmatex">\(|\overline{00}\rangle\)</span> unchanged up to stabilizers and logical <span class="arithmatex">\(Z\)</span>‚Äôs).</p>
<p>Let <span class="arithmatex">\(c_{\text{acc}}(k)\)</span> and <span class="arithmatex">\(c_{\text{good}}(k)\)</span> be the counts by weight <span class="arithmatex">\(k\)</span>. The exhaustive symplectic enumeration gives
  $
  \begin{aligned}
  &amp;(c_{\text{acc}}(0),c_{\text{acc}}(1),c_{\text{acc}}(2),c_{\text{acc}}(3),c_{\text{acc}}(4),c_{\text{acc}}(5))\
  &amp;\qquad= (1,\,7,\,282,\,4222,\,31637,\,94923),\
  &amp;(c_{\text{good}}(0),c_{\text{good}}(1),c_{\text{good}}(2),c_{\text{good}}(3),c_{\text{good}}(4),c_{\text{good}}(5))\
  &amp;\qquad= (1,\,7,\,138,\,1198,\,7397,\,24027).
  \end{aligned}
  $
  In particular, all accepted single-fault events are benign (no logical error), i.e., <span class="arithmatex">\(c_{\text{acc}}(1)=c_{\text{good}}(1)=7\)</span> (fault tolerance to first order).</p>
<ul>
<li>From counts to probabilities and fidelity</li>
</ul>
<p>Each specific pattern with weight <span class="arithmatex">\(k\)</span> occurs with probability <span class="arithmatex">\((p/15)^k(1-p)^{5-k}\)</span>. Therefore
  $
  \begin{aligned}
  P_{\text{acc}}(p)
  &amp;=\sum_{k=0}^{5} c_{\text{acc}}(k)\,\Big(\tfrac{p}{15}\Big)^k(1-p)^{5-k},\
  P_{\text{good}}(p)
  &amp;=\sum_{k=0}^{5} c_{\text{good}}(k)\,\Big(\tfrac{p}{15}\Big)^k(1-p)^{5-k}.
  \end{aligned}
  $
  The post-selected logical-state fidelity is the good fraction of accepted runs:
  $
  F_{\text{logical}}(p)=\dfrac{P_{\text{good}}(p)}{P_{\text{acc}}(p)}.
  $</p>
<p>Simplifying the ratio yields the exact closed form
  $
  \boxed{\
  F_{\text{logical}}(p)
  =
  \frac{229376\,p^{5}-1116160\,p^{4}+2198400\,p^{3}-2214000\,p^{2}+1147500\,p-253125}
       {262144\,p^{5}-1269760\,p^{4}+2457600\,p^{3}-2376000\,p^{2}+1147500\,p-253125}\ .
  }
  $
  Small-<span class="arithmatex">\(p\)</span> expansion:
  $
  F_{\text{logical}}(p)=1-\frac{16}{25}p^{2}-\frac{704}{375}p^{3}+O(p^{4}),
  $
  consistent with first-order fault tolerance (no <span class="arithmatex">\(p\)</span> term). The stabilizer/Heisenberg manipulations used here are standard. (<a href="https://arxiv.org/abs/quant-ph/9807006?utm_source=openai">arxiv.org</a>, <a href="https://ar5iv.labs.arxiv.org/html/1907.11157v1?utm_source=openai">ar5iv.labs.arxiv.org</a>)</p>
<p>2) Mathematical Typesetting</p>
<ul>
<li>Key algebra and the final expression are presented above in LaTeX.</li>
<li>Pauli propagation rules and stabilizer-commutation parity tests are used explicitly. (<a href="https://arxiv.org/abs/quant-ph/9807006?utm_source=openai">arxiv.org</a>)</li>
</ul>
<p>3) Conventions and Units</p>
<ul>
<li>Qubits are labeled 0‚Äì3 (data) and 4 (ancilla).</li>
<li>Stabilizers are XXXX and ZZZZ; logical operators as given in the problem.</li>
<li>CNOT control-target convention and action are standard. (<a href="https://en.wikipedia.org/wiki/Controlled_NOT_gate?utm_source=openai">en.wikipedia.org</a>)</li>
</ul>
<p>4) Final Answer:
$
F_{\text{logical}}(p)
=
\frac{229376\,p^{5}-1116160\,p^{4}+2198400\,p^{3}-2214000\,p^{2}+1147500\,p-253125}
     {262144\,p^{5}-1269760\,p^{4}+2457600\,p^{3}-2376000\,p^{2}+1147500\,p-253125}.
$</p></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#25</span>
    </div>
    <div class="content markdown-body"><p>Populate your final answer into the code template provided below. This step is purely for formatting/display purposes. No additional reasoning or derivation should be performed. Do not import any modules or packages beyond what is provided in the template.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">answer</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the expression of the logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    at the end of the circuit as a function of two-qubit gate error rate $p$.</span>

<span class="sd">    Inputs</span>
<span class="sd">    ----------</span>
<span class="sd">    p: sympy.Symbol, two-qubit gate error rate, $p$</span>

<span class="sd">    Outputs</span>
<span class="sd">    ----------</span>
<span class="sd">    F_logical: sympy.Expr, logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ------------------ FILL IN YOUR RESULTS BELOW ------------------</span>
    <span class="n">F_logical</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># a SymPy expression of inputs</span>
    <span class="c1"># ---------------------------------------------------------------</span>

    <span class="k">return</span> <span class="n">F_logical</span>
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#26</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">answer</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the expression of the logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    at the end of the circuit as a function of two-qubit gate error rate $p$.</span>

<span class="sd">    Inputs</span>
<span class="sd">    ----------</span>
<span class="sd">    p: sympy.Symbol, two-qubit gate error rate, $p$</span>

<span class="sd">    Outputs</span>
<span class="sd">    ----------</span>
<span class="sd">    F_logical: sympy.Expr, logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ------------------ FILL IN YOUR RESULTS BELOW ------------------</span>
    <span class="n">F_logical</span> <span class="o">=</span> <span class="p">(</span><span class="mi">229376</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">1116160</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2198400</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2214000</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1147500</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="mi">253125</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">262144</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">1269760</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2457600</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2376000</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1147500</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="mi">253125</span><span class="p">)</span>
    <span class="c1"># ---------------------------------------------------------------</span>

    <span class="k">return</span> <span class="n">F_logical</span>
</code></pre></div></div>
</article>

</div>

<footer>
  Generated at 2025-09-24T22:02:11.572297
</footer>

<script>
(function() {
  // Tabs
  const tabs = document.querySelectorAll('.tab');
  const panels = document.querySelectorAll('.tab-content');
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      panels.forEach(p => p.classList.remove('active'));
      tab.classList.add('active');
      const target = document.querySelector(tab.dataset.target);
      if (target) target.classList.add('active');
    });
  });

  // Theme toggle
  const toggleBtn = document.getElementById('theme-toggle');
  function setTheme(dark) {
    if (dark) {
      document.documentElement.classList.add('dark');
      localStorage.setItem('dark', '1');
    } else {
      document.documentElement.classList.remove('dark');
      localStorage.setItem('dark', '0');
    }
  }
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const stored = localStorage.getItem('dark');
  setTheme(stored === null ? prefersDark : stored === '1');

  toggleBtn.addEventListener('click', () => {
    const isDark = document.documentElement.classList.contains('dark');
    setTheme(!isDark);
  });
})();
</script>
</body>
</html>