<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Checkpoint-3</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #3D7B7B; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #F00 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666 } /* Operator */
.codehilite .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #9C6500 } /* Comment.Preproc */
.codehilite .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.codehilite .gr { color: #E40000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #008400 } /* Generic.Inserted */
.codehilite .go { color: #717171 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #04D } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #687822 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #00F; font-weight: bold } /* Name.Class */
.codehilite .no { color: #800 } /* Name.Constant */
.codehilite .nd { color: #A2F } /* Name.Decorator */
.codehilite .ni { color: #717171; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #00F } /* Name.Function */
.codehilite .nl { color: #767600 } /* Name.Label */
.codehilite .nn { color: #00F; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #A2F; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #BBB } /* Text.Whitespace */
.codehilite .mb { color: #666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666 } /* Literal.Number.Float */
.codehilite .mh { color: #666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #A45A77 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #00F } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666 } /* Literal.Number.Integer.Long */

</style>
<style>
    :root {
  --bg: #ffffff;
  --fg: #222222;
  --muted: #555555;
  --border: #e0e0e0;
  --accent: #005fcc;
  --code-bg: #f6f8fa;
  --role-user: #0ea5e9;
  --role-assistant: #22c55e;
  --role-system: #9ca3af;
  --return-code: #a35291;
}
html.dark {
  --bg: #0b0b0b;
  --fg: #e8e8e8;
  --muted: #a0a0a0;
  --border: #333333;
  --accent: #3b82f6;
  --code-bg: #111827;
  --role-user: #0ea5e9;
  --role-assistant: #22c55e;
  --role-system: #9ca3af;
  --return-code: #a35291;
}
* {
  box-sizing: border-box;
}
body {
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--fg);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", sans-serif;
  line-height: 1.6;
}
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 1.25rem;
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  background: var(--bg);
  z-index: 10;
}
h1 {
  margin: 0;
  font-size: 1.1rem;
}
.tabs {
  display: flex;
  gap: 0.5rem;
}
.tab {
  padding: 0.4rem 0.8rem;
  border: 1px solid var(--border);
  border-bottom: none;
  background: transparent;
  cursor: pointer;
  border-radius: 6px 6px 0 0;
  color: var(--fg);
}
.tab.active {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
}
.tab-content {
  display: none;
  padding: 1rem 1.25rem;
  border-top: 1px solid var(--border);
}
.tab-content.active {
  display: block;
}
#theme-toggle {
  border: 1px solid var(--border);
  padding: 0.2rem 0.6rem;
  font-size: 0.9rem;
  border-radius: 4px;
  cursor: pointer;
  background: transparent;
  color: var(--fg);
}
.main {
  max-width: 1200px;
  margin: 0 auto;
}
.message {
  border: 1px solid var(--border);
  border-left-width: 6px;
  border-radius: 6px;
  padding: 0.8rem 1rem;
  margin-bottom: 1rem;
  background: rgba(0,0,0,0.02);
}
.message .meta {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  margin-bottom: 0.6rem;
  color: var(--muted);
  font-size: 0.85rem;
}
.message .badge {
  font-weight: 600;
}
.role-user {
  border-left-color: var(--role-user);
}
.role-assistant {
  border-left-color: var(--role-assistant);
}
.role-system {
  border-left-color: var(--role-system);
}
.role-unknown {
  border-left-color: var(--accent);
}

.output-code-container {
  display: flex;
  gap: 1rem;               /* space between children */
  align-items: center;     /* vertical alignment */
  justify-content: start;  /* horizontal alignment */
}

.output-code-container .codeblock {
  flex: 0 1 auto;
}

.codeblock {
  border: 1px solid var(--border);
  border-left-width: 6px;
  border-radius: 6px;
  padding: 0.8rem 1rem;
  margin-bottom: 1rem;
  background: rgba(0,0,0,0.02);
}
.codeblock-content {
  margin-bottom: 0.6rem;
  border: 1px dashed var(--border);
  border-radius: 4px;
  padding: 0.4rem 0.6rem;
  background: rgba(0,0,0,0.02);
}

.codeblock.eval_code {
  border-left-color: var(--role-user);
}
.codeblock.target_code {
  border-left-color: var(--role-assistant);
}
.codeblock.output_code {
  border-left-color: var(--role-system);
}

html.dark .codeblock-content {
  background: rgba(255,255,255,0.03);
}
.codeblock > summary {
  cursor: pointer;
  font-weight: 600;
  list-style: none; /* remove default triangle in some browsers */
}
.codeblock > summary::-webkit-details-marker {
  display: none; /* Safari/Chrome marker */
}
.codeblock > summary::before {
  content: "â–¶ ";
  display: inline-block;
  transform: rotate(0deg);
  transition: transform 0.12s ease-out;
}
.codeblock[open] > summary::before {
  transform: rotate(90deg);
}
.codeblock .tag {
  color: var(--muted);
  font-weight: 400;
  font-size: 0.85em;
  margin-left: 0.25rem;
}

.markdown-body pre code {
  background: var(--code-bg);
  display: block;
  padding: 0.75rem;
  overflow-x: auto;
  border-radius: 4px;
  border: 1px solid var(--border);
}
.markdown-body code {
  background: var(--code-bg);
  padding: 0.15rem 0.3rem;
  border-radius: 4px;
}
/* Extra info tree */
details > summary {
  cursor: pointer;
  font-weight: 600;
}
details .block {
  padding-left: 1rem;
  margin: 0.25rem 0 0.5rem 0;
  border-left: 2px solid var(--border);
}
.kv .key {
  font-weight: 600;
}
.kv .type {
  color: var(--muted);
  margin-left: 0.5rem;
  font-size: 0.85rem;
}
footer {
  margin: 2rem 0;
  text-align: center;
  color: var(--muted);
  font-size: 0.85rem;
}
/* CodeHilite (pygments) overrides to respect theme vars */
.codehilite {
  background: var(--code-bg) !important;
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 0.75rem !important;
}
.reasoning {
  margin-bottom: 0.6rem;
  border: 1px dashed var(--border);
  border-radius: 4px;
  padding: 0.4rem 0.6rem;
  background: rgba(0,0,0,0.02);
}
html.dark .reasoning {
  background: rgba(255,255,255,0.03);
}
.reasoning > summary {
  cursor: pointer;
  font-weight: 600;
  list-style: none; /* remove default triangle in some browsers */
}
.reasoning > summary::-webkit-details-marker {
  display: none; /* Safari/Chrome marker */
}
.reasoning > summary::before {
  content: "â–¶ ";
  display: inline-block;
  transform: rotate(0deg);
  transition: transform 0.12s ease-out;
}
.reasoning[open] > summary::before {
  transform: rotate(90deg);
}
.reasoning .tag {
  color: var(--muted);
  font-weight: 400;
  font-size: 0.85em;
  margin-left: 0.25rem;
}
.reasoning-body {
  margin-top: 0.5rem;
}
</style>

<!-- ===== MATHJAX CONFIG ===== -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [ ["\\(","\\)"] ],
    displayMath: [ ["\\[","\\]"] ],
    processEscapes: true,
    processEnvironments: true
  },
  options: {
    ignoreHtmlClass: ".*",
    processHtmlClass: "arithmatex"

    // skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    // if you dynamically add content later, you can call MathJax.typesetPromise()
  }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<!-- ========================== -->
</head>
<body>
<header>
  <h1>Checkpoint-3</h1>
  <div>
    <button id="theme-toggle" aria-label="toggle dark mode">ðŸŒ“</button>
  </div>
</header>

<div class="main">
  
<article class="message role-system">
    <div class="meta">
        <span class="badge">System</span>
        <span class="idx">#0</span>
    </div>
    <div class="content markdown-body"><p>You are a physics research assistant specializing in solving complex, research-level problems using precise, step-by-step reasoning.</p>
<p><strong>Input</strong>
Problems will be provided in Markdown format.</p>
<p><strong>Output (Markdown format)</strong></p>
<ol>
<li><strong>Step-by-Step Derivation</strong> - Show every non-trivial step in the solution.  Justify steps using relevant physical laws, theorems, or mathematical identities.</li>
<li><strong>Mathematical Typesetting</strong> - Use LaTeX for all mathematics:  <code>$...$</code> for inline expressions, <code>$$...$$</code> for display equations.</li>
<li><strong>Conventions and Units</strong> - Follow the unit system and conventions specified in the problem.</li>
<li>
<p><strong>Final Answer</strong> - At the end of the solution,  start a new line with <strong>&ldquo;Final Answer:&rdquo;</strong>, and present the final result.</p>
<p>For final answers involving values, follow the precision requirements specified in the problem.
If no precision is specified:
- If an exact value is possible, provide it (e.g., \$\sqrt(2)\$, \$\pi/4\$).
- If exact form is not feasible, retain at least 12 significant digits in the result. </p>
</li>
<li>
<p><strong>Formatting Compliance</strong> - If the user requests a specific output format (e.g., code, table),  provide the final answer accordingly.</p>
</li>
</ol></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#1</span>
    </div>
    <div class="content markdown-body"><h1 id="problem-setup">Problem setup:</h1>
<p>In quantum error correction, you encode quantum states into logical states made of many qubits in order to improve their resilience to errors. In quantum error detection, you do the same but can only detect the presence of errors and not correct them. In this problem, we will consider a single [[4,2,2]] quantum error detection code, which encodes two logical qubits into four physical qubits, and investigate how robust logical quantum operations in this code are to quantum errors.</p>
<p>Our convention is that the four physical qubits in the [[4,2,2]] code are labelled 0,1,2,3. The two logical qubits are labelled A and B. The stabilizers are <span class="arithmatex">\(XXXX\)</span> and <span class="arithmatex">\(ZZZZ\)</span>, where <span class="arithmatex">\(X\)</span> and <span class="arithmatex">\(Z\)</span> are Pauli matrices. The logical <span class="arithmatex">\(X\)</span> and <span class="arithmatex">\(Z\)</span> operators on the two qubits are <span class="arithmatex">\(X_A = XIXI\)</span>, <span class="arithmatex">\(X_B=XXII\)</span>, <span class="arithmatex">\(Z_A = ZZII\)</span>, <span class="arithmatex">\(Z_B = ZIZI\)</span>, up to multiplication by stabilizers.</p>
<p>We will consider different state preparation circuits consisting of controlled not <span class="arithmatex">\(CNOT_{ij}\)</span> gates, where <span class="arithmatex">\(CNOT_{ij}\)</span> has control qubit <span class="arithmatex">\(i\)</span> and target qubit <span class="arithmatex">\(j\)</span>. As a simple model of quantum errors in hardware, we will suppose that each <span class="arithmatex">\(CNOT_{ij}\)</span> gate in the circuit has a two qubit depolarizing error channel following it that produces one of the 15 non-identity two-qubit Paulis with equal probability <span class="arithmatex">\(p/15\)</span>. The probability <span class="arithmatex">\(p\)</span> indicates the probability of an error in a single two-qubit gate. We will assess the logical infidelity of certain state preparation protocols as a function of the physical infidelity <span class="arithmatex">\(p\)</span>.</p>
<h2 id="subproblem-1">Checkpoint 1</h2>
<p>Suppose that we wish to prepare a logical two-qubit GHZ state  <span class="arithmatex">\((|00\rangle_{AB}+|11\rangle_{AB})/\sqrt{2}\)</span> in the [[4,2,2]] code. To do so, we use the following state preparation circuit:</p>
<div class="arithmatex">\[
(CNOT_{03}) (H_0) (CNOT_{21}) (H_2).
\]</div>
<p>Note that this equation is written in matrix multiplication order, while the quantum operations in the circuit occur in the reverse order (from right-to-left in the above equation). <span class="arithmatex">\(H\)</span> is a single-qubit Hadamard gate.</p>
<p>What is the physical state fidelity of the final physical 4-qubit state at the end of the circuit as a function of the two-qubit gate error rate <span class="arithmatex">\(p\)</span>?</p></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#2</span>
    </div>
    
                    <details class="reasoning">
                      <summary>Reasoning <span class="tag">(model)</span></summary>
                      <div class="markdown-body reasoning-body">
                        <p><strong>Summary of Fidelity Calculation for a Noisy GHZ State Preparation</strong></p>
<p>Alright, let&rsquo;s break down this calculation. My primary focus is figuring out how well a specific quantum circuit prepares a desired four-qubit GHZ-like state, considering that the CNOT gates are prone to a common error model.</p>
<p>First things first: I&rsquo;m dealing with the circuit U = (CNOT_03)(H_0)(CNOT_21)(H_2), and I need to figure out its ideal output state starting from |0000&gt;. Tracing the state evolution step-by-step reveals that the ideal output, which I&rsquo;ll call |\psi_ideal&gt;, turns out to be ( |0000&gt; + |1001&gt; + |0110&gt; + |1111&gt; ) / 2. I&rsquo;m also confirming that this |\psi_ideal&gt; does indeed encode the logical GHZ state (|00&gt; + |11&gt;) / sqrt(2) which is what Iâ€™m targeting.</p>
<p>Now, where things get tricky: I have to incorporate the error model which is two-qubit depolarizing errors that occur after each CNOT gate. The question is, how do these errors affect the final fidelity, which I&rsquo;m defining as the overlap between the actual output state and |\psi_ideal&gt;?</p>
<p>I started by recognizing the standard form of a depolarizing channel, and thinking about how to apply it, but that got too messy. The key insight is that errors effectively commute with the operations that follow. This crucial observation significantly simplifies the problem: Instead of trying to directly trace the noisy state evolution, I realized that I can separately analyze the effect of each noisy operation and combine them to get an overall picture. Specifically, the depolarizing error after CNOT_21 effectively translates to that error being applied on the final state, and similarly for the CNOT_03 error.</p>
<p>Using this simplification, I could write out the complete expression for the fidelity and I was able to decompose this expression.
The calculations showed that I only need to consider certain Pauli errors (operators) that act on the GHZ state (or similar states) without orthogonalizing the state. After going through the full calculation, including verifying the stabilizer structure and the action of Pauli operators on the GHZ states, I found the final fidelity is (1 - 14p/15)^2, where &lsquo;p&rsquo; is the depolarizing error rate. This reflects the impact of two independent errors in the circuit.</p>
                      </div>
                    </details>
<div class="content markdown-body"><p>The problem asks for the physical state fidelity of a 4-qubit state prepared using a specific circuit, in the presence of two-qubit depolarizing errors after each CNOT gate.</p>
<p>First, let&rsquo;s identify the ideal final state. The circuit operations occur in reverse order of how they are written:</p>
<div class="arithmatex">\[
U = (CNOT_{03}) (H_0) (CNOT_{21}) (H_2)
\]</div>
<p>The initial state is <span class="arithmatex">\(|0000\rangle\)</span>.</p>
<ol>
<li>Apply <span class="arithmatex">\(H_2\)</span> (Hadamard on qubit 2):</li>
</ol>
<div class="arithmatex">\[
|\psi_1\rangle = H_2 |0000\rangle = \frac{1}{\sqrt{2}} |0000\rangle + \frac{1}{\sqrt{2}} |0010\rangle
\]</div>
<ol start="2">
<li>Apply <span class="arithmatex">\(CNOT_{21}\)</span> (control 2, target 1):</li>
</ol>
<div class="arithmatex">\[
|\psi_2\rangle = CNOT_{21} |\psi_1\rangle = \frac{1}{\sqrt{2}} |0000\rangle + \frac{1}{\sqrt{2}} |0110\rangle
\]</div>
<ol start="3">
<li>Apply <span class="arithmatex">\(H_0\)</span> (Hadamard on qubit 0):</li>
</ol>
<div class="arithmatex">\[
|\psi_3\rangle = H_0 |\psi_2\rangle = \frac{1}{\sqrt{2}} \left( \frac{1}{\sqrt{2}}(|0\rangle+|1\rangle)|000\rangle + \frac{1}{\sqrt{2}}(|0\rangle+|1\rangle)|110\rangle \right)
\]</div>
<div class="arithmatex">\[
|\psi_3\rangle = \frac{1}{2} (|0000\rangle + |1000\rangle + |0110\rangle + |1110\rangle)
\]</div>
<ol start="4">
<li>Apply <span class="arithmatex">\(CNOT_{03}\)</span> (control 0, target 3):</li>
</ol>
<div class="arithmatex">\[
|\psi_{ideal}\rangle = CNOT_{03} |\psi_3\rangle = \frac{1}{2} (|0000\rangle + |1001\rangle + |0110\rangle + |1111\rangle)
\]</div>
<p>This is the ideal physical 4-qubit state <span class="arithmatex">\(|\psi_{ideal}\rangle\)</span>. The problem states that this circuit prepares the logical GHZ state <span class="arithmatex">\((|00\rangle_{AB}+|11\rangle_{AB})/\sqrt{2}\)</span>. Let&rsquo;s verify this. Using the standard mapping for this code:
<span class="arithmatex">\(|00\rangle_{AB} = \frac{1}{\sqrt{2}}(|0000\rangle + |1111\rangle)\)</span>
<span class="arithmatex">\(|11\rangle_{AB} = \frac{1}{\sqrt{2}}(|0110\rangle + |1001\rangle)\)</span>
Then the target logical GHZ state is:</p>
<div class="arithmatex">\[
\frac{1}{\sqrt{2}}(|00\rangle_{AB}+|11\rangle_{AB}) = \frac{1}{\sqrt{2}} \left( \frac{1}{\sqrt{2}}(|0000\rangle + |1111\rangle) + \frac{1}{\sqrt{2}}(|0110\rangle + |1001\rangle) \right)
\]</div>
<div class="arithmatex">\[
= \frac{1}{2} (|0000\rangle + |1111\rangle + |0110\rangle + |1001\rangle)
\]</div>
<p>This matches <span class="arithmatex">\(|\psi_{ideal}\rangle\)</span>.</p>
<p>Now, let&rsquo;s incorporate the errors. Each <span class="arithmatex">\(CNOT_{ij}\)</span> gate is followed by a two-qubit depolarizing error channel <span class="arithmatex">\(\mathcal{E}_{ij}\)</span>. For a two-qubit state <span class="arithmatex">\(\rho\)</span>, the channel is:</p>
<div class="arithmatex">\[
\mathcal{E}_{ij}(\rho) = (1-p)\rho + p \sum_{P_{ij} \in \mathcal{P}_{ij}^*} \frac{1}{15} P_{ij} \rho P_{ij}
\]</div>
<p>where <span class="arithmatex">\(\mathcal{P}_{ij}^*\)</span> is the set of 15 non-identity two-qubit Pauli operators acting on qubits <span class="arithmatex">\(i,j\)</span>.</p>
<p>Let <span class="arithmatex">\(U_A = H_2\)</span>, <span class="arithmatex">\(U_B = CNOT_{21}\)</span>, <span class="arithmatex">\(U_C = H_0\)</span>, <span class="arithmatex">\(U_D = CNOT_{03}\)</span>.
The full ideal unitary is <span class="arithmatex">\(U_{ideal} = U_D U_C U_B U_A\)</span>.
The input state is <span class="arithmatex">\(\rho_0 = |0000\rangle\langle0000|\)</span>.
The noisy state evolution:</p>
<ol>
<li>After <span class="arithmatex">\(U_A\)</span>: <span class="arithmatex">\(\rho_A = U_A \rho_0 U_A^\dagger = |\psi_1\rangle\langle\psi_1|\)</span>.</li>
<li>After <span class="arithmatex">\(U_B\)</span>: <span class="arithmatex">\(\rho_B = U_B \rho_A U_B^\dagger = |\psi_2\rangle\langle\psi_2|\)</span>.</li>
<li>After error <span class="arithmatex">\(\mathcal{E}_{21}\)</span>: <span class="arithmatex">\(\rho_B' = \mathcal{E}_{21}(\rho_B)\)</span>.</li>
<li>After <span class="arithmatex">\(U_C\)</span>: <span class="arithmatex">\(\rho_C' = U_C \rho_B' U_C^\dagger\)</span>.</li>
<li>After <span class="arithmatex">\(U_D\)</span>: <span class="arithmatex">\(\rho_D' = U_D \rho_C' U_D^\dagger\)</span>.</li>
<li>After error <span class="arithmatex">\(\mathcal{E}_{03}\)</span>: <span class="arithmatex">\(\rho_{final} = \mathcal{E}_{03}(\rho_D')\)</span>.</li>
</ol>
<p>The physical state fidelity is <span class="arithmatex">\(F = \langle \psi_{ideal} | \rho_{final} | \psi_{ideal} \rangle = \mathrm{Tr}(|\psi_{ideal}\rangle\langle\psi_{ideal}| \rho_{final})\)</span>.</p>
<p>Let&rsquo;s expand <span class="arithmatex">\(\rho_{final}\)</span>:</p>
<div class="arithmatex">\[
\rho_{final} = (1-p)\rho_D' + p \sum_{P_{03} \in \mathcal{P}_{03}^*} \frac{1}{15} P_{03} \rho_D' P_{03}
\]</div>
<p>Substitute <span class="arithmatex">\(\rho_D'\)</span>:</p>
<div class="arithmatex">\[
\rho_D' = U_D U_C \rho_B' U_C^\dagger U_D^\dagger = U_D U_C \left( (1-p)\rho_B + p \sum_{P_{21} \in \mathcal{P}_{21}^*} \frac{1}{15} P_{21} \rho_B P_{21} \right) U_C^\dagger U_D^\dagger
\]</div>
<div class="arithmatex">\[
\rho_D' = (1-p) U_D U_C \rho_B U_C^\dagger U_D^\dagger + p \sum_{P_{21} \in \mathcal{P}_{21}^*} \frac{1}{15} U_D U_C P_{21} \rho_B P_{21} U_C^\dagger U_D^\dagger
\]</div>
<p>Note that <span class="arithmatex">\(U_D U_C \rho_B U_C^\dagger U_D^\dagger = |\psi_{ideal}\rangle\langle\psi_{ideal}|\)</span>.
Also, <span class="arithmatex">\(P_{21}\)</span> acts on qubits 1,2. <span class="arithmatex">\(H_0\)</span> (<span class="arithmatex">\(U_C\)</span>) acts on qubit 0. <span class="arithmatex">\(CNOT_{03}\)</span> (<span class="arithmatex">\(U_D\)</span>) acts on qubits 0,3. Since these operators act on disjoint sets of qubits, they commute: <span class="arithmatex">\(U_D U_C P_{21} U_C^\dagger U_D^\dagger = P_{21}\)</span>.
So, <span class="arithmatex">\(\rho_D' = (1-p) |\psi_{ideal}\rangle\langle\psi_{ideal}| + p \sum_{P_{21} \in \mathcal{P}_{21}^*} \frac{1}{15} P_{21} |\psi_{ideal}\rangle\langle\psi_{ideal}| P_{21}\)</span>.</p>
<p>Now substitute <span class="arithmatex">\(\rho_D'\)</span> into the fidelity expression:</p>
<div class="arithmatex">\[
F = (1-p) \mathrm{Tr}(|\psi_{ideal}\rangle\langle\psi_{ideal}| \rho_D') + p \sum_{P_{03} \in \mathcal{P}_{03}^*} \frac{1}{15} \mathrm{Tr}(|\psi_{ideal}\rangle\langle\psi_{ideal}| P_{03} \rho_D' P_{03})
\]</div>
<p>Let&rsquo;s analyze the terms:</p>
<ol>
<li><span class="arithmatex">\(\mathrm{Tr}(|\psi_{ideal}\rangle\langle\psi_{ideal}| \rho_D') = (1-p)\mathrm{Tr}(|\psi_{ideal}\rangle\langle\psi_{ideal}| |\psi_{ideal}\rangle\langle\psi_{ideal}|) + p \sum_{P_{21} \in \mathcal{P}_{21}^*} \frac{1}{15} \mathrm{Tr}(|\psi_{ideal}\rangle\langle\psi_{ideal}| P_{21} |\psi_{ideal}\rangle\langle\psi_{ideal}| P_{21})\)</span></li>
</ol>
<div class="arithmatex">\[
= (1-p) + p \sum_{P_{21} \in \mathcal{P}_{21}^*} \frac{1}{15} |\langle\psi_{ideal}|P_{21}|\psi_{ideal}\rangle|^2
\]</div>
<div class="codehilite"><pre><span></span><code><span class="nv">For</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">stabilizer</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">psi</span>\<span class="nv">rangle</span><span class="p">$,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">any</span><span class="w"> </span><span class="nv">Pauli</span><span class="w"> </span><span class="nv">operator</span><span class="w"> </span><span class="p">$</span><span class="nv">P</span><span class="p">$,</span><span class="w"> </span><span class="nv">either</span><span class="w"> </span><span class="p">$</span><span class="nv">P</span><span class="o">|</span>\<span class="nv">psi</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>\<span class="nv">pm</span><span class="w"> </span><span class="o">|</span>\<span class="nv">psi</span>\<span class="nv">rangle</span><span class="p">$</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">$</span><span class="nv">P</span><span class="p">$</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">stabilizer</span><span class="w"> </span><span class="nv">group</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">psi</span>\<span class="nv">rangle</span><span class="p">$)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">$</span><span class="nv">P</span><span class="o">|</span>\<span class="nv">psi</span>\<span class="nv">rangle</span><span class="p">$</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="ow">or</span><span class="nv">thogonal</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">psi</span>\<span class="nv">rangle</span><span class="p">$</span><span class="o">.</span><span class="w"> </span><span class="nv">In</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">case</span><span class="p">,</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">langle</span>\<span class="nv">psi</span><span class="o">|</span><span class="nv">P</span><span class="o">|</span>\<span class="nv">psi</span>\<span class="nv">rangle</span><span class="o">|^</span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">$;</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">second</span><span class="p">,</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="mi">0</span><span class="o">.</span>
<span class="nv">The</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">2</span><span class="p">}</span><span class="w"> </span><span class="p">(</span><span class="o">|</span><span class="mi">0000</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">|</span><span class="mi">1001</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">|</span><span class="mi">0110</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">|</span><span class="mi">1111</span>\<span class="nv">rangle</span><span class="p">)$</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">stabilizer</span><span class="w"> </span><span class="nv">state</span><span class="o">.</span><span class="w"> </span><span class="nv">We</span><span class="w"> </span><span class="nv">need</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">find</span><span class="w"> </span><span class="nv">which</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}$</span><span class="w"> </span><span class="p">(</span><span class="nv">Pauli</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">qubits</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="nv">belong</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">stabilizer</span><span class="w"> </span><span class="nv">group</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="p">$</span><span class="o">.</span>
<span class="nv">Let</span><span class="o">&#39;</span><span class="nv">s</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="o">=</span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="p">$</span><span class="o">:</span>
<span class="p">$</span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="w"> </span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">2</span><span class="p">}</span><span class="w"> </span><span class="p">(</span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="o">|</span><span class="mi">0000</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="o">|</span><span class="mi">1001</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="o">|</span><span class="mi">0110</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="o">|</span><span class="mi">1111</span>\<span class="nv">rangle</span><span class="p">)$</span>
<span class="p">$</span><span class="o">=</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">2</span><span class="p">}</span><span class="w"> </span><span class="p">(</span><span class="o">|</span><span class="mi">0110</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">|</span><span class="mi">1111</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">|</span><span class="mi">0000</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">|</span><span class="mi">1001</span>\<span class="nv">rangle</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="p">$</span><span class="o">.</span>
<span class="nv">Thus</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="o">=</span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="p">$,</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">langle</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span><span class="o">|</span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="o">|^</span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">$</span><span class="o">.</span>
<span class="nv">For</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">other</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="nv">non</span><span class="o">-</span><span class="nv">identity</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}$</span><span class="w"> </span><span class="nf">operators</span><span class="w"> </span><span class="p">(</span><span class="nv">e</span><span class="o">.</span><span class="nv">g</span><span class="o">.</span><span class="p">,</span><span class="w"> </span><span class="p">$</span><span class="nv">X_1</span><span class="p">$,</span><span class="w"> </span><span class="p">$</span><span class="nv">Z_2</span><span class="p">$,</span><span class="w"> </span><span class="p">$</span><span class="nv">Y_1</span><span class="w"> </span><span class="nv">Z_2</span><span class="p">$,</span><span class="w"> </span><span class="nv">etc</span><span class="o">.</span><span class="p">),</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">can</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">verified</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">they</span><span class="w"> </span><span class="nv">map</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="p">$</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="ow">or</span><span class="nv">thogonal</span><span class="w"> </span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="nv">so</span><span class="w"> </span><span class="nv">their</span><span class="w"> </span><span class="nv">contribution</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">sum</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="mi">0</span><span class="o">.</span>
<span class="nv">Therefore</span><span class="p">,</span><span class="w"> </span><span class="p">$</span>\<span class="nv">sum_</span><span class="p">{</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="w"> </span>\<span class="nv">in</span><span class="w"> </span>\<span class="nv">mathcal</span><span class="p">{</span><span class="nv">P</span><span class="p">}</span><span class="nv">_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="o">^*</span><span class="p">}</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">15</span><span class="p">}</span><span class="w"> </span><span class="o">|</span>\<span class="nv">langle</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span><span class="o">|</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="o">|^</span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">15</span><span class="p">}</span><span class="w"> </span>\<span class="nv">cdot</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">15</span><span class="p">}$</span><span class="o">.</span>
<span class="nv">So</span><span class="p">,</span><span class="w"> </span><span class="p">$</span>\<span class="nv">mathrm</span><span class="p">{</span><span class="nv">Tr</span><span class="p">}(</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span>\<span class="nv">langle</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span><span class="o">|</span><span class="w"> </span>\<span class="nv">rho_D</span><span class="o">&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nv">p</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="nv">p</span><span class="p">}{</span><span class="mi">15</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">14</span><span class="nv">p</span><span class="p">}{</span><span class="mi">15</span><span class="p">}$</span><span class="o">.</span>
</code></pre></div>

<ol start="2">
<li><span class="arithmatex">\(\mathrm{Tr}(|\psi_{ideal}\rangle\langle\psi_{ideal}| P_{03} \rho_D' P_{03}) = (1-p)\mathrm{Tr}(|\psi_{ideal}\rangle\langle\psi_{ideal}| P_{03} |\psi_{ideal}\rangle\langle\psi_{ideal}| P_{03}) + p \sum_{P_{21} \in \mathcal{P}_{21}^*} \frac{1}{15} \mathrm{Tr}(|\psi_{ideal}\rangle\langle\psi_{ideal}| P_{03} P_{21} |\psi_{ideal}\rangle\langle\psi_{ideal}| P_{21} P_{03})\)</span>.</li>
</ol>
<div class="arithmatex">\[
= (1-p) |\langle\psi_{ideal}|P_{03}|\psi_{ideal}\rangle|^2 + p \sum_{P_{21} \in \mathcal{P}_{21}^*} \frac{1}{15} |\langle\psi_{ideal}|P_{03} P_{21}|\psi_{ideal}\rangle|^2
\]</div>
<div class="codehilite"><pre><span></span><code><span class="nv">Similarly</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}$</span><span class="w"> </span><span class="p">(</span><span class="nv">Pauli</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">qubits</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="nv">we</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="nv">which</span><span class="w"> </span><span class="nv">ones</span><span class="w"> </span><span class="nv">belong</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">stabilizer</span><span class="w"> </span><span class="nv">group</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="p">$</span><span class="o">.</span>
<span class="nv">Let</span><span class="o">&#39;</span><span class="nv">s</span><span class="w"> </span><span class="nv">check</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}</span><span class="o">=</span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_3</span><span class="p">$</span><span class="o">:</span>
<span class="p">$</span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_3</span><span class="w"> </span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">2</span><span class="p">}</span><span class="w"> </span><span class="p">(</span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_3</span><span class="o">|</span><span class="mi">0000</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_3</span><span class="o">|</span><span class="mi">1001</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_3</span><span class="o">|</span><span class="mi">0110</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_3</span><span class="o">|</span><span class="mi">1111</span>\<span class="nv">rangle</span><span class="p">)$</span>
<span class="p">$</span><span class="o">=</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">2</span><span class="p">}</span><span class="w"> </span><span class="p">(</span><span class="o">|</span><span class="mi">1001</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">|</span><span class="mi">0000</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">|</span><span class="mi">1111</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">|</span><span class="mi">0110</span>\<span class="nv">rangle</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="p">$</span><span class="o">.</span>
<span class="nv">Thus</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}</span><span class="o">=</span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_3</span><span class="p">$,</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">langle</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span><span class="o">|</span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_3</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="o">|^</span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">$</span><span class="o">.</span><span class="w"> </span><span class="nv">All</span><span class="w"> </span><span class="nv">other</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="nv">non</span><span class="o">-</span><span class="nv">identity</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}$</span><span class="w"> </span><span class="nv">operators</span><span class="w"> </span><span class="nv">lead</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">0</span><span class="o">.</span>
<span class="nv">So</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">part</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">term</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nv">we</span><span class="w"> </span><span class="nv">have</span><span class="w"> </span><span class="p">$(</span><span class="mi">1</span><span class="o">-</span><span class="nv">p</span><span class="p">)</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">15</span><span class="p">}$</span><span class="o">.</span>

<span class="nv">Now</span><span class="w"> </span><span class="nv">consider</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">second</span><span class="w"> </span><span class="nv">part</span><span class="o">:</span><span class="w"> </span><span class="p">$</span><span class="nv">p</span><span class="w"> </span>\<span class="nv">sum_</span><span class="p">{</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="w"> </span>\<span class="nv">in</span><span class="w"> </span>\<span class="nv">mathcal</span><span class="p">{</span><span class="nv">P</span><span class="p">}</span><span class="nv">_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="o">^*</span><span class="p">}</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">15</span><span class="p">}</span><span class="w"> </span><span class="o">|</span>\<span class="nv">langle</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span><span class="o">|</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}</span><span class="w"> </span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="o">|^</span><span class="mi">2</span><span class="p">$</span><span class="o">.</span>
<span class="nv">This</span><span class="w"> </span><span class="nv">sum</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">have</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">non</span><span class="o">-</span><span class="nv">zero</span><span class="w"> </span><span class="nv">term</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">both</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}$</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}$</span><span class="w"> </span><span class="nv">combine</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">for</span><span class="nv">m</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">operator</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">stabilizer</span><span class="w"> </span><span class="nv">group</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="p">$</span><span class="o">.</span>
<span class="nv">We</span><span class="w"> </span><span class="nv">know</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}</span><span class="o">=</span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_3</span><span class="p">$</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">relevant</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}$,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="o">=</span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="p">$</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">relevant</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}$</span><span class="o">.</span>
<span class="nv">If</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}</span><span class="o">=</span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_3</span><span class="p">$</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="o">=</span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="p">$,</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}</span><span class="w"> </span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_3</span><span class="w"> </span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="w"> </span><span class="nv">X_3</span><span class="p">$,</span><span class="w"> </span><span class="nv">which</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">stabilizer</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">also</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="p">$</span><span class="o">.</span>
<span class="p">$</span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="w"> </span><span class="nv">X_3</span><span class="w"> </span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="p">$</span><span class="o">.</span><span class="w"> </span><span class="nv">So</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">langle</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span><span class="o">|</span><span class="nv">X_0</span><span class="w"> </span><span class="nv">X_1</span><span class="w"> </span><span class="nv">X_2</span><span class="w"> </span><span class="nv">X_3</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="o">|^</span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">$</span><span class="o">.</span>
<span class="nv">For</span><span class="w"> </span><span class="nv">any</span><span class="w"> </span><span class="nv">other</span><span class="w"> </span><span class="nv">combination</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}$</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}$</span><span class="w"> </span><span class="nv">chosen</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">$</span>\<span class="nv">mathcal</span><span class="p">{</span><span class="nv">P</span><span class="p">}</span><span class="nv">_</span><span class="p">{</span><span class="mi">03</span><span class="p">}</span><span class="o">^*</span><span class="p">$</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">$</span>\<span class="nv">mathcal</span><span class="p">{</span><span class="nv">P</span><span class="p">}</span><span class="nv">_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="o">^*</span><span class="p">$,</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">product</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}$</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">map</span><span class="w"> </span><span class="p">$</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="p">$</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="ow">or</span><span class="nv">thogonal</span><span class="w"> </span><span class="nv">state</span><span class="p">,</span><span class="w"> </span><span class="nv">leading</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">zero</span><span class="w"> </span><span class="nv">contribution</span><span class="o">.</span>
<span class="nv">So</span><span class="p">,</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">sum</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">non</span><span class="o">-</span><span class="nv">zero</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">one</span><span class="w"> </span><span class="nv">specific</span><span class="w"> </span><span class="nv">combination</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}$</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">$</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}$</span><span class="o">:</span><span class="w"> </span><span class="p">$</span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">15</span><span class="p">}</span><span class="w"> </span>\<span class="nv">cdot</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">15</span><span class="p">}</span><span class="w"> </span>\<span class="nv">cdot</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">225</span><span class="p">}$</span><span class="o">.</span>
<span class="nv">Thus</span><span class="p">,</span><span class="w"> </span><span class="p">$</span><span class="nv">p</span><span class="w"> </span>\<span class="nv">sum_</span><span class="p">{</span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="w"> </span>\<span class="nv">in</span><span class="w"> </span>\<span class="nv">mathcal</span><span class="p">{</span><span class="nv">P</span><span class="p">}</span><span class="nv">_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="o">^*</span><span class="p">}</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">15</span><span class="p">}</span><span class="w"> </span><span class="o">|</span>\<span class="nv">langle</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span><span class="o">|</span><span class="nv">P_</span><span class="p">{</span><span class="mi">03</span><span class="p">}</span><span class="w"> </span><span class="nv">P_</span><span class="p">{</span><span class="mi">21</span><span class="p">}</span><span class="o">|</span>\<span class="nv">psi_</span><span class="p">{</span><span class="nv">ideal</span><span class="p">}</span>\<span class="nv">rangle</span><span class="o">|^</span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span>\<span class="nv">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="mi">225</span><span class="p">}$</span><span class="o">.</span>
</code></pre></div>

<p>Combining all terms:</p>
<div class="arithmatex">\[
F = (1-p) \left( 1 - \frac{14p}{15} \right) + p \left( (1-p)\frac{1}{15} + p \frac{1}{225} \right)
\]</div>
<div class="arithmatex">\[
F = (1-p) \left( 1 - \frac{14p}{15} + \frac{p}{15} \right) + \frac{p^2}{225}
\]</div>
<div class="arithmatex">\[
F = (1-p) \left( 1 - \frac{13p}{15} \right) + \frac{p^2}{225}
\]</div>
<div class="arithmatex">\[
F = 1 - \frac{13p}{15} - p + \frac{13p^2}{15} + \frac{p^2}{225}
\]</div>
<div class="arithmatex">\[
F = 1 - \frac{13p}{15} - \frac{15p}{15} + \frac{13p^2}{15} + \frac{p^2}{225}
\]</div>
<div class="arithmatex">\[
F = 1 - \frac{28p}{15} + p^2 \left( \frac{13 \cdot 15 + 1}{225} \right)
\]</div>
<div class="arithmatex">\[
F = 1 - \frac{28p}{15} + p^2 \left( \frac{195+1}{225} \right)
\]</div>
<div class="arithmatex">\[
F = 1 - \frac{28p}{15} + \frac{196p^2}{225}
\]</div>
<p>This expression can be recognized as a perfect square:</p>
<div class="arithmatex">\[
F = \left( 1 - \frac{14p}{15} \right)^2
\]</div>
<p>The final answer is <span class="arithmatex">\(\boxed{\left(1 - \frac{14p}{15}\right)^2}\)</span></p></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#3</span>
    </div>
    <div class="content markdown-body"><h2 id="subproblem-2">Checkpoint 2</h2>
<p>Suppose that we wish to prepare a logical two-qubit GHZ state  <span class="arithmatex">\((|00\rangle_{AB}+|11\rangle_{AB})/\sqrt{2}\)</span> in the [[4,2,2]] code. To do so, we use the following state preparation circuit:</p>
<div class="arithmatex">\[
(CNOT_{03}) (H_0) (CNOT_{21}) (H_2).
\]</div>
<p>Note that this equation is written in matrix multiplication order, while the quantum operations in the circuit occur in the reverse order (from right-to-left in the above equation). <span class="arithmatex">\(H\)</span> is a single-qubit Hadamard gate.</p>
<p>What is the logical state fidelity of the final 2-qubit logical state at the end of the circuit as a function of the two-qubit gate error rate <span class="arithmatex">\(p\)</span>, assuming the state is post-selected on all detectable errors in the code?</p></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#4</span>
    </div>
    
                    <details class="reasoning">
                      <summary>Reasoning <span class="tag">(model)</span></summary>
                      <div class="markdown-body reasoning-body">
                        <p><strong>My primary focus here is to determine the logical state fidelity, considering the specific form of errors and post-selection.</strong> I&rsquo;m given the ideal state, code stabilizers, and the form of the final noisy state, <span class="arithmatex">\(\rho_{final}\)</span>. My approach will involve careful analysis of the terms in the expression for logical fidelity, <span class="arithmatex">\(F_{logical}\)</span>, to ensure proper calculation and accounting for the post-selection.</p>
<p>I start by understanding the setup: I have a specific quantum state encoded within a [[4,2,2]] code, which means four physical qubits encode two logical qubits, using two stabilizers. I know the ideal state and the form of the error channel. I&rsquo;m trying to find fidelity, considering post-selection, so I&rsquo;m only interested in states <em>within</em> the code space after error detection.</p>
<p>The logical fidelity is given by a ratio: the overlap of the ideal state with the noisy state, after projection onto the code space, divided by the probability of the state being in the code space, again after the same projection.  I can quickly simplify things. Since the ideal state, <span class="arithmatex">\(|\psi_{ideal}\rangle\)</span>, <em>is</em> within the code space, the numerator simplifies to the physical fidelityâ€”the &ldquo;goodness&rdquo; of the state after the circuit <em>before</em> post-selection.</p>
<p>I proceed by breaking down the noisy state <span class="arithmatex">\(\rho_{final}\)</span> into manageable terms. I recognize that <span class="arithmatex">\(\rho_{final}\)</span> depends on the error channels which depolarize pairs of qubits.  So, I carefully substitute to expand <span class="arithmatex">\(\rho_{final}\)</span> in a sum of terms involving different Pauli operators. This involves considering two types of errors acting on qubits 1,2 (<span class="arithmatex">\(P_{21}\)</span>) and qubits 0,3 (<span class="arithmatex">\(P_{03}\)</span>), each coming from a 15-term Pauli channel.</p>
<p>The critical step lies in computing the denominator, the probability of the state being within the code space. This involves taking the trace of the projection of <span class="arithmatex">\(\rho_{final}\)</span>. I remember that for the ideal GHZ-like state, a Pauli operator acting on it will map it to either itself, its negative (if it anti-commutes), or something orthogonal to it (if it does not stabilize the state).</p>
<p>I must find a way to compute <span class="arithmatex">\(\mathrm{Tr}(\mathcal{P}_{\mathcal{C}} P |\psi_{ideal}\rangle\langle\psi_{ideal}| P)\)</span>, and I realize that it&rsquo;s 1 only if <em>P commutes with both code stabilizers</em>.</p>
<p>I diligently check each Pauli operator (<span class="arithmatex">\(I, X, Y, Z, XX, XY,\)</span> etc.) acting on the two-qubit pairs to see whether it commutes with <em>both</em> stabilizers, <span class="arithmatex">\(X_0X_1X_2X_3\)</span> and <span class="arithmatex">\(Z_0Z_1Z_2Z_3\)</span>.  My earlier commutation calculations were too hasty. I correct my procedure to be extremely methodical, using rules of commutation and counting the number of anticommutations to determine which of the Pauli operators on the noisy state would still survive post-selection. I carefully expand all the terms to determine which Pauli operators preserve the code space.</p>
<p>I painstakingly verify that the only Pauli operators within the noise terms that commute with <em>both</em> stabilizers (and thus contribute to the denominator) are <span class="arithmatex">\(X_0X_3, Y_0Y_3, Z_0Z_3\)</span> and <span class="arithmatex">\(X_1X_2, Y_1Y_2, Z_1Z_2\)</span>, which have the important feature of either leaving the desired state invariant or simply flipping its sign (which still is a logical &ldquo;good&rdquo; state for fidelity). I determine that operators such as <span class="arithmatex">\(X_0Y_3\)</span> map out of the code space. I do the same calculations when considering the products <span class="arithmatex">\(P_{21}P_{03}\)</span>, leading to an overall formula for the denominator.</p>
<p>I double-check my work.  I re-do Subproblem 1 with the corrected <span class="arithmatex">\(F_{phys}\)</span> calculation based on new stabilizer analysis. The terms in both the numerator and denominator include contributions from those specific Pauli operators that either stabilize or preserve the <em>type</em> of state, or map the state out of the code.</p>
<p>Finally, I find that <span class="arithmatex">\(F_{logical}\)</span> does not simplify to one, as I initially (incorrectly) thought. After corrections, I find that <span class="arithmatex">\(F_{logical} = \frac{(1 - 4p/5)^2}{(1 - 2p/3)^2}\)</span></p>
                      </div>
                    </details>
<div class="content markdown-body"><p>This problem asks for the logical state fidelity of the prepared state, assuming post-selection on all detectable errors. This means we only consider events where the final physical state remains within the code space. The logical fidelity in this scenario is defined as:</p>
<div class="arithmatex">\[
F_{logical} = \frac{\langle \psi_{ideal} | \rho_{final} | \psi_{ideal} \rangle}{\mathrm{Tr}(\mathcal{P}_{\mathcal{C}} \rho_{final})}
\]</div>
<p>where <span class="arithmatex">\(|\psi_{ideal}\rangle\)</span> is the target ideal physical state and <span class="arithmatex">\(\mathcal{P}_{\mathcal{C}}\)</span> is the projector onto the code space.</p>
<p>The numerator, <span class="arithmatex">\(\langle \psi_{ideal} | \rho_{final} | \psi_{ideal} \rangle\)</span>, is the physical state fidelity, which was calculated in Subproblem 1. We will re-evaluate it carefully here.
The denominator, <span class="arithmatex">\(\mathrm{Tr}(\mathcal{P}_{\mathcal{C}} \rho_{final})\)</span>, is the probability that the final state <span class="arithmatex">\(\rho_{final}\)</span> is in the code space, i.e., it is not detected as an error.</p>
<p>The ideal physical state, as derived in Subproblem 1, is:</p>
<div class="arithmatex">\[
|\psi_{ideal}\rangle = \frac{1}{2} (|0000\rangle + |1001\rangle + |0110\rangle + |1111\rangle)
\]</div>
<p>This state is in the code space, meaning it is a <span class="arithmatex">\(+1\)</span> eigenstate of both code stabilizers <span class="arithmatex">\(S_1 = X_0 X_1 X_2 X_3\)</span> and <span class="arithmatex">\(S_2 = Z_0 Z_1 Z_2 Z_3\)</span>.</p>
<p>The noisy final state is:</p>
<div class="arithmatex">\[
\rho_{final} = (1-p)^2 |\psi_{ideal}\rangle\langle\psi_{ideal}| + (1-p)p \sum_{P_{21} \in \mathcal{P}_{21}^*} \frac{1}{15} P_{21} |\psi_{ideal}\rangle\langle\psi_{ideal}| P_{21}
\]</div>
<div class="arithmatex">\[
+ (1-p)p \sum_{P_{03} \in \mathcal{P}_{03}^*} \frac{1}{15} P_{03} |\psi_{ideal}\rangle\langle\psi_{ideal}| P_{03} + p^2 \sum_{P_{03} \in \mathcal{P}_{03}^*} \sum_{P_{21} \in \mathcal{P}_{21}^*} \frac{1}{15^2} P_{03} P_{21} |\psi_{ideal}\rangle\langle\psi_{ideal}| P_{21} P_{03}
\]</div>
<p>where <span class="arithmatex">\(\mathcal{P}_{ij}^*\)</span> are the 15 non-identity Pauli operators on qubits <span class="arithmatex">\(i,j\)</span>.</p>
<h3 id="1-re-evaluation-of-physical-state-fidelity-numerator">1. Re-evaluation of Physical State Fidelity (Numerator)</h3>
<p>The physical state fidelity is <span class="arithmatex">\(F_{phys} = \langle \psi_{ideal} | \rho_{final} | \psi_{ideal} \rangle = \mathrm{Tr}(|\psi_{ideal}\rangle\langle\psi_{ideal}| \rho_{final})\)</span>.
The term <span class="arithmatex">\(\mathrm{Tr}(|\psi_{ideal}\rangle\langle\psi_{ideal}| P |\psi_{ideal}\rangle\langle\psi_{ideal}| P) = |\langle\psi_{ideal}| P |\psi_{ideal}\rangle|^2\)</span> is non-zero (equal to 1) if and only if <span class="arithmatex">\(P|\psi_{ideal}\rangle = \pm |\psi_{ideal}\rangle\)</span>, i.e., <span class="arithmatex">\(P\)</span> is a stabilizer (or anti-stabilizer) of <span class="arithmatex">\(|\psi_{ideal}\rangle\)</span>.</p>
<p>We identify the Pauli operators that act on qubits <span class="arithmatex">\(\{0,3\}\)</span> or <span class="arithmatex">\(\{1,2\}\)</span> and stabilize (or anti-stabilize) <span class="arithmatex">\(|\psi_{ideal}\rangle\)</span>:
*   For <span class="arithmatex">\(P_{21}\)</span> (acting on qubits 1,2):
    *   <span class="arithmatex">\(X_1X_2 |\psi_{ideal}\rangle = |\psi_{ideal}\rangle\)</span>.
    *   <span class="arithmatex">\(Y_1Y_2 |\psi_{ideal}\rangle = -|\psi_{ideal}\rangle\)</span>.
    *   <span class="arithmatex">\(Z_1Z_2 |\psi_{ideal}\rangle = |\psi_{ideal}\rangle\)</span>.
    These three operators contribute to the sum. All other 12 non-identity <span class="arithmatex">\(P_{21}\)</span> operators map <span class="arithmatex">\(|\psi_{ideal}\rangle\)</span> to an orthogonal state.
    So, <span class="arithmatex">\(\sum_{P_{21} \in \mathcal{P}_{21}^*} \frac{1}{15} |\langle\psi_{ideal}|P_{21}|\psi_{ideal}\rangle|^2 = \frac{3}{15}\)</span>.
*   For <span class="arithmatex">\(P_{03}\)</span> (acting on qubits 0,3): By symmetry, these are <span class="arithmatex">\(X_0X_3\)</span>, <span class="arithmatex">\(Y_0Y_3\)</span>, <span class="arithmatex">\(Z_0Z_3\)</span>.
    So, <span class="arithmatex">\(\sum_{P_{03} \in \mathcal{P}_{03}^*} \frac{1}{15} |\langle\psi_{ideal}|P_{03}|\psi_{ideal}\rangle|^2 = \frac{3}{15}\)</span>.
*   For <span class="arithmatex">\(P_{03}P_{21}\)</span>: The product <span class="arithmatex">\(P_{03}P_{21}\)</span> must stabilize <span class="arithmatex">\(|\psi_{ideal}\rangle\)</span>. This occurs if both <span class="arithmatex">\(P_{03}\)</span> and <span class="arithmatex">\(P_{21}\)</span> stabilize <span class="arithmatex">\(|\psi_{ideal}\rangle\)</span>. There are <span class="arithmatex">\(3 \times 3 = 9\)</span> such products.
    So, <span class="arithmatex">\(\sum_{P_{03} \in \mathcal{P}_{03}^*} \sum_{P_{21} \in \mathcal{P}_{21}^*} \frac{1}{15^2} |\langle\psi_{ideal}|P_{03}P_{21}|\psi_{ideal}\rangle|^2 = \frac{9}{225}\)</span>.</p>
<p>Combining these terms for the physical fidelity:</p>
<div class="arithmatex">\[
F_{phys} = (1-p)^2 \cdot 1 + (1-p)p \cdot \frac{3}{15} + (1-p)p \cdot \frac{3}{15} + p^2 \cdot \frac{9}{225}
\]</div>
<div class="arithmatex">\[
F_{phys} = (1-p)^2 + \frac{6p(1-p)}{15} + \frac{9p^2}{225}
\]</div>
<div class="arithmatex">\[
F_{phys} = (1-p)^2 + \frac{2p(1-p)}{5} + \frac{p^2}{25}
\]</div>
<div class="arithmatex">\[
F_{phys} = 1 - 2p + p^2 + \frac{2p}{5} - \frac{2p^2}{5} + \frac{p^2}{25}
\]</div>
<div class="arithmatex">\[
F_{phys} = 1 - \frac{8p}{5} + p^2 \left( 1 - \frac{2}{5} + \frac{1}{25} \right) = 1 - \frac{8p}{5} + p^2 \left( \frac{25 - 10 + 1}{25} \right)
\]</div>
<div class="arithmatex">\[
F_{phys} = 1 - \frac{8p}{5} + \frac{16p^2}{25} = \left(1 - \frac{4p}{5}\right)^2
\]</div>
<h3 id="2-probability-of-remaining-in-code-space-denominator">2. Probability of Remaining in Code Space (Denominator)</h3>
<p>The probability of the state being in the code space is <span class="arithmatex">\(P_{code} = \mathrm{Tr}(\mathcal{P}_{\mathcal{C}} \rho_{final})\)</span>.
The term <span class="arithmatex">\(\mathrm{Tr}(\mathcal{P}_{\mathcal{C}} P |\psi_{ideal}\rangle\langle\psi_{ideal}| P)\)</span> is non-zero (equal to 1) if and only if <span class="arithmatex">\(P|\psi_{ideal}\rangle\)</span> is in the code space. Since <span class="arithmatex">\(|\psi_{ideal}\rangle\)</span> is already in the code space, this means <span class="arithmatex">\(P\)</span> must commute with both code stabilizers <span class="arithmatex">\(S_1 = X_0X_1X_2X_3\)</span> and <span class="arithmatex">\(S_2 = Z_0Z_1Z_2Z_3\)</span>.</p>
<p>We identify the Pauli operators on qubits <span class="arithmatex">\(\{0,3\}\)</span> or <span class="arithmatex">\(\{1,2\}\)</span> that commute with both <span class="arithmatex">\(S_1\)</span> and <span class="arithmatex">\(S_2\)</span>. A Pauli <span class="arithmatex">\(P\)</span> commutes with <span class="arithmatex">\(S\)</span> if the number of qubits on which <span class="arithmatex">\(P\)</span> and <span class="arithmatex">\(S\)</span> anticommute is even.</p>
<ul>
<li>For <span class="arithmatex">\(P_{21}\)</span> (acting on qubits 1,2):<ul>
<li><span class="arithmatex">\(X_1X_2\)</span>: Commutes with <span class="arithmatex">\(S_1\)</span> (2 anticommutations on <span class="arithmatex">\(X_1, X_2\)</span>). Commutes with <span class="arithmatex">\(S_2\)</span> (2 anticommutations on <span class="arithmatex">\(Z_1, Z_2\)</span>). (Contributes)</li>
<li><span class="arithmatex">\(Y_1Y_2\)</span>: Commutes with <span class="arithmatex">\(S_1\)</span> (2 anticommutations on <span class="arithmatex">\(X_1, X_2\)</span>). Commutes with <span class="arithmatex">\(S_2\)</span> (2 anticommutations on <span class="arithmatex">\(Z_1, Z_2\)</span>). (Contributes)</li>
<li><span class="arithmatex">\(Z_1Z_2\)</span>: Commutes with <span class="arithmatex">\(S_1\)</span> (2 anticommutations on <span class="arithmatex">\(X_1, X_2\)</span>). Commutes with <span class="arithmatex">\(S_2\)</span> (2 anticommutations on <span class="arithmatex">\(Z_1, Z_2\)</span>). (Contributes)</li>
<li><span class="arithmatex">\(X_1Y_2\)</span>: Commutes with <span class="arithmatex">\(S_1\)</span> (2 anticommutations on <span class="arithmatex">\(X_1, X_2\)</span>). Commutes with <span class="arithmatex">\(S_2\)</span> (2 anticommutations on <span class="arithmatex">\(Z_1, Z_2\)</span>). (Contributes)</li>
<li><span class="arithmatex">\(Y_1X_2\)</span>: Commutes with <span class="arithmatex">\(S_1\)</span> (2 anticommutations on <span class="arithmatex">\(X_1, X_2\)</span>). Commutes with <span class="arithmatex">\(S_2\)</span> (2 anticommutations on <span class="arithmatex">\(Z_1, Z_2\)</span>). (Contributes)</li>
<li>All other 10 non-identity <span class="arithmatex">\(P_{21}\)</span> operators (e.g., <span class="arithmatex">\(X_1\)</span>, <span class="arithmatex">\(Z_1\)</span>, <span class="arithmatex">\(X_1Z_2\)</span>) anticommute with at least one stabilizer (odd number of total anticommuting pairs), meaning they map <span class="arithmatex">\(|\psi_{ideal}\rangle\)</span> out of the code space.
So, <span class="arithmatex">\(\sum_{P_{21} \in \mathcal{P}_{21}^*} \frac{1}{15} \mathrm{Tr}(\mathcal{P}_{\mathcal{C}} P_{21} |\psi_{ideal}\rangle\langle\psi_{ideal}| P_{21}) = \frac{5}{15}\)</span>.</li>
</ul>
</li>
<li>For <span class="arithmatex">\(P_{03}\)</span> (acting on qubits 0,3): By symmetry, there are 5 such operators: <span class="arithmatex">\(X_0X_3, Y_0Y_3, Z_0Z_3, X_0Y_3, Y_0X_3\)</span>.
    So, <span class="arithmatex">\(\sum_{P_{03} \in \mathcal{P}_{03}^*} \frac{1}{15} \mathrm{Tr}(\mathcal{P}_{\mathcal{C}} P_{03} |\psi_{ideal}\rangle\langle\psi_{ideal}| P_{03}) = \frac{5}{15}\)</span>.</li>
<li>For <span class="arithmatex">\(P_{03}P_{21}\)</span>: The product <span class="arithmatex">\(P_{03}P_{21}\)</span> must commute with both <span class="arithmatex">\(S_1\)</span> and <span class="arithmatex">\(S_2\)</span>. This occurs if both <span class="arithmatex">\(P_{03}\)</span> and <span class="arithmatex">\(P_{21}\)</span> commute with <span class="arithmatex">\(S_1\)</span> and <span class="arithmatex">\(S_2\)</span>. There are <span class="arithmatex">\(5 \times 5 = 25\)</span> such products.
    So, <span class="arithmatex">\(\sum_{P_{03} \in \mathcal{P}_{03}^*} \sum_{P_{21} \in \mathcal{P}_{21}^*} \frac{1}{15^2} \mathrm{Tr}(\mathcal{P}_{\mathcal{C}} P_{03} P_{21} |\psi_{ideal}\rangle\langle\psi_{ideal}| P_{21} P_{03}) = \frac{25}{225}\)</span>.</li>
</ul>
<p>Combining these terms for the probability of remaining in the code space:</p>
<div class="arithmatex">\[
P_{code} = (1-p)^2 \cdot 1 + (1-p)p \cdot \frac{5}{15} + (1-p)p \cdot \frac{5}{15} + p^2 \cdot \frac{25}{225}
\]</div>
<div class="arithmatex">\[
P_{code} = (1-p)^2 + \frac{10p(1-p)}{15} + \frac{25p^2}{225}
\]</div>
<div class="arithmatex">\[
P_{code} = (1-p)^2 + \frac{2p(1-p)}{3} + \frac{p^2}{9}
\]</div>
<div class="arithmatex">\[
P_{code} = 1 - 2p + p^2 + \frac{2p}{3} - \frac{2p^2}{3} + \frac{p^2}{9}
\]</div>
<div class="arithmatex">\[
P_{code} = 1 - p \left( 2 - \frac{2}{3} \right) + p^2 \left( 1 - \frac{2}{3} + \frac{1}{9} \right) = 1 - p \left( \frac{4}{3} \right) + p^2 \left( \frac{9 - 6 + 1}{9} \right)
\]</div>
<div class="arithmatex">\[
P_{code} = 1 - \frac{4p}{3} + \frac{4p^2}{9} = \left(1 - \frac{2p}{3}\right)^2
\]</div>
<h3 id="3-logical-state-fidelity">3. Logical State Fidelity</h3>
<p>Now we combine the numerator (<span class="arithmatex">\(F_{phys}\)</span>) and the denominator (<span class="arithmatex">\(P_{code}\)</span>):</p>
<div class="arithmatex">\[
F_{logical} = \frac{F_{phys}}{P_{code}} = \frac{\left(1 - \frac{4p}{5}\right)^2}{\left(1 - \frac{2p}{3}\right)^2}
\]</div>
<p>This result can be simplified by recognizing that the numerator and denominator are not zero for <span class="arithmatex">\(p \in [0, 1]\)</span>.</p>
<p>The final answer is <span class="arithmatex">\(\boxed{\frac{\left(1 - \frac{4p}{5}\right)^2}{\left(1 - \frac{2p}{3}\right)^2}}\)</span>.</p></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#5</span>
    </div>
    <div class="content markdown-body"><h2 id="subproblem-3">Checkpoint 3</h2>
<p>Suppose that we prepare a logical two-qubit <span class="arithmatex">\(|00\rangle_{AB}\)</span> state in the [[4,2,2]] code. To do so, we introduce an ancilla qubit, qubit 4, and use the following state preparation circuit:</p>
<div class="arithmatex">\[
M_4 (CNOT_{04}) (CNOT_{34}) (CNOT_{23}) (CNOT_{10}) (CNOT_{12}) (H_1)
\]</div>
<p>Note that this equation is written in matrix multiplication order, while the quantum operations in the circuit occur in the reverse order (from right-to-left in the above equation). <span class="arithmatex">\(H\)</span> is a single-qubit Hadamard gate and <span class="arithmatex">\(M\)</span> is a single-qubit measurement. The ancilla is used to detect errors in the state preparation circuit and makes the circuit fault-tolerant. If the ancilla measurement is <span class="arithmatex">\(|0\rangle\)</span> (<span class="arithmatex">\(|1\rangle\)</span>), the state preparation succeeds (fails).</p>
<p>What is the logical state fidelity of the final 2-qubit logical state at the end of the circuit as a function of two-qubit gate error rate <span class="arithmatex">\(p\)</span>, assuming the state is post-selected on all detectable errors in the code and on the ancilla qubit measuring <span class="arithmatex">\(|0\rangle\)</span>?</p></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#6</span>
    </div>
    
                    <details class="reasoning">
                      <summary>Reasoning <span class="tag">(model)</span></summary>
                      <div class="markdown-body reasoning-body">
                        <p><strong>Summary of Fidelity Calculation for Logical <span class="arithmatex">\(|00\rangle_{AB}\)</span> State Preparation</strong></p>
<p>As an expert in the field, I approach this problem by meticulously breaking down the steps and considering the implications of each element. The goal is to calculate the logical state fidelity for a specific circuit preparing the logical <span class="arithmatex">\(|00\rangle_{AB}\)</span> state, focusing on the impact of two-qubit depolarizing errors after each CNOT gate, as well as post-selection on code-space errors and ancilla measurement.</p>
<p>First, I identify the ideal target state. Given the logical state <span class="arithmatex">\(|00\rangle_{AB} = \frac{1}{\sqrt{2}}(|0000\rangle + |1111\rangle)\)</span>, I determine the corresponding ideal physical 4-qubit state, which will be the reference point for fidelity. Then, I meticulously trace the circuit operations to find the ideal state <em>before</em> ancilla measurement, and verify it does indeed prepare the logical <span class="arithmatex">\(|00\rangle_{AB}\)</span> state.</p>
<p>Next, I introduce the error model, and analyze how it affects the ideal state. There are five CNOT gates, each followed by a two-qubit depolarizing channel. The state before ancilla measurement is <span class="arithmatex">\(\rho_{total}\)</span>. The successful state, after post-selection, is <span class="arithmatex">\(\rho_{success}\)</span>, and the logical fidelity is <span class="arithmatex">\(F_{logical}\)</span>. The total state is a complex sum of terms, where each term represents a sequence of errors. I aim to identify which error terms impact the final fidelity.</p>
<p>For each CNOT gate, I need to understand how the two-qubit Pauli errors are transformed through the circuit. Each error is conjugated with the preceeding unitary to become an operator that works against the ideal <span class="arithmatex">\(|\psi_0\rangle\)</span> state. However, because this is an error-detecting circuit, most single errors will be detected and discarded. The key lies in understanding how certain types of errors are &ldquo;invisible&rdquo; and persist.</p>
<p>A crucial insight is understanding the state space and the error syndrome. I can then figure out how each error propagates through the circuit by using the ancilla qubit. Because I only consider the case of ancilla measuring 0, I want to understand what happens to the physical state in terms of the logical state, for each one and two Pauli gates. I only consider those terms that are <em>not</em> detected by the ancilla and <em>not detected</em> by the code, and how they would affect the fidelity.</p>
<p>I focus on the Pauli errors <span class="arithmatex">\(I, X, Y, Z\)</span> on the target and control qubits of the CNOT gates and also on the ancilla qubit, to understand if such error impacts the ancilla measure and the stabilizer condition (code check).</p>
<p>The key is to determine those physical errors that affect the final state but do not lead to a logical error and are not detected by code or ancilla. For the first three CNOT gates, the undected Pauli error <span class="arithmatex">\(Z_1Z_2, Z_1I_2\)</span> and <span class="arithmatex">\(I_1Z_2\)</span> on the first CNOT, <span class="arithmatex">\(Z_0Z_1, Z_0I_1, I_0Z_1\)</span> on the second CNOT and, <span class="arithmatex">\(Z_3Z_2, Z_3I_2, I_3Z_2\)</span> on the third CNOT. On the remaining <span class="arithmatex">\(CNOT_{34}\)</span> and <span class="arithmatex">\(CNOT_{04}\)</span>, errors involving <span class="arithmatex">\(I_4\)</span> or <span class="arithmatex">\(Z_4\)</span> can also pass the ancilla check (meaning <span class="arithmatex">\(q_4\)</span> remains <span class="arithmatex">\(0\)</span>). However, these errors also correspond to only logical state identities (preserves <span class="arithmatex">\(|\psi_0\rangle\)</span>).</p>
<p>This means that to first order in <span class="arithmatex">\(p\)</span>, for small values of the error rate, these errors, although not detected by ancilla or code, have a neutral effect, making the circuit fault-tolerant against single errors, and resulting in a logical fidelity of 1, because all non-detectable errors preserve the ideal state.</p>
                      </div>
                    </details>
<div class="content markdown-body"><p>The problem asks for the logical state fidelity of the prepared logical two-qubit <span class="arithmatex">\(|00\rangle_{AB}\)</span> state, given post-selection on all detectable errors in the code and on the ancilla qubit measuring <span class="arithmatex">\(|0\rangle\)</span>. This implies a fault-tolerant calculation of fidelity.</p>
<p>Let the initial state be <span class="arithmatex">\(|00000\rangle\)</span>, where qubits 0,1,2,3 are data qubits and qubit 4 is the ancilla.
The ideal target logical state is <span class="arithmatex">\(|00\rangle_{AB}\)</span>, which corresponds to the physical state <span class="arithmatex">\(|\psi_0\rangle = \frac{1}{\sqrt{2}}(|0000\rangle + |1111\rangle)\)</span>.</p>
<p>First, let&rsquo;s trace the ideal circuit to verify it produces the desired state, including the ancilla.
The operations are applied in reverse order: <span class="arithmatex">\(M_4 (CNOT_{04}) (CNOT_{34}) (CNOT_{23}) (CNOT_{10}) (CNOT_{12}) (H_1)\)</span>.</p>
<ol>
<li>Initial state: <span class="arithmatex">\(|00000\rangle\)</span>.</li>
<li><span class="arithmatex">\(H_1\)</span>: <span class="arithmatex">\(\frac{1}{\sqrt{2}}(|00000\rangle + |01000\rangle)\)</span>.</li>
<li><span class="arithmatex">\(CNOT_{12}\)</span> (control 1, target 2): <span class="arithmatex">\(\frac{1}{\sqrt{2}}(|00000\rangle + |01100\rangle)\)</span>.</li>
<li><span class="arithmatex">\(CNOT_{10}\)</span> (control 1, target 0): <span class="arithmatex">\(\frac{1}{\sqrt{2}}(|00000\rangle + |11100\rangle)\)</span>.</li>
<li><span class="arithmatex">\(CNOT_{23}\)</span> (control 2, target 3): <span class="arithmatex">\(\frac{1}{\sqrt{2}}(|00000\rangle + |11110\rangle)\)</span>.</li>
<li><span class="arithmatex">\(CNOT_{34}\)</span> (control 3, target 4): <span class="arithmatex">\(\frac{1}{\sqrt{2}}(|00000\rangle + |11111\rangle)\)</span>.</li>
<li><span class="arithmatex">\(CNOT_{04}\)</span> (control 0, target 4): <span class="arithmatex">\(\frac{1}{\sqrt{2}}(|00000\rangle + |11110\rangle)\)</span>.
The ideal state before measurement <span class="arithmatex">\(M_4\)</span> is <span class="arithmatex">\(|\Psi_{ideal}\rangle = \frac{1}{\sqrt{2}}(|00000\rangle + |11110\rangle)\)</span>.
Upon measurement of <span class="arithmatex">\(q_4\)</span> in <span class="arithmatex">\(|0\rangle\)</span>, the state collapses to <span class="arithmatex">\(|\psi_0\rangle = \frac{1}{\sqrt{2}}(|0000\rangle + |1111\rangle)\)</span> on qubits 0,1,2,3, as required.</li>
</ol>
<p>The logical fidelity for a fault-tolerant preparation with post-selection is defined as:</p>
<div class="arithmatex">\[
F_{logical} = \frac{\langle \psi_0 | \mathcal{P}_{\mathcal{C}} \rho_{success} \mathcal{P}_{\mathcal{C}} | \psi_0 \rangle}{\mathrm{Tr}(\mathcal{P}_{\mathcal{C}} \rho_{success})}
\]</div>
<p>where <span class="arithmatex">\(\rho_{success} = \mathrm{Tr}_4(P_0 \rho_{noisy} P_0)\)</span>, <span class="arithmatex">\(P_0 = I_{0123} \otimes |0\rangle\langle0|_4\)</span> is the projector onto ancilla <span class="arithmatex">\(|0\rangle\)</span>, and <span class="arithmatex">\(\mathcal{P}_{\mathcal{C}}\)</span> is the projector onto the code space of qubits 0,1,2,3. Since <span class="arithmatex">\(|\psi_0\rangle\)</span> is in the code space, <span class="arithmatex">\(\mathcal{P}_{\mathcal{C}}|\psi_0\rangle = |\psi_0\rangle\)</span>. So, the numerator simplifies to <span class="arithmatex">\(\langle \psi_0 | \rho_{success} | \psi_0 \rangle\)</span>.</p>
<p>We consider errors up to <span class="arithmatex">\(O(p)\)</span>, i.e., at most one error occurring in the circuit.
The probability of no error is <span class="arithmatex">\((1-p)^5\)</span>. The probability of one error at any specific CNOT <span class="arithmatex">\(k\)</span> is <span class="arithmatex">\(p(1-p)^4\)</span>. The probability of a specific Pauli error <span class="arithmatex">\(P\)</span> occurring (if it&rsquo;s not <span class="arithmatex">\(I\)</span>) is <span class="arithmatex">\(p/15\)</span>.</p>
<p>Let&rsquo;s analyze the effect of a single error <span class="arithmatex">\(P_k\)</span> (acting on qubits <span class="arithmatex">\(i,j\)</span>) occurring after <span class="arithmatex">\(CNOT_k\)</span>. This error is effectively propagated through the remaining gates to act on the final ideal state <span class="arithmatex">\(|\Psi_{ideal}\rangle\)</span>. Let <span class="arithmatex">\(U_{after,k}\)</span> be the remaining circuit after <span class="arithmatex">\(CNOT_k\)</span>. The effective error <span class="arithmatex">\(P_k^{final} = U_{after,k} P_k U_{after,k}^\dagger\)</span>.
The state after ancilla measurement and code space projection is:</p>
<div class="arithmatex">\[
\rho_{effective} = (1-p)^5 |\psi_0\rangle\langle\psi_0| + (1-p)^4 \frac{p}{15} \sum_{k=1}^5 \sum_{P_k \in \mathcal{P}_k^*} \mathrm{Tr}_4(\mathcal{P}_C P_0 P_k^{final} |\Psi_{ideal}\rangle\langle\Psi_{ideal}| P_k^{final} P_0 \mathcal{P}_C) + O(p^2)
\]</div>
<p>where <span class="arithmatex">\(\mathcal{P}_k^*\)</span> is the set of 15 non-identity Pauli operators on the qubits <span class="arithmatex">\(CNOT_k\)</span> acts on.</p>
<p>The conditions for a single error <span class="arithmatex">\(P_k\)</span> to contribute to <span class="arithmatex">\(F_{logical}\)</span> are:</p>
<ol>
<li>The ancilla qubit must measure <span class="arithmatex">\(|0\rangle\)</span>. This means <span class="arithmatex">\(P_k^{final}\)</span> must not have an <span class="arithmatex">\(X_4\)</span> or <span class="arithmatex">\(Y_4\)</span> component.</li>
<li>The resulting state on data qubits must be in the code space. This means <span class="arithmatex">\(P_k^{final}\)</span> (restricted to data qubits, denoted <span class="arithmatex">\(P_{k,data}^{final}\)</span>) must commute with the code stabilizers <span class="arithmatex">\(S_1 = X_0X_1X_2X_3\)</span> and <span class="arithmatex">\(S_2 = Z_0Z_1Z_2Z_3\)</span>.</li>
<li>For the numerator, <span class="arithmatex">\(P_{k,data}^{final}\)</span> must leave <span class="arithmatex">\(|\psi_0\rangle\)</span> invariant (up to a sign), i.e., <span class="arithmatex">\(P_{k,data}^{final}|\psi_0\rangle = \pm |\psi_0\rangle\)</span>. For the logical <span class="arithmatex">\(|00\rangle_{AB}\)</span> state, such operators are called logical identities.</li>
</ol>
<p>Let&rsquo;s analyze each of the 5 CNOT gates (<span class="arithmatex">\(U_1=CNOT_{12}, U_2=CNOT_{10}, U_3=CNOT_{23}, U_4=CNOT_{34}, U_5=CNOT_{04}\)</span>).</p>
<p><strong>1. Errors after <span class="arithmatex">\(U_1, U_2, U_3\)</span> (CNOTs on data qubits only: <span class="arithmatex">\(CNOT_{12}, CNOT_{10}, CNOT_{23}\)</span>):</strong>
*   <strong>Ancilla detection:</strong> An error <span class="arithmatex">\(P_{ij}\)</span> on data qubits (e.g., <span class="arithmatex">\(X_1I_2\)</span>) will propagate an <span class="arithmatex">\(X\)</span> component to <span class="arithmatex">\(q_0\)</span> or <span class="arithmatex">\(q_3\)</span> via <span class="arithmatex">\(CNOT_{10}\)</span> or <span class="arithmatex">\(CNOT_{23}\)</span>. These <span class="arithmatex">\(X\)</span> components will then propagate to <span class="arithmatex">\(q_4\)</span> via <span class="arithmatex">\(CNOT_{04}\)</span> or <span class="arithmatex">\(CNOT_{34}\)</span>. This means any <span class="arithmatex">\(X\)</span> or <span class="arithmatex">\(Y\)</span> error component in <span class="arithmatex">\(P_{ij}\)</span> on data qubits will ultimately result in an <span class="arithmatex">\(X_4\)</span> or <span class="arithmatex">\(Y_4\)</span> component in <span class="arithmatex">\(P_k^{final}\)</span>, which is detected by <span class="arithmatex">\(M_4\)</span>.
    Therefore, only <span class="arithmatex">\(P_{ij}\)</span> errors consisting solely of <span class="arithmatex">\(I\)</span> and <span class="arithmatex">\(Z\)</span> components will pass the ancilla check. For each of these three CNOTs, there are <span class="arithmatex">\(2^2=4\)</span> such Pauli products (including <span class="arithmatex">\(I_iI_j\)</span>): <span class="arithmatex">\(I_iI_j, Z_iI_j, I_iZ_j, Z_iZ_j\)</span>. Thus, 3 non-identity errors per CNOT pass the ancilla check.
*   <strong>Code detection and logical effect:</strong>
    The logical <span class="arithmatex">\(|00\rangle_{AB}\)</span> state <span class="arithmatex">\(|\psi_0\rangle\)</span> has stabilizers <span class="arithmatex">\(X_0X_1X_2X_3\)</span>, <span class="arithmatex">\(Z_0Z_1Z_2Z_3\)</span> (code stabilizers), and also <span class="arithmatex">\(X_0X_1, X_1X_2, X_2X_3, Z_0Z_1, Z_1Z_2, Z_2Z_3\)</span> (effective stabilizers for the prepared state).
    *   For <span class="arithmatex">\(Z_iI_j\)</span> (e.g., <span class="arithmatex">\(Z_1I_2 \to Z_1\)</span> on <span class="arithmatex">\(q_1\)</span>): This error anticommutes with <span class="arithmatex">\(X_0X_1X_2X_3\)</span>, so it is detected by the code. It also maps <span class="arithmatex">\(|\psi_0\rangle\)</span> to an orthogonal state (<span class="arithmatex">\(Z_1|\psi_0\rangle \ne \pm|\psi_0\rangle\)</span>). So these 2 errors for each CNOT (e.g., <span class="arithmatex">\(Z_1I_2, I_1Z_2\)</span>) contribute 0 to both numerator and denominator.
    *   For <span class="arithmatex">\(Z_iZ_j\)</span> (e.g., <span class="arithmatex">\(Z_1Z_2\)</span>): This error commutes with both code stabilizers. It also leaves <span class="arithmatex">\(|\psi_0\rangle\)</span> invariant (<span class="arithmatex">\(Z_1Z_2|\psi_0\rangle = |\psi_0\rangle\)</span>). Thus, this is a logical identity.
        There is 1 such error per CNOT (<span class="arithmatex">\(Z_1Z_2\)</span> for <span class="arithmatex">\(CNOT_{12}\)</span>, <span class="arithmatex">\(Z_0Z_1\)</span> for <span class="arithmatex">\(CNOT_{10}\)</span>, <span class="arithmatex">\(Z_2Z_3\)</span> for <span class="arithmatex">\(CNOT_{23}\)</span>). These 3 errors contribute 1 to both numerator and denominator.</p>
<p><strong>2. Errors after <span class="arithmatex">\(U_4, U_5\)</span> (CNOTs involving ancilla <span class="arithmatex">\(q_4\)</span>: <span class="arithmatex">\(CNOT_{34}, CNOT_{04}\)</span>):</strong>
*   <strong>Ancilla detection:</strong> For these errors (<span class="arithmatex">\(P_{i4}\)</span>), if the <span class="arithmatex">\(q_4\)</span> component is <span class="arithmatex">\(X_4\)</span> or <span class="arithmatex">\(Y_4\)</span>, it is detected by <span class="arithmatex">\(M_4\)</span>. There are <span class="arithmatex">\(4 \times 4 = 16\)</span> possible Pauli errors. <span class="arithmatex">\(4 \times 2 = 8\)</span> errors have <span class="arithmatex">\(I_4\)</span> or <span class="arithmatex">\(Z_4\)</span> component, so 7 non-identity errors pass the ancilla check. (<span class="arithmatex">\(X_iI_4, Y_iI_4, Z_iI_4, I_iZ_4, X_iZ_4, Y_iZ_4, Z_iZ_4\)</span>).
*   <strong>Code detection and logical effect:</strong>
    The data-qubit part of these errors is <span class="arithmatex">\(P_{i,data}\)</span>. For <span class="arithmatex">\(CNOT_{34}\)</span> (<span class="arithmatex">\(U_4\)</span>), <span class="arithmatex">\(U_{after,4}=CNOT_{04}\)</span>, which does not act on <span class="arithmatex">\(q_3\)</span>, so the <span class="arithmatex">\(q_3\)</span> component <span class="arithmatex">\(P_{3,data}\)</span> is unchanged. For <span class="arithmatex">\(CNOT_{04}\)</span> (<span class="arithmatex">\(U_5\)</span>), <span class="arithmatex">\(U_{after,5}=I\)</span>, so <span class="arithmatex">\(P_{0,data}\)</span> is unchanged.
    *   If <span class="arithmatex">\(P_{i,data}\)</span> is <span class="arithmatex">\(X_i, Y_i\)</span> or <span class="arithmatex">\(Z_i\)</span>: these errors all anticommute with <span class="arithmatex">\(X_0X_1X_2X_3\)</span> (for <span class="arithmatex">\(X,Y\)</span>) or <span class="arithmatex">\(Z_0Z_1Z_2Z_3\)</span> (for <span class="arithmatex">\(Z\)</span>). Thus, they are detected by the code. They also map <span class="arithmatex">\(|\psi_0\rangle\)</span> to an orthogonal state. So they contribute 0 to both numerator and denominator.
    *   If <span class="arithmatex">\(P_{i,data}\)</span> is <span class="arithmatex">\(I_{data}\)</span> (from <span class="arithmatex">\(I_3Z_4\)</span> or <span class="arithmatex">\(I_0Z_4\)</span>): This is a logical identity (<span class="arithmatex">\(I|\psi_0\rangle = |\psi_0\rangle\)</span>) and commutes with code stabilizers.
        There is 1 such error for <span class="arithmatex">\(CNOT_{34}\)</span> (<span class="arithmatex">\(I_3Z_4\)</span>) and 1 for <span class="arithmatex">\(CNOT_{04}\)</span> (<span class="arithmatex">\(I_0Z_4\)</span>). These 2 errors contribute 1 to both numerator and denominator.</p>
<p><strong>Summary of non-identity errors that are NOT detected by ancilla AND NOT detected by code AND are logical identities (contribute 1 to num and den):</strong>
*   From <span class="arithmatex">\(CNOT_{12}\)</span>: <span class="arithmatex">\(Z_1Z_2\)</span> (1 error type)
*   From <span class="arithmatex">\(CNOT_{10}\)</span>: <span class="arithmatex">\(Z_0Z_1\)</span> (1 error type)
*   From <span class="arithmatex">\(CNOT_{23}\)</span>: <span class="arithmatex">\(Z_2Z_3\)</span> (1 error type)
*   From <span class="arithmatex">\(CNOT_{34}\)</span>: <span class="arithmatex">\(I_3Z_4\)</span> (effective <span class="arithmatex">\(I_{data}\)</span>) (1 error type)
*   From <span class="arithmatex">\(CNOT_{04}\)</span>: <span class="arithmatex">\(I_0Z_4\)</span> (effective <span class="arithmatex">\(I_{data}\)</span>) (1 error type)
In total, there are 5 such error types.</p>
<p><strong>Numerator:</strong>
The numerator is <span class="arithmatex">\(\langle \psi_0 | \rho_{success} | \psi_0 \rangle\)</span>.</p>
<div class="arithmatex">\[
\langle \psi_0 | \rho_{success} | \psi_0 \rangle = (1-p)^5 \cdot 1 + (1-p)^4 \frac{p}{15} \cdot (\text{# of single logical identity errors}) + O(p^2)
\]</div>
<div class="arithmatex">\[
\langle \psi_0 | \rho_{success} | \psi_0 \rangle = (1-p)^5 + (1-p)^4 \frac{5p}{15} + O(p^2) = (1-p)^5 + \frac{p(1-p)^4}{3} + O(p^2)
\]</div>
<p><strong>Denominator:</strong>
The denominator is <span class="arithmatex">\(\mathrm{Tr}(\mathcal{P}_{\mathcal{C}} \rho_{success})\)</span>. This represents the total probability of obtaining a state within the code space, given that the ancilla measured <span class="arithmatex">\(|0\rangle\)</span>.
All single-error terms that are not detected by the ancilla and not detected by the code stabilizers (i.e., the 5 errors identified above) contribute to the denominator. No other single errors contribute to the denominator.</p>
<div class="arithmatex">\[
\mathrm{Tr}(\mathcal{P}_{\mathcal{C}} \rho_{success}) = (1-p)^5 \cdot 1 + (1-p)^4 \frac{p}{15} \cdot (\text{# of single non-detectable errors}) + O(p^2)
\]</div>
<div class="arithmatex">\[
\mathrm{Tr}(\mathcal{P}_{\mathcal{C}} \rho_{success}) = (1-p)^5 + (1-p)^4 \frac{5p}{15} + O(p^2) = (1-p)^5 + \frac{p(1-p)^4}{3} + O(p^2)
\]</div>
<p>Thus, to first order in <span class="arithmatex">\(p\)</span>:</p>
<div class="arithmatex">\[
F_{logical} = \frac{(1-p)^5 + \frac{p(1-p)^4}{3} + O(p^2)}{(1-p)^5 + \frac{p(1-p)^4}{3} + O(p^2)} = 1 + O(p^2)
\]</div>
<p>This result indicates that the circuit is fault-tolerant to single errors; a single physical error does not lead to a logical error or an undetectable physical error that deviates from the target logical state. Such fault-tolerant circuits typically achieve a logical fidelity of <span class="arithmatex">\(1 - O(p^2)\)</span>, meaning the leading order in <span class="arithmatex">\(p\)</span> is zero. Since the problem asks for the fidelity as a function of <span class="arithmatex">\(p\)</span>, but higher-order calculations are not feasible without further simplifying assumptions (which are not given), expressing the fidelity to first order in <span class="arithmatex">\(p\)</span> is appropriate and implies perfect fidelity in this regime.</p>
<p>The final answer is <span class="arithmatex">\(\boxed{1 + O(p^2)}\)</span></p></div>
</article>


<article class="message role-user">
    <div class="meta">
        <span class="badge">User</span>
        <span class="idx">#7</span>
    </div>
    <div class="content markdown-body"><p>Populate your final answer into the code template provided below. This step is purely for formatting/display purposes. No additional reasoning or derivation should be performed. Do not import any modules or packages beyond what is provided in the template.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">answer</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the expression of the logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    at the end of the circuit as a function of two-qubit gate error rate $p$.</span>

<span class="sd">    Inputs</span>
<span class="sd">    ----------</span>
<span class="sd">    p: sympy.Symbol, two-qubit gate error rate, $p$</span>

<span class="sd">    Outputs</span>
<span class="sd">    ----------</span>
<span class="sd">    F_logical: sympy.Expr, logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ------------------ FILL IN YOUR RESULTS BELOW ------------------</span>
    <span class="n">F_logical</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># a SymPy expression of inputs</span>
    <span class="c1"># ---------------------------------------------------------------</span>

    <span class="k">return</span> <span class="n">F_logical</span>
</code></pre></div></div>
</article>


<article class="message role-assistant">
    <div class="meta">
        <span class="badge">Assistant</span>
        <span class="idx">#8</span>
    </div>
    <div class="content markdown-body"><div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">answer</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the expression of the logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    at the end of the circuit as a function of two-qubit gate error rate $p$.</span>

<span class="sd">    Inputs</span>
<span class="sd">    ----------</span>
<span class="sd">    p: sympy.Symbol, two-qubit gate error rate, $p$</span>

<span class="sd">    Outputs</span>
<span class="sd">    ----------</span>
<span class="sd">    F_logical: sympy.Expr, logical state fidelity of the final 2-qubit logical state</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ------------------ FILL IN YOUR RESULTS BELOW ------------------</span>
    <span class="n">F_logical</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sp</span><span class="o">.</span><span class="n">O</span><span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># ---------------------------------------------------------------</span>

    <span class="k">return</span> <span class="n">F_logical</span>
</code></pre></div></div>
</article>

</div>

<footer>
  Generated at 2025-09-24T22:02:11.252560
</footer>

<script>
(function() {
  // Tabs
  const tabs = document.querySelectorAll('.tab');
  const panels = document.querySelectorAll('.tab-content');
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      panels.forEach(p => p.classList.remove('active'));
      tab.classList.add('active');
      const target = document.querySelector(tab.dataset.target);
      if (target) target.classList.add('active');
    });
  });

  // Theme toggle
  const toggleBtn = document.getElementById('theme-toggle');
  function setTheme(dark) {
    if (dark) {
      document.documentElement.classList.add('dark');
      localStorage.setItem('dark', '1');
    } else {
      document.documentElement.classList.remove('dark');
      localStorage.setItem('dark', '0');
    }
  }
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const stored = localStorage.getItem('dark');
  setTheme(stored === null ? prefersDark : stored === '1');

  toggleBtn.addEventListener('click', () => {
    const isDark = document.documentElement.classList.contains('dark');
    setTheme(!isDark);
  });
})();
</script>
</body>
</html>